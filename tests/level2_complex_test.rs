use libblas::level2::complex;
use libblas::unstable::matrix;
use num_complex::Complex;
mod fixtures;

#[macro_use]
mod utils;

#[test]
fn gbmv() {
    let mut y = fixtures::complex::vector(6);
    complex::gbmv(
        'n',
        6,
        8,
        3,
        2,
        Complex::new(0.0, 0.0),
        &fixtures::complex::bandmatrix_nxm_ku_kl(8, 6, 3, 2),
        6,
        &fixtures::complex::vector(8),
        1,
        Complex::new(2.5, 0.5),
        &mut y,
        1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(-2.0085962414741516, 1.6058503985404968),
            Complex::new(-0.188_164_103_776_216_5, -0.608_373_437_076_807),
            Complex::new(1.872_744_381_427_765, -0.729_957_878_589_630_1),
            Complex::new(2.9619127362966537, -0.496_965_691_447_258),
            Complex::new(-0.139_064_721_763_134, 2.5643529072403908),
            Complex::new(-0.15649497509002686, -0.748_321_861_028_671_3)
        ]
    );

    let mut y = fixtures::complex::vector(6);
    complex::gbmv(
        'n',
        6,
        8,
        3,
        2,
        Complex::new(0.2, 0.8),
        &fixtures::complex::bandmatrix_nxm_ku_kl(8, 6, 3, 2),
        6,
        &fixtures::complex::vector(8),
        1,
        Complex::new(2.5, 0.5),
        &mut y,
        1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(-1.0943454405994295, 1.064_274_115_761_668),
            Complex::new(-0.386_285_981_412_258_8, -1.2014790478399264),
            Complex::new(0.889_951_886_227_984_7, -1.1623543999107093),
            Complex::new(7.911_820_536_068_737E-2, 0.764_708_940_877_913_5),
            Complex::new(-5.786_286_267_832_78E-2, 0.629_303_403_731_173_7),
            Complex::new(-0.366_890_708_410_523_8, -0.18794836059332087)
        ]
    );

    let mut y = fixtures::complex::vector(8);
    complex::gbmv(
        't',
        6,
        8,
        3,
        2,
        Complex::new(0.2, 0.8),
        &fixtures::complex::bandmatrix_nxm_ku_kl(8, 6, 3, 2),
        6,
        &fixtures::complex::vector(6),
        1,
        Complex::new(0.0, 0.0),
        &mut y,
        1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(-0.38810574366012285, -1.6303050664096645),
            Complex::new(2.3103061857743366, -0.974_172_809_452_641),
            Complex::new(-4.207_652_009_009_524, -0.505_913_815_020_696_8),
            Complex::new(-0.818_537_652_576_440_5, 1.4503261671516843),
            Complex::new(2.663_157_624_266_846E-2, -0.636_226_738_515_224_2),
            Complex::new(0.0, 0.0),
            Complex::new(0.0, 0.0),
            Complex::new(0.0, 0.0),
        ]
    );

    let mut y = fixtures::complex::vector(8);
    complex::gbmv(
        'c',
        6,
        8,
        3,
        2,
        Complex::new(0.2, 0.8),
        &fixtures::complex::bandmatrix_nxm_ku_kl(8, 6, 3, 2),
        6,
        &fixtures::complex::vector(6),
        -1,
        Complex::new(1.0, 0.0),
        &mut y,
        -1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(-0.649_010_062_217_712_4, 0.772_142_171_859_741_2),
            Complex::new(-0.11916876584291458, -0.219_515_621_662_139_9),
            Complex::new(0.664_135_694_503_784_2, -0.424_810_290_336_608_9),
            Complex::new(0.761_707_265_482_331_5, -0.748_294_671_210_418_4),
            Complex::new(0.493_622_466_164_575_5, -0.11820536025789097),
            Complex::new(-0.14226157594261568, -3.188_894_081_182_019),
            Complex::new(-2.0779711022358427, 1.511_492_297_833_43),
            Complex::new(-2.4265906255376652, 0.38932194147661164),
        ]
    );

    let mut y = fixtures::complex::vector(8);
    complex::gbmv(
        'c',
        6,
        8,
        3,
        2,
        Complex::new(0.0, 0.0),
        &fixtures::complex::bandmatrix_nxm_ku_kl(8, 6, 3, 2),
        6,
        &fixtures::complex::vector(6),
        -1,
        Complex::new(1.0, 0.0),
        &mut y,
        -1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(-0.649_010_062_217_712_4, 0.772_142_171_859_741_2),
            Complex::new(-0.11916876584291458, -0.219_515_621_662_139_9),
            Complex::new(0.664_135_694_503_784_2, -0.424_810_290_336_608_9),
            Complex::new(1.1009690761566162, -0.41898009181022644),
            Complex::new(0.143_771_484_494_209_3, 0.996_986_865_997_314_5),
            Complex::new(-0.11775359511375427, -0.27577802538871765),
            Complex::new(-0.912_068_367_004_394_5, 1.2560187578201294),
            Complex::new(-1.4375861883163452, 0.646_674_394_607_544),
        ]
    );

    let result = std::panic::catch_unwind(|| {
        complex::gbmv(
            'x',
            6,
            8,
            4,
            4,
            Complex::new(0.0, 0.0),
            &[],
            6,
            &[],
            1,
            Complex::new(2.0, 0.5),
            &mut [],
            1,
        )
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::gbmv(
            't',
            6,
            8,
            4,
            4,
            Complex::new(0.0, 0.0),
            &[],
            6,
            &[],
            1,
            Complex::new(2.0, 0.5),
            &mut [],
            1,
        )
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::gbmv(
            't',
            6,
            8,
            4,
            4,
            Complex::new(0.0, 0.0),
            &[],
            6,
            &[],
            0,
            Complex::new(2.0, 0.5),
            &mut [],
            1,
        )
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::gbmv(
            't',
            6,
            8,
            4,
            4,
            Complex::new(0.0, 0.0),
            &[],
            6,
            &[],
            1,
            Complex::new(2.0, 0.5),
            &mut [],
            0,
        )
    });
    assert!(result.is_err());
}

#[test]
fn gemv() {
    let mut y = fixtures::complex::vector(6);
    complex::gemv(
        'n',
        6,
        8,
        Complex::new(0.8, 0.2),
        &fixtures::complex::matrix_mxn(6, 8),
        6,
        &fixtures::complex::vector(8),
        1,
        Complex::new(0.2, 0.8),
        &mut y,
        1,
    );
    println!("{:?}", y);
    capproximately!(
        y,
        vec![
            Complex::new(-4.0955083795571205, 1.1357517892058278),
            Complex::new(0.938_960_422_186_020_2, 1.0838676654345458),
            Complex::new(-1.5853445176637875, 1.6962449347899724),
            Complex::new(-0.25555151836345036, -4.380_052_222_020_623),
            Complex::new(-1.2051793139138998, -2.9157429210651786),
            Complex::new(0.38280021798680286, 0.19114175133433564),
        ]
    );

    let mut y = fixtures::complex::vector(6);
    complex::gemv(
        'n',
        6,
        8,
        Complex::new(0.8, 0.2),
        &fixtures::complex::matrix_mxn(6, 8),
        6,
        &fixtures::complex::vector(8),
        -1,
        Complex::new(0.0, 0.0),
        &mut y,
        -1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(2.6017477475494872, -0.624_519_898_220_449),
            Complex::new(1.8074832963400977, -2.2773562366746307),
            Complex::new(-4.264_959_612_210_399, 2.107_142_125_565_092),
            Complex::new(0.27753542357045247, -1.9840473842815003),
            Complex::new(2.2299686271484305, 0.24845760476943476),
            Complex::new(0.20069066517622025, -1.0213684617581498),
        ]
    );

    let mut y = fixtures::complex::vector(6);
    complex::gemv(
        'n',
        6,
        8,
        Complex::new(0.8, 0.2),
        &fixtures::complex::matrix_mxn(6, 8),
        6,
        &fixtures::complex::vector(8),
        1,
        Complex::new(1.0, 0.0),
        &mut y,
        1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(-3.9970026807046444, 2.2726735819034305),
            Complex::new(0.668_012_909_920_296_7, 1.0035901828539755),
            Complex::new(-1.3938842013734591, 0.825_088_140_266_577_3),
            Complex::new(0.290_039_660_837_886, -5.596_011_568_270_013),
            Complex::new(-0.292_572_622_064_142_9, -2.233_170_620_547_837),
            Complex::new(6.797_491_864_822_813E-2, 6.472_220_933_997_974E-2),
        ]
    );

    let mut y = fixtures::complex::vector(8);
    complex::gemv(
        't',
        6,
        8,
        Complex::new(0.8, 0.2),
        &fixtures::complex::matrix_mxn(6, 8),
        6,
        &fixtures::complex::vector(6),
        1,
        Complex::new(1.0, 0.0),
        &mut y,
        1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(-1.0722266311585562, 1.4276441972981582),
            Complex::new(4.0697286775452355, -1.3751872740072097),
            Complex::new(-1.7667910641302869, -1.3146598668049647),
            Complex::new(2.768_258_830_502_758, 0.43286241964465866),
            Complex::new(0.612_877_484_895_186_7, -1.2227666045246042),
            Complex::new(-5.660_444_276_810_555_6E-2, 1.3467393639005534),
            Complex::new(-2.213_193_419_205_071, 4.155_265_566_127_419),
            Complex::new(-2.9062411441513247, 2.3044710975088387),
        ]
    );

    let mut y = fixtures::complex::vector(8);
    complex::gemv(
        'c',
        6,
        8,
        Complex::new(0.8, 0.2),
        &fixtures::complex::matrix_mxn(6, 8),
        6,
        &fixtures::complex::vector(6),
        1,
        Complex::new(1.0, 0.0),
        &mut y,
        1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(2.2502367460895774, 2.0732672240604177),
            Complex::new(1.5386279370583802, 1.2491393341728396),
            Complex::new(3.535_475_716_088_267, 0.531_532_776_664_310_1),
            Complex::new(-0.659_681_237_718_443_1, -0.518_324_670_851_112_9),
            Complex::new(-8.175_163_432_874_585E-2, 0.523_620_431_221_815_1),
            Complex::new(-1.8050991363430615, -0.944_414_639_173_348_2),
            Complex::new(-0.256_566_341_565_977_6, 1.6792353267609732),
            Complex::new(-2.593_257_840_661_415, -3.542_223_048_780_606),
        ]
    );

    let mut y = fixtures::complex::vector(6);
    complex::gemv(
        'n',
        6,
        8,
        Complex::new(0.0, 0.0),
        &fixtures::complex::matrix_mxn(6, 8),
        6,
        &fixtures::complex::vector(8),
        1,
        Complex::new(0.2, 0.8),
        &mut y,
        1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(-0.747_515_761_070_188_1, -0.36477962083786153),
            Complex::new(0.15177874642280853, -0.13923813908156957),
            Complex::new(0.47267537821345584, 0.446_346_504_186_786_7),
            Complex::new(0.555_377_896_955_279_8, 0.796_979_254_439_163_8),
            Complex::new(-0.768_835_207_355_546_9, 0.314_414_565_479_972_4),
            Complex::new(0.19707170422482045, -0.14935848339436175),
        ]
    );

    let mut y = fixtures::complex::vector(6);
    let expect = fixtures::complex::vector(6);
    complex::gemv(
        'n',
        6,
        8,
        Complex::new(0.0, 0.0),
        &fixtures::complex::matrix_mxn(6, 8),
        6,
        &fixtures::complex::vector(6),
        1,
        Complex::new(1.0, 0.0),
        &mut y,
        1,
    );
    capproximately!(y, expect);

    let result = std::panic::catch_unwind(|| {
        complex::gemv(
            'x',
            6,
            8,
            Complex::new(0.0, 0.0),
            &[],
            6,
            &[],
            1,
            Complex::new(2.0, 0.5),
            &mut [],
            1,
        )
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::gemv(
            't',
            6,
            8,
            Complex::new(0.0, 0.0),
            &[],
            6,
            &[],
            1,
            Complex::new(2.0, 0.5),
            &mut [],
            1,
        )
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::gemv(
            't',
            6,
            8,
            Complex::new(0.0, 0.0),
            &[],
            6,
            &[],
            1,
            Complex::new(2.0, 0.5),
            &mut [],
            1,
        )
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::gemv(
            't',
            6,
            8,
            Complex::new(0.0, 0.0),
            &[],
            6,
            &[],
            1,
            Complex::new(2.0, 0.5),
            &mut [],
            1,
        )
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::gemv(
            't',
            6,
            8,
            Complex::new(0.0, 0.0),
            &[],
            6,
            &[],
            0,
            Complex::new(2.0, 0.5),
            &mut [],
            1,
        )
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::gemv(
            't',
            6,
            8,
            Complex::new(0.0, 0.0),
            &[],
            6,
            &[],
            1,
            Complex::new(2.0, 0.5),
            &mut [],
            0,
        )
    });
    assert!(result.is_err());
}

#[test]
fn gerc() {
    let mut a = fixtures::complex::matrix_mxn(6, 8);
    let y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
        Complex::new(-0.9120683669483379, 1.2560188173061),
        Complex::new(-1.4375862408299789, 0.6466743904953449),
    ];

    complex::gerc(
        6,
        8,
        Complex::new(0.2, 0.8),
        &fixtures::complex::vector(6),
        1,
        &y,
        1,
        &mut a,
        6,
    );
    capproximately!(
        a,
        vec![
            Complex::new(1.4664377569938685, 1.8060944675544837),
            Complex::new(-0.532_250_929_966_431_1, -0.456_340_914_406_035_5),
            Complex::new(1.3676711769934335, 0.583_648_172_612_306_5),
            Complex::new(1.527_364_796_030_794, -1.225_424_538_318_252),
            Complex::new(1.1563959711297374, 2.147_494_969_165_493),
            Complex::new(-1.7831775159348064, 0.505_513_858_611_103_9),
            Complex::new(-0.759_411_695_954_748, -0.573_405_021_798_593_3),
            Complex::new(-0.282_242_780_335_802_1, -0.782_132_647_069_526_8),
            Complex::new(-0.16007534447744504, -1.1160014767921838),
            Complex::new(2.163_520_215_729_121, -1.0386515298872647),
            Complex::new(0.786_195_669_283_649_7, -1.7700218301387962),
            Complex::new(-0.789_707_534_957_676_4, 1.2175962397684426),
            Complex::new(-1.4891467992751752, 0.272_231_550_518_112_3),
            Complex::new(-0.12951010544349723, -0.255_324_532_771_818_1),
            Complex::new(-0.17490710560589115, 0.763_369_371_727_741_7),
            Complex::new(-0.381_229_528_321_275, 0.38852989041687136),
            Complex::new(-0.391_953_985_377_264_1, 2.3235693548980874),
            Complex::new(-0.697_589_729_153_251, -0.810_815_319_723_697_8),
            Complex::new(0.43568331003189087, -5.487_747_490_406_036_4E-2),
            Complex::new(-1.237_538_456_916_809, 0.25014132261276245),
            Complex::new(-0.224_267_885_088_920_6, 0.618_243_277_072_906_5),
            Complex::new(0.377_395_659_685_134_9, -0.17262350022792816),
            Complex::new(0.133_336_365_222_930_9, -2.223_900_318_145_752),
            Complex::new(0.804_189_503_192_901_6, -1.2636144161224365),
            Complex::new(-0.528_258_715_911_044_7, 1.0515473739625048),
            Complex::new(0.386_610_848_135_189_1, -0.18238536895940438),
            Complex::new(1.5987282580693853, -1.3477283962554565),
            Complex::new(0.183_471_503_102_556, -0.554_946_903_658_442_8),
            Complex::new(-1.081_668_691_030_354, -3.246_252_501_847_624E-3),
            Complex::new(-7.384_898_387_396_434E-2, 2.431_208_936_966_286_5E-2),
            Complex::new(-4.708_568_105_620_164_5E-2, -1.5882927279464436),
            Complex::new(-0.522_361_957_727_982_9, 0.424_194_171_513_685),
            Complex::new(-0.612_062_112_584_27, 0.326_207_230_722_947),
            Complex::new(-0.934_658_749_665_058_5, 0.12460202594829736),
            Complex::new(0.730_575_213_162_826_6, -0.22989490997416154),
            Complex::new(1.1698956214925516, 0.329_273_918_684_668_6),
            Complex::new(1.2157758131530922, 2.5345520058413213),
            Complex::new(-0.742_831_404_695_631_7, -0.389_875_607_599_700_3),
            Complex::new(1.3678114595993076, 0.32901162588415334),
            Complex::new(0.21513199437223562, -0.152_035_276_348_965_2),
            Complex::new(2.854_043_963_103_028, 1.0935453027260844),
            Complex::new(0.193_406_149_484_849_7, -1.651_250_622_254_912),
            Complex::new(0.385_940_721_167_872_5, 7.923_439_505_793_217E-2),
            Complex::new(-1.1402800589724982, -0.19270504442970846),
            Complex::new(-1.5574412841395437, -0.953_095_806_342_415_9),
            Complex::new(-1.3486081371207643, 0.899_778_276_927_390_1),
            Complex::new(-0.255_191_371_935_895_8, 0.808_781_440_817_596),
            Complex::new(0.776_643_189_039_122_7, -0.711_734_795_703_724_6),
        ]
    );

    let mut a = fixtures::complex::matrix_mxn(6, 8);
    complex::gerc(
        6,
        8,
        Complex::new(0.2, 0.8),
        &fixtures::complex::vector(6),
        -1,
        &fixtures::complex::vector(8),
        -1,
        &mut a,
        6,
    );
    capproximately!(
        a,
        vec![
            Complex::new(0.883_060_368_146_788_7, 1.079_434_847_698_375),
            Complex::new(0.982_357_366_782_137, -0.38432509127926684),
            Complex::new(1.046_781_777_391_87, -0.266_570_895_664_773),
            Complex::new(0.881_558_607_141_584_2, -1.2266749209248053),
            Complex::new(0.10640467108044993, 1.8599184957333317),
            Complex::new(-0.701_225_319_967_915_5, 1.5685475206682837),
            Complex::new(-1.2959069761255018, -0.564_084_581_119_124_1),
            Complex::new(0.801_420_422_939_987_7, -0.153_139_427_326_863_6),
            Complex::new(0.488_711_108_954_625_2, -2.591_035_167_630_093),
            Complex::new(2.5341606321914707, -2.066_378_288_628_481),
            Complex::new(0.450_275_127_401_231_1, -1.6274243463177331),
            Complex::new(-0.575_393_830_249_007_4, 2.4281348267336553),
            Complex::new(-1.1296731508234275, 0.903_982_648_667_044_7),
            Complex::new(-0.285_637_101_204_467_7, -0.476_379_988_681_498_9),
            Complex::new(-0.584_402_217_234_409_7, 0.325_451_208_852_064),
            Complex::new(-0.590_262_607_827_342_5, -0.29890814896817697),
            Complex::new(0.272_749_787_867_949_1, 2.499_617_561_186_918),
            Complex::new(-0.703_300_231_193_721_5, -0.958_533_416_270_418_3),
            Complex::new(0.315_108_155_230_640_4, -0.272_828_866_555_324_9),
            Complex::new(-1.0346078437479442, 1.0618637752882218),
            Complex::new(0.650_157_468_759_790_2, 0.179_121_698_665_089_3),
            Complex::new(0.890_354_502_852_786_9, -0.579_702_744_681_321_7),
            Complex::new(1.633_922_500_057_602_4E-2, -2.3952402088207974),
            Complex::new(0.333_037_561_582_193_8, -0.570_795_927_810_566_5),
            Complex::new(0.22244130892187952, 0.276_858_934_901_104_1),
            Complex::new(-0.474_589_243_112_644_3, 1.298_858_963_754_859_2E-2),
            Complex::new(1.3633048638346255, 0.169_492_643_929_505_7),
            Complex::new(-0.357_563_175_575_860_7, 0.573_629_946_469_943_4),
            Complex::new(-1.0591575896740089, -0.904_673_317_416_639_8),
            Complex::new(-0.623_430_166_921_521_9, -0.47254182333647243),
            Complex::new(-4.137_517_901_573_115E-2, -1.4405746313997232),
            Complex::new(-1.1870657309731962, 0.24814596522485438),
            Complex::new(-0.403_029_033_078_202_5, 1.0136452701079954),
            Complex::new(-0.525_163_638_036_54, 0.562_520_188_823_975),
            Complex::new(0.886_702_208_923_797, -8.839_454_064_480_75E-3),
            Complex::new(0.810_421_973_040_803_8, -0.302_477_179_464_263_8),
            Complex::new(1.001_462_108_444_423, 1.3240134188761086),
            Complex::new(-0.406_910_862_813_213_1, -0.532_473_091_420_763_5),
            Complex::new(0.997_171_043_136_957_8, 1.3567383846253696),
            Complex::new(-0.43365445905983463, 1.3229984144889442),
            Complex::new(1.770_380_759_827_238, 0.464_552_082_983_421_2),
            Complex::new(0.729_901_429_655_603_6, -1.6605710629343813),
            Complex::new(-0.696_011_474_799_018_5, -0.983_799_266_999_247_7),
            Complex::new(-9.028_875_892_321_064E-2, 9.487_142_900_245_299E-2),
            Complex::new(-0.911_635_095_250_334, -0.951_845_423_735_862_3),
            Complex::new(-1.0277187375192007, 1.7499973452044695),
            Complex::new(-1.769_799_668_684_464, 0.736_765_617_690_827_3),
            Complex::new(1.3600205778862025, 1.492_482_415_238_405_3E-2),
        ]
    );

    let mut a = fixtures::complex::matrix_mxn(6, 8);
    let expect = fixtures::complex::matrix_mxn(6, 8);
    complex::gerc(
        6,
        8,
        Complex::new(0.0, 0.0),
        &fixtures::complex::vector(6),
        -1,
        &fixtures::complex::vector(8),
        -1,
        &mut a,
        6,
    );
    capproximately!(a, expect);

    let result = std::panic::catch_unwind(|| {
        complex::gerc(
            6,
            8,
            Complex::new(0.0, 0.0),
            &[],
            1,
            &[],
            1,
            &mut [],
            2,
        )
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::gerc(
            6,
            8,
            Complex::new(0.0, 0.0),
            &[],
            0,
            &[],
            1,
            &mut [],
            6,
        )
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::gerc(
            6,
            8,
            Complex::new(0.0, 0.0),
            &[],
            1,
            &[],
            0,
            &mut [],
            6,
        )
    });
    assert!(result.is_err());
}

#[test]
fn geru() {
    let mut a = fixtures::complex::matrix_mxn(6, 8);
    let y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
        Complex::new(-0.9120683669483379, 1.2560188173061),
        Complex::new(-1.4375862408299789, 0.6466743904953449),
    ];

    complex::geru(
        6,
        8,
        Complex::new(0.2, 0.8),
        &fixtures::complex::vector(6),
        1,
        &y,
        1,
        &mut a,
        6,
    );
    capproximately!(
        a,
        vec![
            Complex::new(2.0297612143617068, 0.651_717_581_050_238_8),
            Complex::new(-0.31722765173412737, -0.22195137259592293),
            Complex::new(0.678_385_258_703_856_5, 1.3135933588490314),
            Complex::new(0.29660221113116736, -0.36776314720236125),
            Complex::new(0.670_850_480_221_652, 0.960_194_795_546_000_3),
            Complex::new(-1.5525255484272074, 0.809_848_606_035_610_7),
            Complex::new(-0.919_561_346_430_553_8, -0.24522224781145335),
            Complex::new(-0.343_372_673_654_942_6, -0.848_768_258_821_733),
            Complex::new(3.588_471_620_912_579E-2, -1.3235207357780114),
            Complex::new(2.5134190087092048, -1.2824797785023652),
            Complex::new(0.924_233_486_885_585_2, -1.432_479_153_142_01),
            Complex::new(-0.855_280_575_623_331_9, 1.131_075_604_438_585),
            Complex::new(-1.7990710725491952, 0.907_336_325_500_947_8),
            Complex::new(-0.247_809_694_021_838_6, -0.384_278_879_441_417_8),
            Complex::new(0.20431807046274741, 0.36177464242009244),
            Complex::new(0.29590044861983555, -8.333_060_088_734_401E-2),
            Complex::new(-0.12482089968205246, 2.976_787_570_213_521),
            Complex::new(-0.824_487_770_543_239_9, -0.978_251_495_501_450_4),
            Complex::new(0.43568331003189087, -5.487_747_490_406_036_4E-2),
            Complex::new(-1.237_538_456_916_809, 0.25014132261276245),
            Complex::new(-0.224_267_885_088_920_6, 0.618_243_277_072_906_5),
            Complex::new(0.377_395_659_685_134_9, -0.17262350022792816),
            Complex::new(0.133_336_365_222_930_9, -2.223_900_318_145_752),
            Complex::new(0.804_189_503_192_901_6, -1.2636144161224365),
            Complex::new(0.19910226600661174, -0.43897941786342354),
            Complex::new(0.664_248_039_955_653_5, 0.12025746448274954),
            Complex::new(0.708_725_053_353_302_2, -0.405_226_108_337_199_3),
            Complex::new(-1.4056841951938006, 0.552_462_034_200_805_1),
            Complex::new(-1.708_603_075_553_924, -1.5362834602014517),
            Complex::new(0.22396790866494898, 0.417_267_890_913_369_8),
            Complex::new(-0.248_282_088_129_622_8, -1.1759958868766818),
            Complex::new(-0.599_159_595_837_412_7, 0.340_479_685_544_770_9),
            Complex::new(-0.36587699745669194, 6.550_026_581_580_273E-2),
            Complex::new(-0.495_080_019_535_048_4, -0.18172001358543421),
            Complex::new(0.903_992_469_205_863_5, 0.194_160_800_693_514_5),
            Complex::new(1.0875160462414502, 0.22057782778244783),
            Complex::new(2.1321159056388295, 0.656_764_370_500_628_5),
            Complex::new(-0.39305997571479284, -8.601_702_508_755_527E-3),
            Complex::new(0.24657229610721754, 1.5163899086758028),
            Complex::new(-1.7869097919659473, 1.2430948361600873),
            Complex::new(2.0642227791536065, -0.837_797_581_496_107),
            Complex::new(0.568_600_263_050_619_1, -1.1561991079710021),
            Complex::new(0.857_728_002_108_859_6, -0.887_564_209_441_390_6),
            Complex::new(-0.960_196_580_378_788_1, 3.597_813_484_814_804_7E-3),
            Complex::new(-2.134_722_994_899_912, -0.34176167823825904),
            Complex::new(-2.379_380_290_879_2, 1.6180756075113232),
            Complex::new(-0.661_839_069_511_006_4, -0.185_590_643_721_631_7),
            Complex::new(0.969_815_802_696_222_3, -0.456_852_345_655_999),
        ]
    );

    let mut a = fixtures::complex::matrix_mxn(6, 8);
    complex::geru(
        6,
        8,
        Complex::new(0.2, 0.8),
        &fixtures::complex::vector(6),
        -1,
        &fixtures::complex::vector(8),
        -1,
        &mut a,
        6,
    );
    capproximately!(
        a,
        vec![
            Complex::new(1.0762329818038883, 1.3343172977461006),
            Complex::new(0.575_709_669_207_026_5, -1.3786971758184945),
            Complex::new(1.600_962_363_343_394_5E-2, 0.451_726_434_919_160_1),
            Complex::new(0.30427689638121636, -0.615_340_792_820_648_7),
            Complex::new(0.286_488_149_674_159_9, 2.056_221_353_647_855),
            Complex::new(-0.229_438_039_026_928_4, 0.601_748_916_168_961),
            Complex::new(-0.920_712_862_559_732_5, -6.903_306_683_521_415E-2),
            Complex::new(1.159_923_899_056_647_4E-2, -2.084_482_311_549_055),
            Complex::new(-1.5133306773835578, -1.1959050551210406),
            Complex::new(1.4129214686993805, -0.879_000_005_836_831_6),
            Complex::new(0.800_046_556_382_069_9, -1.2461504412267883),
            Complex::new(0.34094626223672986, 0.550_347_191_392_962_5),
            Complex::new(-1.2120527260745289, 0.795_286_557_764_823_9),
            Complex::new(-0.112_219_845_161_430_8, -5.232_427_801_382_289E-2),
            Complex::new(-0.14482348710439957, 1.912_916_931_833_241_7E-2),
            Complex::new(-0.34407749269976445, -0.559_615_113_875_321_3),
            Complex::new(0.19595214975851932, 2.415_903_075_218_004),
            Complex::new(-0.904_496_638_267_142_7, -0.546_236_575_200_656_5),
            Complex::new(0.612_925_047_769_553_7, 0.120_126_934_988_382),
            Complex::new(-1.6615422282715144, -0.471_173_432_411_382_2),
            Complex::new(-0.938_998_229_536_566_3, 1.2865306365243372),
            Complex::new(3.512_981_367_036_483E-4, 0.36279954323693553),
            Complex::new(0.293_976_416_821_040_5, -2.0925973753786433),
            Complex::new(1.0603985434998502, -2.061_322_719_636_495),
            Complex::new(9.728_484_675_146_779E-2, 0.11172069344247793),
            Complex::new(-0.21112235609010166, 0.657_241_881_167_071_6),
            Complex::new(2.031_141_746_226_159, -0.29589192058188163),
            Complex::new(1.645_742_303_084_629_7E-2, 0.177_546_799_749_328_9),
            Complex::new(-1.175_833_606_265_771, -1.0318578636387787),
            Complex::new(-0.929_100_964_979_815_4, 0.15384662106908503),
            Complex::new(-0.16827322040571996, -1.6080108071774757),
            Complex::new(-0.919_932_645_277_984_5, 0.901_364_180_540_288),
            Complex::new(0.27410094386290806, 0.541_784_778_803_78),
            Complex::new(-0.145_938_461_967_901_4, 0.160_925_459_516_325_8),
            Complex::new(0.768_402_620_345_455_7, -0.137_793_800_734_080_4),
            Complex::new(0.500_497_699_766_783_7, 0.332_627_595_518_571_7),
            Complex::new(0.935_889_067_778_767_7, 1.237_492_783_546_251),
            Complex::new(-0.26887304521127764, -0.19493041442397727),
            Complex::new(1.3470698361170415, 1.1129101360102691),
            Complex::new(-0.237_694_398_373_263_8, 1.1154791555031165),
            Complex::new(1.7092508665080977, 0.397_916_471_231_215),
            Complex::new(0.569_751_779_179_797_8, -1.3323882889472414),
            Complex::new(-0.465_359_507_291_419_4, -0.679_464_519_574_740_9),
            Complex::new(-0.575_834_249_831_296, -1.092_428_744_617_04),
            Complex::new(-2.1423976801499607, -9.418_403_261_997_166E-2),
            Complex::new(-1.7170046558087777, 2.4799425314411945),
            Complex::new(-1.554_776_390_452_16, 0.971_155_159_500_939_9),
            Complex::new(1.923_344_035_254_041, -1.139_452_062_351_861),
        ]
    );

    let mut a = fixtures::complex::matrix_mxn(6, 8);
    let expect = fixtures::complex::matrix_mxn(6, 8);
    complex::geru(
        6,
        8,
        Complex::new(0.0, 0.0),
        &fixtures::complex::vector(6),
        -1,
        &fixtures::complex::vector(8),
        -1,
        &mut a,
        6,
    );
    capproximately!(a, expect);

    let result = std::panic::catch_unwind(|| {
        complex::geru(
            6,
            8,
            Complex::new(0.0, 0.0),
            &[],
            1,
            &[],
            1,
            &mut [],
            2,
        )
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::geru(
            6,
            8,
            Complex::new(0.0, 0.0),
            &[],
            0,
            &[],
            1,
            &mut [],
            6,
        )
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::geru(
            6,
            8,
            Complex::new(0.0, 0.0),
            &[],
            1,
            &[],
            0,
            &mut [],
            6,
        )
    });
    assert!(result.is_err());
}

#[test]
fn hbmv() {
    let a = matrix::complex::upper_band(
        matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6),
        6,
        6,
        3,
    );
    let x = fixtures::complex::vector(6);
    let mut y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::hbmv(
        'u',
        6,
        3,
        Complex::new(0.2, 0.8),
        &a,
        4,
        &x,
        1,
        Complex::new(0.3, -0.7),
        &mut y,
        1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(-1.253_461_037_102_373, 9.470_333_172_935_463E-2),
            Complex::new(-0.574_178_530_277_177_6, -6.998_351_199_238_861E-3),
            Complex::new(-0.24071061122272883, -0.243_862_264_599_288_8),
            Complex::new(-1.963_907_568_735_629E-3, 0.898_912_714_457_956_7),
            Complex::new(1.5460009072147165, 0.250_693_020_062_130_3),
            Complex::new(-1.0003110232032266, -0.498_522_992_753_485_1)
        ]
    );

    let mut y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::hbmv(
        'u',
        6,
        3,
        Complex::new(0.2, 0.8),
        &a,
        4,
        &x,
        -1,
        Complex::new(0.0, 0.0),
        &mut y,
        -1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(-1.2736547002392706, -1.2409869471212633),
            Complex::new(-1.5069594023144455, 0.16300769978973884),
            Complex::new(1.3847341260375996, 0.252_548_479_494_579_4),
            Complex::new(0.415_266_505_942_378_1, -0.14984859659953415),
            Complex::new(-1.1204385690487695, -0.345_925_489_465_966),
            Complex::new(0.862_494_080_011_751_7, -0.569_094_571_278_325_1),
        ]
    );

    let mut y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];

    complex::hbmv(
        'u',
        6,
        3,
        Complex::new(0.0, 0.0),
        &a,
        4,
        &x,
        -1,
        Complex::new(0.0, 0.0),
        &mut y,
        -1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(0.0, 0.0),
            Complex::new(0.0, 0.0),
            Complex::new(0.0, 0.0),
            Complex::new(0.0, 0.0),
            Complex::new(0.0, 0.0),
            Complex::new(0.0, 0.0),
        ]
    );

    let mut y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    let expect = [Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723)];
    complex::hbmv(
        'u',
        6,
        3,
        Complex::new(0.0, 0.0),
        &a,
        4,
        &x,
        -1,
        Complex::new(1.0, 0.0),
        &mut y,
        -1,
    );
    capproximately!(y, expect);

    let mut y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::hbmv(
        'u',
        6,
        3,
        Complex::new(0.2, 0.8),
        &a,
        4,
        &x,
        -1,
        Complex::new(1.0, 0.0),
        &mut y,
        -1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(-1.922_664_762_456_983, -0.46884477526152213),
            Complex::new(-1.5069594023144455, 0.16300769978973884),
            Complex::new(2.0488698205413836, -0.172_261_810_842_029_5),
            Complex::new(0.415_266_505_942_378_1, -0.14984859659953415),
            Complex::new(-0.976_667_084_554_560_2, 0.651_061_376_531_348_2),
            Complex::new(0.744_740_484_897_997_4, -0.844_872_596_667_042_7),
        ]
    );

    let a = matrix::complex::lower_band(
        matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6),
        6,
        6,
        3,
    );
    let mut y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::hbmv(
        'l',
        6,
        3,
        Complex::new(0.2, 0.8),
        &a,
        4,
        &x,
        1,
        Complex::new(1.0, 0.0),
        &mut y,
        1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(0.796_546_869_476_565_2, 0.932_308_725_088_862),
            Complex::new(3.823_573_103_004_452E-2, 3.649_712_157_736_522),
            Complex::new(0.383_124_517_282_255_4, -3.0675595198095778),
            Complex::new(-1.6321936347511552, -2.199_708_105_494_132),
            Complex::new(3.185_750_119_336_706, 7.729_882_066_971_816E-2),
            Complex::new(0.285_037_408_236_255, 1.0786387593676938),
        ]
    );

    let result = std::panic::catch_unwind(|| {
        complex::hbmv(
            'l',
            6,
            4,
            Complex::new(0.0, 0.0),
            &a,
            4,
            &x,
            1,
            Complex::new(1.0, 0.0),
            &mut fixtures::complex::vector(6),
            1,
        );
    });
    assert!(result.is_err());

    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::hbmv(
            'l',
            6,
            4,
            Complex::new(0.2, 0.8),
            &a,
            5,
            &x,
            0,
            Complex::new(1.0, 0.0),
            &mut fixtures::complex::vector(6),
            1,
        );
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::hbmv(
            'l',
            6,
            4,
            Complex::new(0.0, 0.0),
            &a,
            5,
            &x,
            1,
            Complex::new(1.0, 0.0),
            &mut fixtures::complex::vector(6),
            0,
        );
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::hbmv(
            'x',
            6,
            4,
            Complex::new(0.0, 0.0),
            &a,
            5,
            &x,
            1,
            Complex::new(1.0, 0.0),
            &mut fixtures::complex::vector(6),
            1,
        );
    });
    assert!(result.is_err());
}

#[test]
fn hemv() {
    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut a, 6, 6, 0.0);
    let x = fixtures::complex::vector(6);
    let mut y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::hemv(
        'u',
        6,
        Complex::new(0.2, 0.8),
        &a,
        6,
        &x,
        1,
        Complex::new(0.3, -0.7),
        &mut y,
        1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(-1.1978771580109713, 0.192_561_699_480_018_9),
            Complex::new(-0.644_063_912_327_340_5, 0.12304172454730536),
            Complex::new(-0.24071061122272883, -0.243_862_264_599_288_8),
            Complex::new(-1.963_907_568_735_629E-3, 0.898_912_714_457_956_7),
            Complex::new(1.5927182864486373, 0.263_267_738_432_563_6),
            Complex::new(-1.0745919479739299, -0.10110828501746819),
        ]
    );

    let mut y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::hemv(
        'u',
        6,
        Complex::new(-0.12, 0.88),
        &a,
        6,
        &x,
        -1,
        Complex::new(-0.43, 0.57),
        &mut y,
        -1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(-0.537_271_756_875_239_9, -2.311_265_652_320_936),
            Complex::new(-1.5860492969147173, -0.43291167355929333),
            Complex::new(1.2402782186527825, 1.367_667_879_363_657),
            Complex::new(0.47520593481607637, 1.625_800_436_478_305_7E-2),
            Complex::new(-1.120_676_071_390_117, -0.929_939_941_089_230_1),
            Complex::new(1.669_952_422_368_981, -0.23413210623927322)
        ]
    );

    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_upper(&mut a, 6, 6, 0.0);
    let mut y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::hemv(
        'l',
        6,
        Complex::new(-0.12, 0.88),
        &a,
        6,
        &x,
        -1,
        Complex::new(-0.43, 0.57),
        &mut y,
        -1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(-0.821_092_091_359_9, -2.8288933164643106),
            Complex::new(1.8186627440037402, -1.920_176_507_881_905),
            Complex::new(-4.802_570_715_015_76, 2.6701570029481525),
            Complex::new(2.3815496358250265, 0.207_428_911_074_460_1),
            Complex::new(-1.7405950102646242, 2.957_411_090_170_507),
            Complex::new(3.6227184273789095, 3.3816196677830903),
        ]
    );

    let mut y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];

    complex::hemv(
        'l',
        6,
        Complex::new(0.0, 0.0),
        &a,
        6,
        &x,
        -1,
        Complex::new(0.0, 0.0),
        &mut y,
        -1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(0.0, 0.0),
            Complex::new(0.0, 0.0),
            Complex::new(0.0, 0.0),
            Complex::new(0.0, 0.0),
            Complex::new(0.0, 0.0),
            Complex::new(0.0, 0.0),
        ]
    );

    let mut y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];

    complex::hemv(
        'l',
        6,
        Complex::new(0.0, 0.0),
        &a,
        6,
        &x,
        -1,
        Complex::new(1.0, 0.0),
        &mut y,
        -1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(-0.6490100777088978, 0.7721421858045301),
            Complex::new(0.0, 0.0),
            Complex::new(0.6641356998941105, -0.4248102833772871),
            Complex::new(0.0, 0.0),
            Complex::new(0.14377148075806995, 0.9969868609091059),
            Complex::new(-0.11775359816595128, -0.27577802908802723),
        ]
    );

    let mut y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::hemv(
        'l',
        6,
        Complex::new(0.0, 1.0),
        &a,
        6,
        &x,
        -1,
        Complex::new(1.0, 0.0),
        &mut y,
        -1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(-1.7089394711323604, -1.5002952495366637),
            Complex::new(1.7368180095711416, -2.4188575862567556),
            Complex::new(-4.324_411_969_236_994, 2.6519589765813314),
            Complex::new(2.688_457_354_507_543, -0.13089314190862256),
            Complex::new(-0.592_450_622_960_786_4, 4.852_114_563_553_646),
            Complex::new(4.198_578_266_626_858, 2.919_897_959_466_539),
        ]
    );

    let result = std::panic::catch_unwind(|| {
        complex::hemv(
            'l',
            6,
            Complex::new(0.0, 0.0),
            &a,
            5,
            &x,
            1,
            Complex::new(1.0, 0.0),
            &mut fixtures::complex::vector(6),
            1,
        );
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::hemv(
            'l',
            6,
            Complex::new(0.0, 0.0),
            &a,
            6,
            &x,
            0,
            Complex::new(1.0, 0.0),
            &mut fixtures::complex::vector(6),
            1,
        );
    });

    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::hemv(
            'l',
            6,
            Complex::new(0.2, 0.8),
            &a,
            5,
            &x,
            1,
            Complex::new(1.0, 0.0),
            &mut fixtures::complex::vector(6),
            0,
        );
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::hemv(
            'x',
            6,
            Complex::new(0.0, 0.0),
            &a,
            5,
            &x,
            1,
            Complex::new(1.0, 0.0),
            &mut fixtures::complex::vector(6),
            1,
        );
    });
    assert!(result.is_err());
}

#[test]
fn her() {
    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut a, 6, 6, 0.0);
    let x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];

    complex::her('u', 6, 0.2, &x, 1, &mut a, 6);
    capproximately!(
        a,
        vec![
            Complex::new(1.4664377569938685, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.928_567_051_887_512_2, -0.832_043_290_138_244_6),
            Complex::new(-0.29472044110298157, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-1.2994659767673966, -0.17990848227932066),
            Complex::new(-0.28946158289909363, 0.26613736152648926),
            Complex::new(-0.17490710560589112, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.43568331003189087, 0.25014132261276245),
            Complex::new(-1.237_538_456_916_809, 0.618_243_277_072_906_5),
            Complex::new(-0.224_267_885_088_920_6, -0.17262350022792816),
            Complex::new(0.377_395_659_685_134_9, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(7.819_452_050_182_624E-2, 0.14056783081885876),
            Complex::new(0.503_607_988_357_544, -0.940_649_151_802_063),
            Complex::new(1.020_160_112_863_738, -0.260_467_361_552_037_5),
            Complex::new(-0.690_953_850_746_154_8, -0.814_968_705_177_307_1),
            Complex::new(-1.081_668_691_030_354, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.263_009_868_346_711_8, 0.31196009025279664),
            Complex::new(-0.542_888_283_729_553_2, 0.24841265380382538),
            Complex::new(-0.425_520_534_325_486_6, 0.11192357318741848),
            Complex::new(-0.649_471_640_586_853, 1.915_639_080_107_212E-2),
            Complex::new(0.668_375_394_914_888_4, 0.241_788_420_291_149_6),
            Complex::new(1.1698956214925516, 0.0000000000000000),
        ]
    );

    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut a, 6, 6, 0.0);
    complex::her('u', 6, 0.2, &x, -1, &mut a, 6);
    capproximately!(
        a,
        vec![
            Complex::new(1.2809381210347879, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.986_942_388_440_824_5, -0.816_493_335_576_26),
            Complex::new(-9.178_982_793_411_669E-2, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-1.147_657_036_781_311, -0.22732868790626526),
            Complex::new(-0.28946158289909363, 0.26613736152648926),
            Complex::new(-0.299_215_108_156_204_2, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.443_473_105_620_497_3, 0.203_505_928_048_066_6),
            Complex::new(-1.3031477589548044, 0.762_885_313_374_318_3),
            Complex::new(-0.224_267_885_088_920_6, -0.17262350022792816),
            Complex::new(0.501_703_662_235_448, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-5.710_677_430_033_684E-2, -1.104_547_828_435_897_8E-2),
            Complex::new(0.503_607_988_357_544, -0.940_649_151_802_063),
            Complex::new(1.0857694149017334, -0.11582532525062561),
            Complex::new(-0.690_953_850_746_154_8, -0.814_968_705_177_307_1),
            Complex::new(-1.2845993041992188, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.263_009_868_346_711_8, 0.41992218389805175),
            Complex::new(-0.40758698892739015, 9.679_934_470_060_764E-2),
            Complex::new(-0.433_310_329_914_093, 6.528_817_862_272_263E-2),
            Complex::new(-0.801_280_580_572_938_7, -2.826_381_482_587_249_4E-2),
            Complex::new(0.726_750_731_468_200_7, 0.25733837485313416),
            Complex::new(1.3553952574516321, 0.0000000000000000),
        ]
    );

    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut a, 6, 6, 0.0);
    complex::her('u', 6, 0.0, &x, -1, &mut a, 6);
    capproximately!(
        a,
        vec![
            Complex::new(1.2629542350769043, -0.429_513_096_809_387_2),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.928_567_051_887_512_2, -0.832_043_290_138_244_6),
            Complex::new(-0.29472044110298157, -1.1665705442428589),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-1.147_657_036_781_311, -0.22732868790626526),
            Complex::new(-0.28946158289909363, 0.26613736152648926),
            Complex::new(-0.299_215_108_156_204_2, -0.376_702_725_887_298_6),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.43568331003189087, 0.25014132261276245),
            Complex::new(-1.237_538_456_916_809, 0.618_243_277_072_906_5),
            Complex::new(-0.224_267_885_088_920_6, -0.17262350022792816),
            Complex::new(0.377_395_659_685_134_9, -2.223_900_318_145_752),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-5.710_677_430_033_684E-2, -1.104_547_828_435_897_8E-2),
            Complex::new(0.503_607_988_357_544, -0.940_649_151_802_063),
            Complex::new(1.0857694149017334, -0.11582532525062561),
            Complex::new(-0.690_953_850_746_154_8, -0.814_968_705_177_307_1),
            Complex::new(-1.2845993041992188, 0.24226348102092743),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.23570655286312103, 0.365_941_137_075_424_2),
            Complex::new(-0.542_888_283_729_553_2, 0.24841265380382538),
            Complex::new(-0.433_310_329_914_093, 6.528_817_862_272_263E-2),
            Complex::new(-0.649_471_640_586_853, 1.915_639_080_107_212E-2),
            Complex::new(0.726_750_731_468_200_7, 0.25733837485313416),
            Complex::new(1.151_911_735_534_668, 0.0000000000000000),
        ]
    );

    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_upper(&mut a, 6, 6, 0.0);
    complex::her('l', 6, 1.234, &x, -1, &mut a, 6);
    capproximately!(
        a,
        vec![
            Complex::new(1.3739148068679738, 0.0000000000000000),
            Complex::new(-0.686_409_168_893_904_7, 1.1423609224868452),
            Complex::new(1.3297992944717407, -0.279_346_287_250_518_8),
            Complex::new(1.320_492_383_840_858, 2.0456434716758203),
            Complex::new(0.41464143991470337, 0.560_746_073_722_839_4),
            Complex::new(-1.7084114627576494, -0.785_847_017_205_845_9),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.957_361_390_591_390_2, 0.0000000000000000),
            Complex::new(-5.767_172_668_129_206E-3, -1.0655906200408936),
            Complex::new(1.9998439338703389, -2.4562234231403806),
            Complex::new(0.763_593_435_287_475_6, 1.1565370559692383),
            Complex::new(3.579_969_103_857_805E-2, 1.7675011834827594),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.299_215_108_156_204_2, 0.0000000000000000),
            Complex::new(-0.411_510_825_157_165_5, 2.4413645267486572),
            Complex::new(0.252_223_461_866_378_8, -0.795_339_107_513_427_7),
            Complex::new(-0.891_921_103_000_640_9, -5.487_747_490_406_036_4E-2),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(1.1443760038382795, 0.0000000000000000),
            Complex::new(0.133_336_365_222_930_9, -1.2636144161224365),
            Complex::new(-0.13247161795193985, 0.651_311_542_321_078_2),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-1.2845993041992188, 0.0000000000000000),
            Complex::new(4.672_617_092_728_615E-2, -1.4250984191894531),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(2.4074050140643375, 0.0000000000000000),
        ]
    );

    let result = std::panic::catch_unwind(|| {
        complex::her('l', 6, 1.2, &x, 1, &mut [], 5);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::her('l', 6, 0.2, &x, 0, &mut [], 6);
    });

    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::her('x', 6, 0.1, &x, 1, &mut [], 6);
    });

    assert!(result.is_err());
}

#[test]
fn her2() {
    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut a, 6, 6, 0.0);
    let y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    let x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];

    complex::her2('u', 6, Complex::new(0.2, 0.8), &x, 1, &y, 1, &mut a, 6);
    capproximately!(
        a,
        vec![
            Complex::new(1.6699212789108326, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.759_411_695_954_748, -0.952_664_339_911_920_3),
            Complex::new(-0.29472044110298157, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-1.4512749167534824, -0.13248827665237595),
            Complex::new(-0.44376975470840946, 0.21556829407581407),
            Complex::new(-5.059_910_305_557_807_6E-2, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.43568331003189087, 0.25014132261276245),
            Complex::new(-1.237_538_456_916_809, 0.618_243_277_072_906_5),
            Complex::new(-0.224_267_885_088_920_6, -0.17262350022792816),
            Complex::new(0.377_395_659_685_134_9, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.213_495_815_303_989_3, 0.292_181_139_922_076_5),
            Complex::new(0.526_210_222_353_718_1, -0.734_409_417_572_385_3),
            Complex::new(0.954_550_810_825_742_4, -0.405_109_397_853_449_3),
            Complex::new(-0.690_953_850_746_154_8, -0.814_968_705_177_307_1),
            Complex::new(-0.878_738_077_861_489, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.290_313_183_830_302_6, 0.257_979_043_430_169_1),
            Complex::new(-0.533_586_555_171_757_2, 0.18735347000462102),
            Complex::new(-0.41773073873688016, 0.15855896775211434),
            Complex::new(-0.649_471_640_586_853, 1.915_639_080_107_212E-2),
            Complex::new(0.610_000_058_361_576_1, 0.22623846572916503),
            Complex::new(1.1878795074504351, 0.0000000000000000),
        ]
    );
    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_upper(&mut a, 6, 6, 0.0);
    complex::her2('l', 6, Complex::new(0.2, 0.8), &x, -1, &y, -1, &mut a, 6);
    capproximately!(
        a,
        vec![
            Complex::new(1.2989220069926715, 0.0000000000000000),
            Complex::new(-0.442_984_030_297_710_4, 1.2072042290596245),
            Complex::new(1.3297992944717407, -0.279_346_287_250_518_8),
            Complex::new(1.2880089382154818, 1.8511738881894504),
            Complex::new(0.42394316847249935, 0.49968688992363497),
            Complex::new(-1.5945566441278871, -0.560_746_065_670_172_7),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.11114078523474813, 0.0000000000000000),
            Complex::new(-5.767_172_668_129_206E-3, -1.0655906200408936),
            Complex::new(2.2734347066997658, -1.8530661685119423),
            Complex::new(0.786_195_669_283_649_7, 1.3627767901989158),
            Complex::new(-0.528_406_673_911_146_4, 1.1352737230419456),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.299_215_108_156_204_2, 0.0000000000000000),
            Complex::new(-0.411_510_825_157_165_5, 2.4413645267486572),
            Complex::new(0.252_223_461_866_378_8, -0.795_339_107_513_427_7),
            Complex::new(-0.891_921_103_000_640_9, -5.487_747_490_406_036_4E-2),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.626_011_664_785_761, 0.0000000000000000),
            Complex::new(-2.097_180_658_638_492_2E-2, -1.3141834835731117),
            Complex::new(0.500_571_623_220_730_2, 0.453_569_296_904_524_1),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-1.2845993041992188, 0.0000000000000000),
            Complex::new(0.21588152686005035, -1.5457194689631288),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(1.5588787793685963, 0.0000000000000000),
        ]
    );

    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut a, 6, 6, 0.0);
    let mut expect = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut expect, 6, 6, 0.0);
    complex::her2('l', 6, Complex::new(0.0, 0.0), &x, -1, &y, -1, &mut a, 6);
    capproximately!(a, expect);

    let result = std::panic::catch_unwind(|| {
        complex::her2(
            'x',
            6,
            Complex::new(0.0, 0.0),
            &x,
            -1,
            &y,
            -1,
            &mut [],
            6,
        );
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::her2(
            'l',
            6,
            Complex::new(0.0, 0.0),
            &x,
            0,
            &y,
            -1,
            &mut [],
            6,
        );
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::her2(
            'l',
            6,
            Complex::new(0.0, 0.0),
            &x,
            -1,
            &y,
            0,
            &mut [],
            6,
        );
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::her2(
            'x',
            6,
            Complex::new(0.0, 0.0),
            &x,
            -1,
            &y,
            -1,
            &mut [],
            4,
        );
    });
    assert!(result.is_err());
}

#[test]
fn hpmv() {
    let mut ap = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut ap, 6, 6, 0.0);
    let ap = matrix::complex::pack_upper(ap, 6, 6, 5);
    let mut y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];

    let x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];

    complex::hpmv(
        'u',
        6,
        Complex::new(0.2, -0.8),
        &ap,
        &x,
        1,
        Complex::new(0.3, -0.7),
        &mut y,
        1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(1.0565062967743115, 2.1785481727394473),
            Complex::new(-0.360_643_362_547_153_9, -0.895_357_968_236_418_3),
            Complex::new(0.26097073349390854, -1.107_083_237_621_097),
            Complex::new(0.18952760417765735, -0.487_866_430_643_452_5),
            Complex::new(-0.696_700_935_268_946_4, -0.670_582_249_897_040_8),
            Complex::new(0.293_600_124_627_813_6, -0.16342854670718146),
        ]
    );

    let mut y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];

    complex::hpmv(
        'l',
        6,
        Complex::new(0.2, -0.8),
        &ap,
        &x,
        -1,
        Complex::new(0.3, -0.7),
        &mut y,
        -1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(1.079_278_998_718_928, 1.781_790_988_439_861),
            Complex::new(1.163_808_409_242_132, -1.2174375200025294),
            Complex::new(-9.841_972_971_160_849E-2, -0.921_703_007_470_506_6),
            Complex::new(-1.574_256_482_841_95, -0.996_867_304_761_857_1),
            Complex::new(1.4777738731392653, 0.471_516_702_886_814_4),
            Complex::new(-1.3963398509841487, 1.3006511215030607),
        ]
    );

    let mut ap = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut ap, 6, 6, 0.0);
    let ap = matrix::complex::pack_upper(ap, 6, 6, 5);
    let mut y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];

    complex::hpmv(
        'l',
        6,
        Complex::new(0.0, 0.0),
        &ap,
        &x,
        -1,
        Complex::new(1.0, 0.0),
        &mut y,
        -1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(-0.6490100777088978, 0.7721421858045301),
            Complex::new(-0.11916876241803812, -0.21951562675343952),
            Complex::new(0.6641356998941105, -0.4248102833772871),
            Complex::new(0.0, 0.0),
            Complex::new(0.14377148075806995, 0.9969868609091059),
            Complex::new(-0.11775359816595128, -0.27577802908802723),
        ]
    );

    let mut y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];

    complex::hpmv(
        'l',
        6,
        Complex::new(0.0, 0.0),
        &ap,
        &x,
        -1,
        Complex::new(0.0, 0.0),
        &mut y,
        -1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(0.0, 0.0),
            Complex::new(0.0, 0.0),
            Complex::new(0.0, 0.0),
            Complex::new(0.0, 0.0),
            Complex::new(0.0, 0.0),
            Complex::new(0.0, 0.0)
        ]
    );

    let mut ap = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut ap, 6, 6, 0.0);
    let ap = matrix::complex::pack_upper(ap, 6, 6, 5);
    let mut y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];

    complex::hpmv(
        'l',
        6,
        Complex::new(1.0, 0.0),
        &ap,
        &x,
        -1,
        Complex::new(1.0, 0.0),
        &mut y,
        -1,
    );
    capproximately!(
        y,
        vec![
            Complex::new(-1.7225049442869467, 1.9573690212447206),
            Complex::new(1.7317793933958838, 1.0092722795253204),
            Complex::new(1.0515376006342987, -0.522_027_326_624_231_9),
            Complex::new(0.709_768_441_248_766_8, -2.1452626845418177),
            Complex::new(3.921_529_700_084_525E-2, 1.944_065_438_852_59),
            Complex::new(-1.991_811_574_684_279, -1.2672249544431136)
        ]
    );

    let result = std::panic::catch_unwind(|| {
        complex::hpmv(
            'x',
            6,
            Complex::new(0.0, 0.0),
            &[],
            &[],
            -1,
            Complex::new(0.0, 0.0),
            &mut [],
            -1,
        );
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::hpmv(
            'l',
            6,
            Complex::new(0.0, 0.0),
            &[],
            &[],
            0,
            Complex::new(0.0, 0.0),
            &mut [],
            -1,
        );
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::hpmv(
            'l',
            6,
            Complex::new(0.0, 0.0),
            &[],
            &[],
            -1,
            Complex::new(0.0, 0.0),
            &mut [],
            0,
        );
    });
    assert!(result.is_err());
}

#[test]
fn hpr() {
    let mut ap = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut ap, 6, 6, 0.0);
    let mut ap = matrix::complex::pack_upper(ap, 6, 6, 5);
    let x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::hpr('u', 6, 0.2, &x, 1, &mut ap);
    capproximately!(
        ap,
        vec![
            Complex::new(1.4664377569938685, 0.0000000000000000),
            Complex::new(-0.928_567_051_887_512_2, -0.832_043_290_138_244_6),
            Complex::new(-0.29472044110298157, 0.0000000000000000),
            Complex::new(-1.2994659767673966, -0.17990848227932066),
            Complex::new(-0.28946158289909363, 0.26613736152648926),
            Complex::new(-0.17490710560589112, 0.0000000000000000),
            Complex::new(0.43568331003189087, 0.25014132261276245),
            Complex::new(-1.237_538_456_916_809, 0.618_243_277_072_906_5),
            Complex::new(-0.224_267_885_088_920_6, -0.17262350022792816),
            Complex::new(0.377_395_659_685_134_9, 0.0000000000000000),
            Complex::new(7.819_452_050_182_624E-2, 0.14056783081885876),
            Complex::new(0.503_607_988_357_544, -0.940_649_151_802_063),
            Complex::new(1.020_160_112_863_738, -0.260_467_361_552_037_5),
            Complex::new(-0.690_953_850_746_154_8, -0.814_968_705_177_307_1),
            Complex::new(-1.081_668_691_030_354, 0.0000000000000000),
            Complex::new(-0.263_009_868_346_711_8, 0.31196009025279664),
            Complex::new(-0.542_888_283_729_553_2, 0.24841265380382538),
            Complex::new(-0.425_520_534_325_486_6, 0.11192357318741848),
            Complex::new(-0.649_471_640_586_853, 1.915_639_080_107_212E-2),
            Complex::new(0.668_375_394_914_888_4, 0.241_788_420_291_149_6),
            Complex::new(1.1698956214925516, 0.0000000000000000),
        ]
    );
    let mut ap = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut ap, 6, 6, 0.0);
    let mut ap = matrix::complex::pack_upper(ap, 6, 6, 5);
    complex::hpr('l', 6, 0.2, &x, -1, &mut ap);
    capproximately!(
        ap,
        vec![
            Complex::new(1.2809381210347879, 0.0000000000000000),
            Complex::new(-0.986_942_388_440_824_5, -0.847_593_244_700_229_2),
            Complex::new(-0.29472044110298157, -1.1665705442428589),
            Complex::new(-1.1398672411927047, -0.18069329334156942),
            Complex::new(-0.28946158289909363, 0.26613736152648926),
            Complex::new(-0.326_518_423_639_795, -0.43068377270992614),
            Complex::new(0.638_613_923_200_755_7, 0.0000000000000000),
            Complex::new(-1.237_538_456_916_809, 0.618_243_277_072_906_5),
            Complex::new(-0.289_877_187_126_916, -0.31726553652934003),
            Complex::new(0.377_395_659_685_134_9, -2.223_900_318_145_752),
            Complex::new(7.819_452_050_182_624E-2, 0.14056783081885876),
            Complex::new(0.503_607_988_357_544, 0.0000000000000000),
            Complex::new(1.0857694149017334, -0.11582532525062561),
            Complex::new(-0.690_953_850_746_154_8, -0.814_968_705_177_307_1),
            Complex::new(-1.2845993041992188, 0.24226348102092743),
            Complex::new(-0.11139855031280793, 0.0000000000000000),
            Complex::new(-0.542_888_283_729_553_2, 0.24841265380382538),
            Complex::new(-0.585_119_269_900_178_7, 0.11270838424966724),
            Complex::new(-0.649_471_640_586_853, 0.0000000000000000),
            Complex::new(0.726_750_731_468_200_7, 0.25733837485313416),
            Complex::new(1.3553952574516321, 0.0000000000000000),
        ]
    );
    let mut ap = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut ap, 6, 6, 0.0);
    let mut ap = matrix::complex::pack_upper(ap, 6, 6, 5);

    let mut expect = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut expect, 6, 6, 0.0);
    let expect = matrix::complex::pack_upper(expect, 6, 6, 5);

    complex::hpr('l', 6, 0.0, &x, -1, &mut ap);
    capproximately!(ap, expect);

    let result = std::panic::catch_unwind(|| {
        complex::hpr('x', 6, 0.0, &x, 1, &mut []);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::hpr('l', 6, 0.0, &x, 0, &mut []);
    });
    assert!(result.is_err());
}

#[test]
fn hpr2() {
    let mut ap = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut ap, 6, 6, 0.0);
    let mut ap = matrix::complex::pack_upper(ap, 6, 6, 5);
    let y = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    let x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::hpr2('u', 6, Complex::new(0.2, 0.8), &x, 1, &y, 1, &mut ap);
    capproximately!(
        ap,
        vec![
            Complex::new(1.6699212789108326, 0.0000000000000000),
            Complex::new(-0.759_411_695_954_748, -0.952_664_339_911_920_3),
            Complex::new(-0.29472044110298157, 0.0000000000000000),
            Complex::new(-1.4512749167534824, -0.13248827665237595),
            Complex::new(-0.44376975470840946, 0.21556829407581407),
            Complex::new(-5.059_910_305_557_807_6E-2, 0.0000000000000000),
            Complex::new(0.43568331003189087, 0.25014132261276245),
            Complex::new(-1.237_538_456_916_809, 0.618_243_277_072_906_5),
            Complex::new(-0.224_267_885_088_920_6, -0.17262350022792816),
            Complex::new(0.377_395_659_685_134_9, 0.0000000000000000),
            Complex::new(0.213_495_815_303_989_3, 0.292_181_139_922_076_5),
            Complex::new(0.526_210_222_353_718_1, -0.734_409_417_572_385_3),
            Complex::new(0.954_550_810_825_742_4, -0.405_109_397_853_449_3),
            Complex::new(-0.690_953_850_746_154_8, -0.814_968_705_177_307_1),
            Complex::new(-0.878_738_077_861_489, 0.0000000000000000),
            Complex::new(-0.290_313_183_830_302_6, 0.257_979_043_430_169_1),
            Complex::new(-0.533_586_555_171_757_2, 0.18735347000462102),
            Complex::new(-0.41773073873688016, 0.15855896775211434),
            Complex::new(-0.649_471_640_586_853, 1.915_639_080_107_212E-2),
            Complex::new(0.610_000_058_361_576_1, 0.22623846572916503),
            Complex::new(1.1878795074504351, 0.0000000000000000),
        ]
    );
    let mut ap = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_upper(&mut ap, 6, 6, 0.0);
    let mut ap = matrix::complex::pack_lower(ap, 6, 6, 5);
    complex::hpr2('l', 6, Complex::new(0.2, 0.8), &x, -1, &y, -1, &mut ap);
    capproximately!(
        ap,
        vec![
            Complex::new(1.2989220069926715, 0.0000000000000000),
            Complex::new(-0.442_984_030_297_710_4, 1.2072042290596245),
            Complex::new(1.3297992944717407, -0.279_346_287_250_518_8),
            Complex::new(1.2880089382154818, 1.8511738881894504),
            Complex::new(0.42394316847249935, 0.49968688992363497),
            Complex::new(-1.5945566441278871, -0.560_746_065_670_172_7),
            Complex::new(0.11114078523474813, 0.0000000000000000),
            Complex::new(-5.767_172_668_129_206E-3, -1.0655906200408936),
            Complex::new(2.2734347066997658, -1.8530661685119423),
            Complex::new(0.786_195_669_283_649_7, 1.3627767901989158),
            Complex::new(-0.528_406_673_911_146_4, 1.1352737230419456),
            Complex::new(-0.299_215_108_156_204_2, 0.0000000000000000),
            Complex::new(-0.411_510_825_157_165_5, 2.4413645267486572),
            Complex::new(0.252_223_461_866_378_8, -0.795_339_107_513_427_7),
            Complex::new(-0.891_921_103_000_640_9, -5.487_747_490_406_036_4E-2),
            Complex::new(0.626_011_664_785_761, 0.0000000000000000),
            Complex::new(-2.097_180_658_638_492_2E-2, -1.3141834835731117),
            Complex::new(0.500_571_623_220_730_2, 0.453_569_296_904_524_1),
            Complex::new(-1.2845993041992188, 0.0000000000000000),
            Complex::new(0.21588152686005035, -1.5457194689631288),
            Complex::new(1.5588787793685963, 0.0000000000000000),
        ]
    );
    let mut ap = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_upper(&mut ap, 6, 6, 0.0);
    let mut ap = matrix::complex::pack_lower(ap, 6, 6, 5);
    let mut expect = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_upper(&mut expect, 6, 6, 0.0);
    let expect = matrix::complex::pack_lower(expect, 6, 6, 5);

    complex::hpr2('l', 6, Complex::new(0.0, 0.0), &x, -1, &y, -1, &mut ap);
    capproximately!(ap, expect);

    let result = std::panic::catch_unwind(|| {
        complex::hpr2('x', 6, Complex::new(0.0, 0.0), &x, 1, &y, 1, &mut []);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::hpr2('l', 6, Complex::new(0.0, 0.0), &x, 0, &y, 1, &mut []);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::hpr2('l', 6, Complex::new(0.0, 0.0), &x, 1, &y, 0, &mut []);
    });
    assert!(result.is_err());
}

#[test]
fn tbmv() {
    let a = fixtures::complex::matrix_mxn(6, 6);
    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];

    complex::tbmv('u', 'n', 'n', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.898_937_736_052_534_6, 1.1357840738783445),
            Complex::new(-0.451_519_857_005_229_2, 0.298_501_258_883_773),
            Complex::new(-0.715_165_091_186_031_4, 0.657_947_981_797_211_3),
            Complex::new(1.2587631018024554, 1.0538850956187753),
            Complex::new(0.13566746748087732, -0.615_278_309_050_398_6),
            Complex::new(9.448_266_558_533_036E-2, 0.171_422_088_835_758_7),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbmv('u', 'n', 'u', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.937_823_397_519_867_5, 0.744_131_334_909_138_1),
            Complex::new(-0.451_519_857_005_229_2, 0.298_501_258_883_773),
            Complex::new(0.38229682533410747, 0.30850538482755907),
            Complex::new(1.2587631018024554, 1.0538850956187753),
            Complex::new(0.26330208478911077, 1.087_232_850_104_408),
            Complex::new(-0.11775359511375427, -0.27577802538871765),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbmv('l', 'n', 'n', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-1.5857588772442313, 0.33125815615156995),
            Complex::new(0.543_373_906_860_683_3, 2.685_978_872_896_299_7E-2),
            Complex::new(-2.2279378005181627, 1.263_250_970_435_692),
            Complex::new(-0.898_937_736_052_534_6, 1.1357840738783445),
            Complex::new(-0.451_519_857_005_229_2, 0.298_501_258_883_773),
            Complex::new(-0.715_165_091_186_031_4, 0.657_947_981_797_211_3),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbmv('l', 'n', 'u', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.649_010_062_217_712_4, 0.772_142_171_859_741_2),
            Complex::new(0.543_373_906_860_683_3, 2.685_978_872_896_299_7E-2),
            Complex::new(-1.1550642750183755, -0.20168802073263237),
            Complex::new(-0.898_937_736_052_534_6, 1.1357840738783445),
            Complex::new(5.810_994_065_235_064_5E-2, 1.300_847_844_397_051),
            Complex::new(-0.467_663_152_262_638, 0.14935680643823457),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbmv('u', 't', 'n', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.610_124_400_750_379_4, 1.1637949108289476),
            Complex::new(0.904_501_266_751_444_3, 0.752_662_944_270_949),
            Complex::new(-6.993_267_528_340_752E-2, -0.15133458277470524),
            Complex::new(-0.12669784107884396, 0.877_894_224_221_812_2),
            Complex::new(0.345_908_675_454_581_7, -0.926_797_845_299_005_1),
            Complex::new(-0.977_416_765_382_001_8, -1.071_196_122_193_642),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbmv('u', 't', 'u', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.649_010_062_217_712_4, 0.772_142_171_859_741_2),
            Complex::new(0.904_501_266_751_444_3, 0.752_662_944_270_949),
            Complex::new(1.0275292412367314, -0.500_777_179_744_357_4),
            Complex::new(-0.12669784107884396, 0.877_894_224_221_812_2),
            Complex::new(0.47354329276281515, 0.775_713_313_855_801_4),
            Complex::new(-1.1896530260810865, -1.5183962364181183),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbmv('l', 't', 'n', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.176_547_358_792_802_8, 0.588_747_710_597_083_1),
            Complex::new(0.858_905_512_402_206, 1.8168168506139182),
            Complex::new(-0.772_521_340_085_067_5, 0.937_921_874_488_354_8),
            Complex::new(-0.23040409445892918, -1.2087986124495775),
            Complex::new(-0.428_206_064_511_211_5, -0.142_943_091_337_457_2),
            Complex::new(-0.365_255_534_037_147_7, 0.23281314997025904),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbmv('l', 't', 'u', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.760_201_456_233_716, 1.0296317263052543),
            Complex::new(0.858_905_512_402_206, 1.8168168506139182),
            Complex::new(0.30035218541471975, -0.527_017_116_679_969_5),
            Complex::new(-0.23040409445892918, -1.2087986124495775),
            Complex::new(8.142_373_314_636_83E-2, 0.859_403_494_175_820_8),
            Complex::new(-0.11775359511375427, -0.27577802538871765),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbmv('u', 'c', 'n', 6, 3, &a, 6, &mut x, -1);
    capproximately!(
        x,
        vec![
            Complex::new(-4.408_166_213_538_5E-2, -0.47152180004162414),
            Complex::new(1.4701333254503495, 5.496_296_897_558_928E-2),
            Complex::new(0.359_269_765_597_012_3, -1.442_062_811_445_226),
            Complex::new(0.319_094_252_409_060_1, -0.283_518_123_001_387_7),
            Complex::new(-0.394_265_650_043_308_5, 2.414_831_897_378_859),
            Complex::new(-7.279_556_264_438_547E-2, -0.38380208237829727),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbmv('u', 'c', 'u', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.649_010_062_217_712_4, 0.772_142_171_859_741_2),
            Complex::new(-0.897_015_360_567_118_5, -0.761_569_098_729_867_9),
            Complex::new(0.676_469_107_624_793_5, -0.795_854_391_508_189_7),
            Complex::new(-0.736_716_478_460_039_1, -1.453_269_896_407_860_5E-2),
            Complex::new(0.48292775843658564, 0.790_384_706_638_819_9),
            Complex::new(0.516_468_226_727_044_8, 0.303_091_908_302_102_4),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbmv('l', 'c', 'n', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.303_541_701_391_296_2, 0.23178789271847933),
            Complex::new(-0.558_933_089_706_695_1, 3.228_399_237_933_04),
            Complex::new(-0.741_002_108_649_212_7, -0.332_504_616_788_066_1),
            Complex::new(-7.262_468_820_471_879E-2, -1.1351242539598538),
            Complex::new(0.29318211076532813, -0.24869434973481597),
            Complex::new(0.42076612202015307, -0.10280777453071321),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbmv('l', 'c', 'u', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.291_887_224_699_877_4, -0.615_172_231_333_687_6),
            Complex::new(-0.558_933_089_706_695_1, 3.228_399_237_933_04),
            Complex::new(1.0387957612083905, -0.692_259_244_296_801_4),
            Complex::new(-7.262_468_820_471_879E-2, -1.1351242539598538),
            Complex::new(8.751_593_352_783_726E-2, 0.856_802_204_620_352_5),
            Complex::new(-0.11775359511375427, -0.27577802538871765),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbmv('l', 'c', 'u', 0, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.649_010_062_217_712_4, 0.772_142_171_859_741_2),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.664_135_694_503_784_2, -0.424_810_290_336_608_9),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.143_771_484_494_209_3, 0.996_986_865_997_314_5),
            Complex::new(-0.11775359511375427, -0.27577802538871765),
        ]
    );

    let result = std::panic::catch_unwind(|| {
        complex::tbmv('x', 't', 'u', 6, 5, &a, 6, &mut [], 1);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::tbmv('u', 'x', 'u', 6, 5, &a, 6, &mut [], 1);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::tbmv('u', 't', 'c', 6, 5, &a, 6, &mut [], 1);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::tbmv('u', 't', 'n', 6, 5, &a, 4, &mut [], 1);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::tbmv('u', 't', 'n', 6, 5, &a, 4, &mut [], 0);
    });
    assert!(result.is_err());
}

#[test]
fn tbsv() {
    let a = fixtures::complex::matrix_mxn(6, 6);
    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];

    complex::tbsv('u', 'n', 'n', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-8.714_018_118_416_831, 0.539_741_798_776_200_8),
            Complex::new(1.8661327422332243, 3.902_749_987_768_584),
            Complex::new(-3.658_033_936_046_201, 8.809_791_318_800_302),
            Complex::new(5.618_886_933_066_113, 4.309_286_009_440_974),
            Complex::new(-0.437_655_795_565_534, -1.3695491241654123),
            Complex::new(0.0000000000000000, 0.0000000000000000),
        ]
    );
    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbsv('u', 'n', 'u', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(3.338_660_655_299_988, -0.304_809_446_580_219_3),
            Complex::new(-0.458_725_461_608_756_2, -2.5016404952691627),
            Complex::new(0.10040131610044789, -1.482_719_398_550_286),
            Complex::new(5.687_845_270_308_889E-2, -1.4873152158496024),
            Complex::new(2.424_088_419_930_781E-2, 0.906_740_881_890_221),
            Complex::new(-0.11775359511375427, -0.27577802538871765),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbsv('l', 'n', 'n', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.19681361062735658, 0.140_433_125_457_823),
            Complex::new(-0.436_664_155_739_315, -0.12517747762468392),
            Complex::new(1.9908862356588675, -0.49306176041025807),
            Complex::new(-1.170_726_055_999_508, -4.5452002398639015),
            Complex::new(-0.362_484_472_182_576_9, 0.31276418173763804),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.0, 0.0),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];

    complex::tbsv('l', 'n', 'u', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.11916876584291458, -0.219_515_621_662_139_9),
            Complex::new(0.147_525_028_849_587_3, -0.163_849_312_858_913_8),
            Complex::new(1.4363127452141604, -0.573_156_258_545_181_8),
            Complex::new(2.298_902_326_651_837, 0.24098851995891635),
            Complex::new(-1.1879615574537852, -1.4001332192795501),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.0, 0.0),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbsv('u', 't', 'n', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-7.610_146_081_694_658E-3, -9.466_018_278_971_841E-2),
            Complex::new(6.814_785_798_721_443E-2, 1.523_480_615_837_166_4E-3),
            Complex::new(2.9528998152503227, -0.17560477971933142),
            Complex::new(3.2401253786020834, -6.278_124_324_585_136),
            Complex::new(-2.697_870_727_756_624, 7.241_806_610_575_646),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbsv('u', 't', 'u', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.649_010_062_217_712_4, 0.772_142_171_859_741_2),
            Complex::new(-0.904_501_266_751_444_3, -0.752_662_944_270_949),
            Complex::new(-0.17021002669464957, -0.333_329_944_573_462_9),
            Complex::new(-1.3114892067913817, -1.0467456831262383),
            Complex::new(2.3201126210298955, 1.347_336_254_251_294),
            Complex::new(0.562_139_472_935_631, -0.677_780_849_860_200_2),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbsv('l', 't', 'n', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.267_832_942_222_370_4, 5.341_221_259_683_188),
            Complex::new(-2.4708523091856045, -10.504_946_494_218_57),
            Complex::new(-2.5360982977762716, -1.6617901325948061),
            Complex::new(7.882_430_112_402_385, -2.4955417126761907),
            Complex::new(2.7655458811932285, -0.559_439_603_772_670_4),
            Complex::new(0.20166478159136628, -4.927_370_886_489_214E-2)
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbsv('l', 't', 'u', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-2.8778446406669276, -3.977_772_237_557_331),
            Complex::new(-3.181_273_516_623_029, -1.3246826397301936),
            Complex::new(0.872_224_611_785_923_6, 0.17438318677524328),
            Complex::new(0.341_977_121_051_121_1, 1.3634675771268798),
            Complex::new(0.20611923584205027, 1.134_570_237_818_808),
            Complex::new(-0.11775359511375427, -0.27577802538871765),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbsv('u', 'c', 'n', 6, 3, &a, 6, &mut x, -1);
    capproximately!(
        x,
        vec![
            Complex::new(-2.4553590852142104, -5.390_005_755_899_985),
            Complex::new(3.4605613317430035, 3.7946358385801675),
            Complex::new(2.368_041_714_805_26, 6.587_643_530_654_849E-2),
            Complex::new(0.361_700_190_163_959_6, -8.279_586_907_440_65E-3),
            Complex::new(0.151_148_023_449_912_5, 0.41203114326506957),
            Complex::new(-0.133_680_546_248_730_7, -0.187_385_540_636_499),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbsv('u', 'c', 'u', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.649_010_062_217_712_4, 0.772_142_171_859_741_2),
            Complex::new(0.897_015_360_567_118_5, 0.761_569_098_729_867_9),
            Complex::new(0.717_520_838_956_568_4, 0.412_836_092_389_917_7),
            Complex::new(1.150_410_910_746_126, 1.402_246_544_297_95),
            Complex::new(-0.36504790906346596, -1.4582194308823537),
            Complex::new(0.955_168_869_874_665_6, -0.741_305_832_443_249_1),
        ]
    );
    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbsv('l', 'c', 'n', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(1.2134872328945268, 3.368_987_525_893_751),
            Complex::new(-0.514_540_800_493_786_5, -11.238018851608174),
            Complex::new(1.1080551530027434, -1.5280652728327344),
            Complex::new(-7.954_583_528_953_969, -7.683_158_610_436_716E-2),
            Complex::new(-2.6639255157882884, 0.22590102372385532),
            Complex::new(-0.175_059_667_691_381_4, 0.11158268354623273)
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbsv('l', 'c', 'u', 6, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-2.1629786169498084, -2.823_426_794_775_566),
            Complex::new(2.6661358253363017, -3.4888111144575142),
            Complex::new(0.600_706_530_513_195_2, 0.25805634910918834),
            Complex::new(0.10717711933379223, 1.3226800014067428),
            Complex::new(0.20002703546058132, 1.1371715273742764),
            Complex::new(-0.11775359511375427, -0.27577802538871765),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(0.0, 0.0),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(0.0, 0.0),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tbsv('l', 'c', 'u', 0, 3, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.649_010_062_217_712_4, 0.772_142_171_859_741_2),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.664_135_694_503_784_2, -0.424_810_290_336_608_9),
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.143_771_484_494_209_3, 0.996_986_865_997_314_5),
            Complex::new(-0.11775359511375427, -0.27577802538871765),
        ]
    );

    let result = std::panic::catch_unwind(|| {
        complex::tbsv('x', 't', 'u', 6, 5, &a, 6, &mut [], 1);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::tbsv('u', 'x', 'u', 6, 5, &a, 6, &mut [], 1);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::tbsv('u', 't', 'c', 6, 5, &a, 6, &mut [], 1);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::tbsv('u', 't', 'n', 6, 5, &a, 4, &mut [], 1);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::tbsv('u', 't', 'n', 6, 5, &a, 4, &mut [], 0);
    });
    assert!(result.is_err());
}

#[test]
fn tpmv() {
    let mut ap = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut ap, 6, 6, 0.0);
    let ap = matrix::complex::pack_upper(ap, 6, 6, 5);
    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpmv('u', 'n', 'n', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.21480810469340378, 0.695_792_270_752_929),
            Complex::new(-0.260_949_696_950_221_4, 2.1899200001689807),
            Complex::new(-0.33737654149548413, 0.958_493_590_624_382_8),
            Complex::new(0.278_665_157_969_632_8, -3.2357536489400593),
            Complex::new(-0.440_831_500_141_796_6, -1.4766224545245905),
            Complex::new(-0.13564174811293128, -0.317_671_943_847_841_5),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpmv('u', 'n', 'u', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.21480810469340378, 0.695_792_270_752_929),
            Complex::new(-0.15915947579584566, 1.766_689_865_635_461),
            Complex::new(0.685_505_781_024_421, 0.656_755_369_797_466_6),
            Complex::new(1.8959032428106883, -1.0481669938732936),
            Complex::new(0.129_162_241_986_017, 0.766_262_465_523_520_4),
            Complex::new(-0.11775359511375427, -0.27577802538871765),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpmv('l', 'n', 'n', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(2.990_085_581_874_08E-3, -0.125_448_325_351_546_6),
            Complex::new(0.21805658972259057, -0.640_672_798_085_021_1),
            Complex::new(0.554_543_031_966_127_6, 3.327_810_925_482_166_4E-2),
            Complex::new(-1.9443462712775996, -0.20935680748047414),
            Complex::new(-1.4832770655398049, 1.417_774_511_642_555),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpmv('l', 'n', 'u', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.11916876584291458, -0.219_515_621_662_139_9),
            Complex::new(0.947_325_682_402_802_9, -0.22682655495516757),
            Complex::new(1.761_695_682_663_515, -0.887_348_211_327_898_7),
            Complex::new(-1.6881006148507482, 1.4323906112766398),
            Complex::new(-1.4653889125406279, 1.459_668_430_101_679),
        ]
    );
    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    for c in ap.iter() {
        println!("{:?}", c.im);
    }
    complex::tpmv('u', 't', 'n', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.22095898699729033, 0.20371451287137976),
            Complex::new(-0.26583054006009044, -9.124_599_111_009_246E-2),
            Complex::new(-0.455_355_567_654_593_5, -2.4279571343292985),
            Complex::new(-1.1230038346504205, -2.3902810640005123),
            Complex::new(-1.1355567240741828, 1.0540975185653942),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpmv('u', 't', 'u', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.11916876584291458, -0.219_515_621_662_139_9),
            Complex::new(0.757_051_782_459_814_6, -0.392_984_211_937_008_6),
            Complex::new(1.161_882_517_186_462, -0.24037047926253274),
            Complex::new(-0.553_010_092_522_606_9, -0.14739614395240164),
            Complex::new(-1.1176685710750058, 1.095_991_437_024_518),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpmv('l', 't', 'n', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-2.4976814036793784, -0.239_460_102_501_331_2),
            Complex::new(1.3996314833238857, 0.788_353_321_655_002_8),
            Complex::new(2.012_987_411_251_268, -1.9013967150345032),
            Complex::new(-0.36287068806792244, 0.10791794560781565),
            Complex::new(-0.12708341444083437, -0.875_484_953_233_593_5),
            Complex::new(-0.13564174811293128, -0.317_671_943_847_841_5)
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpmv('l', 't', 'u', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-2.4976814036793784, -0.239_460_102_501_331_2),
            Complex::new(1.277_472_631_899_097, 0.694_286_025_344_409_5),
            Complex::new(2.7422565039314803, -1.4875504719046497),
            Complex::new(0.844_281_962_629_464_9, -0.812_708_374_974_904_7),
            Complex::new(0.129_162_241_986_017, 0.766_262_465_523_520_4),
            Complex::new(-0.11775359511375427, -0.27577802538871765),
        ]
    );
    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpmv('u', 'c', 'n', 6, &ap, &mut x, -1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.990_537_564_261_706, -0.22489208505092062),
            Complex::new(0.37551077322001747, 1.4700155236647587),
            Complex::new(1.3389624021526658, 0.18727475284257045),
            Complex::new(0.249_956_492_697_822_6, 0.502_980_686_838_448_3),
            Complex::new(-0.866_626_541_941_441_6, 3.198_946_929_891_2E-2),
            Complex::new(-3.026_712_792_776_109_5E-2, -0.398_871_736_403_574_3),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpmv('u', 'c', 'u', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.11916876584291458, -0.219_515_621_662_139_9),
            Complex::new(0.640_209_165_733_796_7, -0.329_553_690_101_406),
            Complex::new(1.0371188810777623, 0.136_270_953_799_480_4),
            Complex::new(0.641_283_180_056_381_9, 1.5767700095488548),
            Complex::new(-0.785_126_000_626_352_5, 0.952_300_047_961_242_6),
        ]
    );
    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpmv('l', 'c', 'n', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.212_310_095_460_669_6, 1.4470766140474218),
            Complex::new(-3.5191155812410297, 1.0437484124731138),
            Complex::new(1.150_591_221_269_297, -0.10552584409884025),
            Complex::new(-0.21019657406961945, -0.753_915_282_125_982_2),
            Complex::new(-0.23082261213115096, -0.820_388_201_120_261_2),
            Complex::new(-0.13564174811293128, -0.317_671_943_847_841_5),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpmv('l', 'c', 'u', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.212_310_095_460_669_6, 1.4470766140474218),
            Complex::new(-3.5314545767923575, 0.890_063_050_758_365_9),
            Complex::new(1.0806654353856708, -0.941_116_956_401_904),
            Complex::new(1.3036001790457676, -0.868_761_851_481_439_7),
            Complex::new(-1.277_429_576_146_094_1E-2, 0.826_867_503_122_895_4),
            Complex::new(-0.11775359511375427, -0.27577802538871765),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpmv('l', 'c', 'u', 0, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.11916876584291458, -0.219_515_621_662_139_9),
            Complex::new(0.664_135_694_503_784_2, -0.424_810_290_336_608_9),
            Complex::new(1.1009690761566162, -0.41898009181022644),
            Complex::new(0.143_771_484_494_209_3, 0.996_986_865_997_314_5),
            Complex::new(-0.11775359511375427, -0.27577802538871765)
        ]
    );

    let result = std::panic::catch_unwind(|| {
        complex::tpmv('x', 't', 'u', 6, &ap, &mut [], 1);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::tpmv('u', 'x', 'u', 6, &ap, &mut [], 1);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::tpmv('u', 't', 'x', 6, &ap, &mut [], 1);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::tpmv('u', 't', 'n', 6, &ap, &mut [], 0);
    });
    assert!(result.is_err());
}

#[test]
fn tpsv() {
    let mut ap = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut ap, 6, 6, 0.0);
    let ap = matrix::complex::pack_upper(ap, 6, 6, 5);
    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::tpsv('u', 'n', 'n', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-3.3851017924301425, -1.3820753807292496),
            Complex::new(-1.332_498_985_226_668, 0.675_735_801_000_248_5),
            Complex::new(-2.006_111_560_691_4, 0.30873159135263567),
            Complex::new(0.533_663_944_528_178_8, 0.696_947_258_688_519_9),
            Complex::new(3.326_420_111_757_603E-2, -0.769_833_956_478_482_5),
            Complex::new(0.0000000000000000, 0.0000000000000000),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::tpsv('u', 'n', 'u', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.15547987558715703, -2.1970472032566155),
            Complex::new(-0.646_515_554_757_749_9, -0.843_937_831_264_945_3),
            Complex::new(0.412_710_910_503_725_4, -1.3369077805429912),
            Complex::new(0.38779544173476843, 0.387_061_082_953_623_6),
            Complex::new(0.143_771_484_494_209_3, 0.996_986_865_997_314_5),
            Complex::new(0.0000000000000000, 0.0000000000000000),
        ]
    );
    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpsv('l', 'n', 'n', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.423_271_542_103_193_9, -0.260_826_879_707_155_6),
            Complex::new(0.39222678598002386, -0.23224612883036766),
            Complex::new(-1.2997678064087332, -0.944_785_985_525_099_1),
            Complex::new(-0.615_178_056_679_344_3, -0.20792193349925353),
            Complex::new(6.704_839_049_120_316E-2, -0.611_004_628_078_052_9),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpsv('l', 'n', 'u', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.11916876584291458, -0.219_515_621_662_139_9),
            Complex::new(0.38094570660476545, -0.622_794_025_718_050_2),
            Complex::new(0.770_653_027_661_753_1, 0.23155213977648836),
            Complex::new(1.9235986450552391, 0.629_215_531_531_303_7),
            Complex::new(-0.670_657_827_784_487_1, -2.0842393309515446),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpsv('u', 't', 'n', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.201_141_452_807_732_8, -5.133_703_096_043_316E-2),
            Complex::new(-0.11347507554592454, 1.7911796556818167),
            Complex::new(0.17118012099267396, 0.413_192_725_385_030_6),
            Complex::new(0.11383486554884616, 0.271_276_588_575_743_6),
            Complex::new(0.13250679287302938, 0.406_770_813_635_326_9),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpsv('u', 't', 'u', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.11916876584291458, -0.219_515_621_662_139_9),
            Complex::new(0.571_219_606_547_753_7, -0.45663636873620916),
            Complex::new(1.0247114696420028, -0.620_766_771_981_728_7),
            Complex::new(1.0568841164395277, 1.963_590_775_826_141),
            Complex::new(0.37156836221836176, -2.7223246591641685),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpsv('l', 't', 'n', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(12.179271994541113, 14.308_616_957_116_69),
            Complex::new(20.022860582238643, -11.394_470_245_205_24),
            Complex::new(5.334_558_789_785_215, 2.9774530389843976),
            Complex::new(-3.4438036297245773, 0.904_962_257_316_412_7),
            Complex::new(-0.186_358_395_681_652_9, -1.8489702849007796),
            Complex::new(-0.10222449470844058, -0.23940899018683348),
        ],
        1E-5
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpsv('l', 't', 'u', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-4.6890622533536845, -4.3105166275435485),
            Complex::new(-4.909_538_817_185_945, 1.5119249268050328),
            Complex::new(-2.001_160_509_631_661, 0.28698531071705224),
            Complex::new(1.4229022368946207, 9.637_664_444_067_628E-2),
            Complex::new(0.15838072700240158, 1.2277112664711085),
            Complex::new(-0.11775359511375427, -0.27577802538871765),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpsv('u', 'c', 'n', 6, &ap, &mut x, -1);
    capproximately!(
        x,
        vec![
            Complex::new(0.39803859497384503, -1.0008794896314415),
            Complex::new(-0.954_610_168_185_986_4, -0.10455630604512522),
            Complex::new(0.108_195_667_765_267_1, -0.48235598200894436),
            Complex::new(-2.114_714_569_949_102, -1.3663776876599896),
            Complex::new(0.806_282_692_060_219_3, -8.811_184_607_553_944E-2),
            Complex::new(-0.15013342830572224, -0.16730119413206657),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpsv('u', 'c', 'u', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.11916876584291458, -0.219_515_621_662_139_9),
            Complex::new(0.688_062_223_273_771_6, -0.520_066_890_571_811_8),
            Complex::new(1.1537416954878212, -0.999_724_414_840_022_4),
            Complex::new(-0.827_577_035_353_500_8, 7.358_356_803_020_283E-2),
            Complex::new(1.5551601886103397, -1.4986169107249498),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpsv('l', 'c', 'n', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-16.223_221_775_482_75, 12.881420892412462),
            Complex::new(-14.487_432_918_075_61, -15.055884393595845),
            Complex::new(-6.4169359859497845, -0.960_021_248_178_340_2),
            Complex::new(1.5382948185317014, 4.392_527_909_125_89),
            Complex::new(-0.48218019458408296, -1.7482432429647807),
            Complex::new(-0.10222449470844058, -0.23940899018683348),
        ],
        1E-5
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpsv('l', 'c', 'u', 6, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(2.5181705640049294, -5.401_192_050_891_967),
            Complex::new(3.8304845810211443, -1.670_777_241_309_474),
            Complex::new(0.735_330_201_047_094_6, -0.530_877_710_676_822_9),
            Complex::new(0.941_065_040_840_519, 0.16204542951614687),
            Complex::new(0.300_317_264_749_879_5, 1.1671062288717335),
            Complex::new(-0.11775359511375427, -0.27577802538871765),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::tpsv('l', 'c', 'u', 0, &ap, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.11916876584291458, -0.219_515_621_662_139_9),
            Complex::new(0.664_135_694_503_784_2, -0.424_810_290_336_608_9),
            Complex::new(1.1009690761566162, -0.41898009181022644),
            Complex::new(0.143_771_484_494_209_3, 0.996_986_865_997_314_5),
            Complex::new(-0.11775359511375427, -0.27577802538871765),
        ]
    );

    let result = std::panic::catch_unwind(|| {
        complex::tpsv('x', 't', 'u', 6, &ap, &mut [], 1);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::tpsv('u', 'x', 'u', 6, &ap, &mut [], 1);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::tpsv('u', 't', 'x', 6, &ap, &mut [], 1);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::tpsv('u', 't', 'n', 6, &ap, &mut [], 0);
    });
    assert!(result.is_err());
}

#[test]
fn trmv() {
    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 6), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut a, 6, 6, 0.0);
    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::trmv('u', 'n', 'n', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.831_506_754_148_850_6, 1.9278190152391241),
            Complex::new(-0.39338349525210226, 2.0694548243325235),
            Complex::new(-0.40640543562459586, 0.846_684_041_211_395),
            Complex::new(0.19690462573740852, -3.4126079216408423),
            Complex::new(-0.42622225763360433, -1.2458980540507965),
            Complex::new(0.0000000000000000, 0.0000000000000000),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::trmv('u', 'n', 'u', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.992_491_985_093_781_4, 1.4460226393835436),
            Complex::new(-0.291_593_274_097_726_5, 1.6462246897990038),
            Complex::new(0.616_476_886_895_309_2, 0.544_945_820_384_478_8),
            Complex::new(1.814_142_710_578_464, -1.2250212665740765),
            Complex::new(0.143_771_484_494_209_3, 0.996_986_865_997_314_5),
            Complex::new(0.0000000000000000, 0.0000000000000000),
        ]
    );

    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 6), 6, 1, 6, 1, 6);
    matrix::complex::set_upper(&mut a, 6, 6, 0.0);

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::trmv('l', 'n', 'n', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.488_024_831_272_781_5, 1.2539385477153218),
            Complex::new(-0.965_377_102_229_195_7, -0.851_855_865_850_224_9),
            Complex::new(-1.2393312224660826, 1.2132717007075515),
            Complex::new(-2.565_455_995_689_417, -1.3102608123698012),
            Complex::new(-1.5184106544536302, -3.6775354290217734),
            Complex::new(3.4744621149400827, -0.576_799_951_078_730_7)
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::trmv('l', 'n', 'u', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.649_010_062_217_712_4, 0.772_142_171_859_741_2),
            Complex::new(-0.863_586_881_074_82, -1.2750860003837445),
            Complex::new(-0.216_448_899_946_177_5, 0.911_533_479_880_635_4),
            Complex::new(-0.948_217_910_848_361_7, 0.877_325_842_696_964_6),
            Complex::new(-0.948_416_912_325_816_6, -1.4346505089736628),
            Complex::new(3.4744621149400827, -0.576_799_951_078_730_7),
        ]
    );

    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 6), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut a, 6, 6, 0.0);
    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::trmv('u', 't', 'n', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.488_024_831_272_781_5, 1.2539385477153218),
            Complex::new(1.0241460862502108, 2.673_320_021_001_135_4E-2),
            Complex::new(0.654_540_491_591_912_6, -0.829_861_782_158_612_7),
            Complex::new(-0.931_263_083_919_696_5, -2.253_891_912_430_363),
            Complex::new(-1.0774122839169915, -2.4272069861881223),
            Complex::new(-1.1294976357766762, 0.952_271_012_622_591_1),
        ]
    );

    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 6), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut a, 6, 6, 0.0);
    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::trmv('u', 't', 'u', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.649_010_062_217_712_4, 0.772_142_171_859_741_2),
            Complex::new(1.1259363074045865, -0.396_496_934_323_508_3),
            Complex::new(1.6774228141118177, -1.1316000029855289),
            Complex::new(0.685_975_000_921_359, -6.630_525_736_359_738E-2),
            Complex::new(-0.507_418_541_789_177_9, -0.18432206614001156),
            Complex::new(-1.1294976357766762, 0.952_271_012_622_591_1),
        ]
    );

    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 6), 6, 1, 6, 1, 6);
    matrix::complex::set_upper(&mut a, 6, 6, 0.0);

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::trmv('l', 't', 'n', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(2.2251660077830033, 2.323_834_176_613_893),
            Complex::new(0.271_523_041_925_223_9, -2.3031402183418956),
            Complex::new(1.0402809982832415, 2.8743260159852113),
            Complex::new(0.762_707_935_039_658, -2.655_303_862_424_115),
            Complex::new(-0.42622225763360433, -1.2458980540507965),
            Complex::new(0.0000000000000000, 0.0000000000000000),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::trmv('l', 't', 'u', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(2.0641807768380724, 1.8420378007583125),
            Complex::new(0.37331326307959944, -2.7263703528754153),
            Complex::new(2.0631633208031466, 2.572_587_795_158_295),
            Complex::new(2.3799460198807134, -0.46771720735734945),
            Complex::new(0.143_771_484_494_209_3, 0.996_986_865_997_314_5),
            Complex::new(0.0000000000000000, 0.0000000000000000),
        ]
    );

    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 6), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut a, 6, 6, 0.0);
    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::trmv('u', 'c', 'n', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-1.1513151820979886, 0.696_421_904_348_156_3),
            Complex::new(0.251_395_576_457_296_8, -1.3313132788431306),
            Complex::new(0.506_692_129_963_507_4, -0.561_145_019_129_583),
            Complex::new(1.193_802_527_146_775, 3.3443289488025765),
            Complex::new(0.582_890_646_855_876_8, -0.787_039_246_394_205_3),
            Complex::new(-0.23183789661954024, 1.2835785838419986),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::trmv('u', 'c', 'u', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.649_010_062_217_712_4, 0.772_142_171_859_741_2),
            Complex::new(-0.158_975_118_852_751_5, -1.4765058693244129),
            Complex::new(1.209_520_063_773_862, -1.3632466929137586),
            Complex::new(0.947_500_693_040_832_5, 0.635_024_646_402_675_4),
            Complex::new(0.669_817_371_606_381_8, 1.5255068342641325),
            Complex::new(-0.23183789661954024, 1.2835785838419986),
        ]
    );

    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 6), 6, 1, 6, 1, 6);
    matrix::complex::set_upper(&mut a, 6, 6, 0.0);

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::trmv('l', 'c', 'n', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.900_619_943_987_280_8, -1.5995329267787675),
            Complex::new(5.3055233216601705, 1.945_013_130_669_14),
            Complex::new(-2.2713161685357997, -1.7723500578825266),
            Complex::new(0.106_633_900_868_787_1, 2.604_930_535_910_964),
            Complex::new(5.684_475_974_370_429E-2, -1.3155592146610233),
            Complex::new(0.0000000000000000, 0.0000000000000000),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::trmv('l', 'c', 'u', 6, &a, 6, &mut x, -1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.649_010_062_217_712_4, 0.772_142_171_859_741_2),
            Complex::new(-1.2498731094504563, -1.1083395882641662),
            Complex::new(0.680_691_889_887_595_5, 0.24910421006826589),
            Complex::new(0.47157803291335676, -2.7400158851063168),
            Complex::new(3.6613593566644753, 2.0828881554261853),
            Complex::new(3.3443933864997035, -3.968_036_836_634_785),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::trmv('l', 'c', 'u', 0, &a, 6, &mut x, -1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.649_010_062_217_712_4, 0.772_142_171_859_741_2),
            Complex::new(-0.11916876584291458, -0.219_515_621_662_139_9),
            Complex::new(0.664_135_694_503_784_2, -0.424_810_290_336_608_9),
            Complex::new(1.1009690761566162, -0.41898009181022644),
            Complex::new(0.143_771_484_494_209_3, 0.996_986_865_997_314_5),
            Complex::new(0.0000000000000000, 0.0000000000000000),
        ]
    );

    let result = std::panic::catch_unwind(|| {
        complex::trmv('x', 't', 'u', 6, &a, 6, &mut [], 1);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::trmv('u', 'x', 'u', 6, &a, 6, &mut [], 1);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::trmv('u', 't', 'x', 6, &a, 6, &mut [], 1);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::trmv('u', 't', 'n', 6, &a, 6, &mut [], 0);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::trmv('u', 't', 'n', 6, &a, 5, &mut [], 1);
    });
    assert!(result.is_err());
}

#[test]
fn trsv() {
    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut a, 6, 6, 0.0);
    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::trsv('u', 'n', 'n', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-3.3851017924301425, -1.3820753807292496),
            Complex::new(-1.332_498_985_226_668, 0.675_735_801_000_248_5),
            Complex::new(-2.006_111_560_691_4, 0.30873159135263567),
            Complex::new(0.533_663_944_528_178_8, 0.696_947_258_688_519_9),
            Complex::new(3.326_420_111_757_603E-2, -0.769_833_956_478_482_5),
            Complex::new(0.0000000000000000, 0.0000000000000000),
        ]
    );
    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::trsv('u', 'n', 'u', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.15547987558715703, -2.1970472032566155),
            Complex::new(-0.646_515_554_757_749_9, -0.843_937_831_264_945_3),
            Complex::new(0.412_710_910_503_725_4, -1.3369077805429912),
            Complex::new(0.38779544173476843, 0.387_061_082_953_623_6),
            Complex::new(0.143_771_484_494_209_3, 0.996_986_865_997_314_5),
            Complex::new(0.0000000000000000, 0.0000000000000000),
        ]
    );

    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_upper(&mut a, 6, 6, 0.0);

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::trsv('l', 'n', 'n', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.201_141_452_807_732_8, -5.133_703_096_043_316E-2),
            Complex::new(-0.587_796_724_836_462_4, 1.4444342253366556),
            Complex::new(-0.599_960_844_299_803_5, 1.8923968370248347),
            Complex::new(2.394_312_153_721_92, 1.2601259090017753),
            Complex::new(-1.1716441125457138, 2.446_833_162_604_755),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::trsv('l', 'n', 'u', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.11916876584291458, -0.219_515_621_662_139_9),
            Complex::new(0.897_362_215_050_142_1, -0.553_061_393_914_145_5),
            Complex::new(0.749_853_039_773_441_1, -2.4958541378702988),
            Complex::new(3.248_240_162_351_549, 3.4359461997861374),
            Complex::new(-6.111_589_210_932_528, 5.410_597_894_875_497),
        ]
    );

    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut a, 6, 6, 0.0);
    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::trsv('u', 't', 'n', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(0.201_141_452_807_732_8, -5.133_703_096_043_316E-2),
            Complex::new(-0.11347507554592454, 1.7911796556818167),
            Complex::new(0.17118012099267396, 0.413_192_725_385_030_6),
            Complex::new(0.11383486554884616, 0.271_276_588_575_743_6),
            Complex::new(0.13250679287302938, 0.406_770_813_635_326_9),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::trsv('u', 't', 'u', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.11916876584291458, -0.219_515_621_662_139_9),
            Complex::new(0.571_219_606_547_753_7, -0.45663636873620916),
            Complex::new(1.0247114696420028, -0.620_766_771_981_728_7),
            Complex::new(1.0568841164395277, 1.963_590_775_826_141),
            Complex::new(0.37156836221836176, -2.7223246591641685),
        ]
    );

    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_upper(&mut a, 6, 6, 0.0);

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::trsv('l', 't', 'n', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(2.598_325_369_219_477, -15.102_300_459_040_05),
            Complex::new(6.314_170_168_152_916, -6.920_383_769_175_977),
            Complex::new(-3.748_870_371_182_194, 6.416_725_838_281_648),
            Complex::new(0.27337260555960724, 0.884_094_211_892_849_1),
            Complex::new(3.326_420_111_757_603E-2, -0.769_833_956_478_482_5),
            Complex::new(0.0000000000000000, 0.0000000000000000),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::trsv('l', 't', 'u', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.42363350716824644, -2.209_386_764_935_09),
            Complex::new(2.2225892101670914, -1.7538965376185174),
            Complex::new(-1.1422197242316745, -0.27970358425951164),
            Complex::new(-0.178_007_867_567_481, -0.37024297626310343),
            Complex::new(0.143_771_484_494_209_3, 0.996_986_865_997_314_5),
            Complex::new(0.0000000000000000, 0.0000000000000000),
        ]
    );
    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_lower(&mut a, 6, 6, 0.0);
    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::trsv('u', 'c', 'n', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.15262265513448822, 0.140_711_406_521_066_9),
            Complex::new(-1.4443838535530182, -0.399_060_732_518_107_7),
            Complex::new(-4.633_235_072_549_487E-2, -0.20224298804899468),
            Complex::new(-1.483_866_607_924_551, -0.940_997_061_995_156),
            Complex::new(0.39843405102446616, -0.29059808376945545),
        ]
    );

    let mut x = vec![
        Complex::new(0.0, 0.0),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(-0.11775359816595128, -0.27577802908802723),
    ];
    complex::trsv('u', 'c', 'u', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(0.0000000000000000, 0.0000000000000000),
            Complex::new(-0.11916876584291458, -0.219_515_621_662_139_9),
            Complex::new(0.688_062_223_273_771_6, -0.520_066_890_571_811_8),
            Complex::new(1.1537416954878212, -0.999_724_414_840_022_4),
            Complex::new(-0.827_577_035_353_500_8, 7.358_356_803_020_283E-2),
            Complex::new(1.5551601886103397, -1.4986169107249498),
        ]
    );

    let mut a = matrix::complex::slice(fixtures::complex::matrix_mxn(6, 8), 6, 1, 6, 1, 6);
    matrix::complex::set_upper(&mut a, 6, 6, 0.0);

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::trsv('l', 'c', 'n', 6, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(1.4997211511167985, 1.631_788_200_320_024),
            Complex::new(0.665_070_438_636_381_7, -0.289_185_924_540_532_3),
            Complex::new(-0.573_139_158_418_676_8, -0.555_994_864_309_376_4),
            Complex::new(1.290_923_360_928_301_4E-2, -9.356_986_592_735_02E-2),
            Complex::new(-0.249_415_125_732_530_9, -0.729_069_902_464_181),
            Complex::new(0.0000000000000000, 0.0000000000000000),
        ]
    );

    let mut x = vec![
        Complex::new(-0.6490100777088978, 0.7721421858045301),
        Complex::new(-0.11916876241803812, -0.21951562675343952),
        Complex::new(0.6641356998941105, -0.4248102833772871),
        Complex::new(1.100969102194087, -0.418980099421959),
        Complex::new(0.14377148075806995, 0.9969868609091059),
        Complex::new(0.0, 0.0),
    ];
    complex::trsv('l', 'c', 'u', 6, &a, 6, &mut x, -1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.649_010_062_217_712_4, 0.772_142_171_859_741_2),
            Complex::new(1.011_535_577_764_627, 0.669_308_344_939_886_4),
            Complex::new(1.6199462693950109, -2.646_011_656_725_972),
            Complex::new(7.968_175_036_877_701, 2.1980136848408875),
            Complex::new(-8.208_792_263_241_936, -2.9159109438871607),
            Complex::new(-7.903_664_981_843_492, -8.277_861_224_365_344),
        ]
    );

    let mut x = vec![
        Complex::new(-0.649_010_062_217_712_4, 0.772_142_171_859_741_2),
        Complex::new(-0.11916876584291458, -0.219_515_621_662_139_9),
        Complex::new(0.664_135_694_503_784_2, -0.424_810_290_336_608_9),
        Complex::new(1.1009690761566162, -0.41898009181022644),
        Complex::new(0.143_771_484_494_209_3, 0.996_986_865_997_314_5),
        Complex::new(-0.11775359511375427, -0.27577802538871765),
    ];
    complex::trsv('l', 'c', 'u', 0, &a, 6, &mut x, 1);
    capproximately!(
        x,
        vec![
            Complex::new(-0.649_010_062_217_712_4, 0.772_142_171_859_741_2),
            Complex::new(-0.11916876584291458, -0.219_515_621_662_139_9),
            Complex::new(0.664_135_694_503_784_2, -0.424_810_290_336_608_9),
            Complex::new(1.1009690761566162, -0.41898009181022644),
            Complex::new(0.143_771_484_494_209_3, 0.996_986_865_997_314_5),
            Complex::new(-0.11775359511375427, -0.27577802538871765),
        ]
    );

    let result = std::panic::catch_unwind(|| {
        complex::trsv('x', 't', 'u', 6, &a, 6, &mut [], 1);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::trsv('u', 'x', 'u', 6, &a, 6, &mut [], 1);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::trsv('u', 't', 'x', 6, &a, 6, &mut [], 1);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::trsv('u', 't', 'n', 6, &a, 6, &mut [], 0);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        complex::trsv('u', 't', 'n', 6, &a, 5, &mut [], 1);
    });
    assert!(result.is_err());
}

use libblas::level3;
mod fixtures;
mod utils;

#[test]
fn gemm() {
    let a = fixtures::matrix_mxn(8, 8);
    let b = fixtures::matrix_mxn(8, 8);
    let mut c = fixtures::matrix_mxn(8, 8);
    level3::gemm('n', 'n', 6, 0, 4, 0.3, &a, 8, &b, 8, 0.2, &mut c, 8);
    approximately!(c, fixtures::matrix_mxn(8, 8));

    let mut c = fixtures::matrix_mxn(8, 8);
    level3::gemm('n', 'n', 0, 8, 4, 0.3, &a, 8, &b, 8, 0.2, &mut c, 8);
    approximately!(c, fixtures::matrix_mxn(8, 8));

    let mut c = fixtures::matrix_mxn(8, 8);
    level3::gemm('n', 'n', 6, 8, 4, 0.0, &a, 8, &b, 8, 1.0, &mut c, 8);
    approximately!(c, fixtures::matrix_mxn(8, 8));

    let mut c = fixtures::matrix_mxn(8, 8);
    level3::gemm('n', 'c', 6, 8, 4, 0.0, &a, 8, &b, 8, 0.0, &mut c, 8);
    approximately!(
        c,
        vec![
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            -0.9285670347135381,
            -0.2947204467905602,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            -0.29921511789731614,
            -0.411510832795067,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.1333363608148414,
            0.8041895097449078,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            -0.23570655643950122,
            -0.5428882550102544,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            1.2383041008533804,
            -0.2793462818542693,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            -1.563782051071005,
            1.1565369971501793,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            -0.054877473711578625,
            0.2501413228541527,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            -0.9406491626186084,
            -0.11582532215695436
        ]
    );
    let a = fixtures::matrix_mxn(6, 6);
    let b = fixtures::matrix_mxn(6, 6);
    let mut c = fixtures::matrix_mxn(6, 6);
    level3::gemm('n', 'c', 6, 6, 3, 0.0, &a, 6, &b, 6, 0.75, &mut c, 6);
    approximately!(
        c,
        vec![
            0.947_215_676_307_678_2,
            -0.24467501789331436,
            0.997_349_470_853_805_5,
            0.954_322_010_278_701_8,
            0.310_981_079_936_027_5,
            -1.1549625098705292,
            -0.696_425_288_915_634_2,
            -0.22104033082723618,
            -4.325_379_501_096_904E-3,
            1.8034899830818176,
            0.572_695_076_465_606_7,
            -0.599_256_947_636_604_3,
            -0.860_742_777_585_983_3,
            -0.21709618717432022,
            -0.22441133111715317,
            -0.30863311886787415,
            0.189_167_596_399_784_1,
            -0.668_940_827_250_480_7,
            0.32676248252391815,
            -0.928_153_842_687_606_8,
            -0.16820091381669044,
            0.28304674476385117,
            0.10000227391719818,
            0.603_142_127_394_676_2,
            -4.283_008_072_525_263E-2,
            0.37770599126815796,
            0.814_327_061_176_3,
            -0.518_215_388_059_616_1,
            -0.963_449_478_149_414_1,
            3.504_462_819_546_461E-2,
            -0.17677991464734077,
            -0.407_166_212_797_164_9,
            -0.32498274743556976,
            -0.48710373044013977,
            0.545_063_048_601_150_5,
            0.863_933_801_651_001,
        ]
    );
    let mut c = fixtures::matrix_mxn(6, 6);
    level3::gemm('n', 'n', 4, 6, 3, 0.3, &a, 6, &b, 6, -1.2, &mut c, 6);
    approximately!(
        c,
        vec![
            -1.4039963092403844,
            0.181_241_244_870_223_8,
            -1.2107208849353177,
            -1.444_320_742_259_589,
            0.41464143991470337,
            -1.5399500131607056,
            0.846_545_116_909_699_6,
            0.471_102_266_057_778_5,
            -0.362_494_151_683_487_8,
            -3.451_943_069_493_567,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            1.1260112382918237,
            0.511_251_579_466_748_2,
            -7.142_821_162_956_231E-2,
            -0.11615811188891931,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            6.421_047_087_526_327E-2,
            1.5712993271415543,
            0.465_205_319_317_559_1,
            -1.1516306540304853,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -0.467_226_270_458_776_3,
            -0.737_554_205_519_096_5,
            -1.4240404210621318,
            1.0366043860301484,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            0.493_961_853_020_756_7,
            0.760_162_663_227_518_1,
            0.465_774_870_405_883_6,
            0.35124613688394185,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );
    let mut c = fixtures::matrix_mxn(6, 6);
    level3::gemm('n', 'n', 4, 6, 3, 0.3, &a, 6, &b, 6, 0.0, &mut c, 6);
    approximately!(
        c,
        vec![
            0.11154883307425167,
            -0.21023879931509784,
            0.385_038_331_840_542_9,
            8.259_453_486_049_326E-2,
            0.41464143991470337,
            -1.5399500131607056,
            -0.267_735_389_632_842_6,
            0.11743772268083484,
            -0.369_414_759_160_243_1,
            -0.566_358_981_899_853_5,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.251_177_260_570_301_5,
            0.16389766618523197,
            -0.43048635568469557,
            -0.609_971_121_699_883_2,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.587_030_463_688_531_4,
            8.625_311_983_095_121E-2,
            0.19608384651692823,
            -0.698_755_844_412_695_9,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -0.535_754_402_342_243_7,
            -0.13322459547614354,
            -0.12111707140653165,
            0.207_459_732_187_515_5,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            0.211_113_978_345_647_2,
            0.10869669686512365,
            -5.419_754_615_287_467E-2,
            -0.428_119_862_789_502_9,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );
    let mut c = fixtures::matrix_mxn(6, 6);
    level3::gemm('n', 'n', 4, 6, 3, 0.3, &a, 6, &b, 6, 1.0, &mut c, 6);
    approximately!(
        c,
        vec![
            1.3745030681511559,
            -0.536_472_156_506_183_6,
            1.7148376263122835,
            1.3550238818987623,
            0.41464143991470337,
            -1.5399500131607056,
            -1.1963024415203547,
            -0.17728271842214668,
            -0.375_181_931_828_372_3,
            1.8382943288759033,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -1.3988342973516126,
            -0.12556391671386166,
            -0.729_701_463_840_899_7,
            -1.0214819468570489,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            1.0227137737204224,
            -1.1512853370858578,
            -2.818_403_857_199_234_4E-2,
            -0.321_360_184_727_561,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -0.592_861_176_642_580_5,
            0.370_383_392_881_400_4,
            0.964_652_343_495_201_8,
            -0.483_494_118_558_639_3,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -2.459_257_451_747_384_7E-2,
            -0.434_191_586_864_429_6,
            -0.48750787606696766,
            -1.077_591_503_376_356,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668
        ]
    );
    let mut c = fixtures::matrix_mxn(6, 6);
    level3::gemm('c', 'n', 4, 6, 3, 0.3, &a, 6, &b, 6, 1.0, &mut c, 6);
    approximately!(
        c,
        vec![
            2.3039086064868313,
            -0.651_511_140_300_119_3,
            0.803_928_574_343_569_7,
            1.4691522943492057,
            0.41464143991470337,
            -1.5399500131607056,
            -1.2538448349965456,
            -9.981_379_227_792_52E-3,
            0.340_046_555_616_278_6,
            2.3930913417469486,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -1.6735277569094822,
            5.635_214_538_531_419E-2,
            0.14791521851026912,
            -0.433_918_076_978_285_8,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.632_406_257_342_827_5,
            -1.2491004259456175,
            -0.24667513691004092,
            0.908_880_919_785_652_4,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            0.30512477050075026,
            0.47311061141257815,
            0.964_234_973_969_550_8,
            -0.958_439_240_863_959_3,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.44474478900959474,
            -0.428_477_702_529_908_5,
            -0.266_117_748_314_956_5,
            -0.44957283992730146,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );
    let mut c = fixtures::matrix_mxn(6, 6);
    level3::gemm('c', 'n', 4, 6, 3, 0.3, &a, 6, &b, 6, 0.0, &mut c, 6);
    approximately!(
        c,
        vec![
            1.040_954_371_409_927,
            -0.325_277_783_109_033_5,
            -0.525_870_720_128_171,
            0.196_722_947_310_936_6,
            0.41464143991470337,
            -1.5399500131607056,
            -0.325_277_783_109_033_5,
            0.28473906187518905,
            0.345_813_728_284_407_8,
            -1.156_196_902_880_839E-2,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.525_870_720_128_171,
            0.345_813_728_284_407_8,
            0.44713032666647334,
            -2.240_725_182_112_032E-2,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.196_722_947_310_936_6,
            -1.156_196_902_880_839E-2,
            -2.240_725_182_112_032E-2,
            0.531_485_260_100_517_6,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            0.362_231_544_801_087_1,
            -3.049_737_694_496_577_5E-2,
            -0.121_534_440_932_182_6,
            -0.267_485_390_117_804_4,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.209_038_236_146_473_7,
            0.11441058119964469,
            0.167_192_581_599_136_5,
            0.199_898_800_659_551_6,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );
    let mut c = fixtures::matrix_mxn(6, 6);
    level3::gemm('n', 'c', 4, 6, 3, 0.3, &a, 6, &b, 6, 0.0, &mut c, 6);
    approximately!(
        c,
        vec![
            1.132_322_098_141_46,
            5.815_575_636_994_588E-2,
            0.608_468_178_677_637_5,
            -4.607_655_444_606_67E-2,
            0.41464143991470337,
            -1.5399500131607056,
            5.815_575_636_994_588E-2,
            8.312_290_821_977_292E-2,
            -0.10365417583453679,
            -0.30140785416513954,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            0.608_468_178_677_637_5,
            -0.10365417583453679,
            0.557_378_753_590_356_6,
            0.540_401_377_422_594_2,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            -4.607_655_444_606_67E-2,
            -0.30140785416513954,
            0.540_401_377_422_594_2,
            2.2712326344858456,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -0.14245217765629503,
            -0.12999764483403706,
            0.14145512021468692,
            0.677_996_047_135_052_7,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -5.379_995_750_648_980_4E-2,
            0.29881330774903153,
            -0.532_902_065_376_301_1,
            -1.0541348433374778,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::gemm('n', 'c', 4, 6, 3, 0.3, &a, 6, &b, 6, 1.0, &mut c, 6);
    approximately!(
        c,
        vec![
            2.395_276_333_218_364,
            -0.26807760082113996,
            1.938_267_473_149_378,
            1.2263527925922022,
            0.41464143991470337,
            -1.5399500131607056,
            -0.870_411_295_517_566_2,
            -0.21159753288320862,
            -0.109_421_348_502_666,
            2.103_245_456_610_617,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.539_188_858_103_673_6,
            -0.393_115_758_733_630_4,
            0.258_163_645_434_152_4,
            0.12889055226542873,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.38960675558582425,
            -1.5389463110819486,
            0.31613349233367366,
            2.6486282941709804,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -0.19955895195663187,
            0.37361034352350686,
            1.2272245351164204,
            -1.295_780_361_110_195_8E-2,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.28950651036961084,
            -0.244_074_975_980_521_7,
            -0.966_212_395_290_394_3,
            -1.7036064839243306,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::gemm('n', 'c', 4, 6, 3, 0.3, &a, 6, &b, 6, 0.5, &mut c, 6);
    approximately!(
        c,
        vec![
            1.763_799_215_679_912,
            -0.10496092222559705,
            1.2733678259135077,
            0.590_138_119_073_067_9,
            0.41464143991470337,
            -1.5399500131607056,
            -0.40612776957381014,
            -6.423_731_233_171_787E-2,
            -0.10653776216860139,
            0.900_918_801_222_738_9,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            3.463_966_028_698_187E-2,
            -0.248_384_967_284_083_6,
            0.407_771_199_512_254_5,
            0.334_645_964_844_011_5,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.171_765_100_569_878_8,
            -0.920_177_082_623_544,
            0.42826743487813396,
            2.459_930_464_328_413,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -0.17100556480646345,
            0.12180634934473492,
            0.684_339_827_665_553_6,
            0.332_519_121_761_975_4,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.17165323393805032,
            2.736_916_588_425_492E-2,
            -0.749_557_230_333_347_6,
            -1.3788706636309043,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );
    let mut c = fixtures::matrix_mxn(6, 6);
    level3::gemm('c', 'c', 4, 6, 3, 0.3, &a, 6, &b, 6, 0.5, &mut c, 6);
    approximately!(
        c,
        vec![
            0.743_025_950_612_703_7,
            -0.430_852_068_228_385_5,
            0.413_722_386_665_568_9,
            1.223_245_137_207_666,
            0.41464143991470337,
            -1.5399500131607056,
            -0.674_522_325_258_853_9,
            -2.992_249_787_065_591_5E-2,
            0.16101407985116736,
            1.2885797752188297,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.18879018655011265,
            -0.514_145_550_609_79,
            -0.580_093_909_762_797_7,
            -9.671_566_061_654_535E-3,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.30043618987643866,
            -1.185_128_210_358_258,
            -0.722_105_064_244_343_5,
            -0.510_058_014_570_128_6,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            0.154_437_648_409_706_8,
            6.834_690_995_520_523E-2,
            0.311_174_837_898_305_7,
            -0.591_743_787_847_328_7,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.978_943_001_635_988_8,
            0.22972839886126217,
            0.46299282935915376,
            -0.16936478468399807,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );
    let mut c = fixtures::matrix_mxn(6, 6);
    level3::gemm('c', 'c', 4, 6, 3, 0.3, &a, 6, &b, 6, 0.0, &mut c, 6);
    approximately!(
        c,
        vec![
            0.11154883307425162,
            -0.267_735_389_632_842_6,
            -0.251_177_260_570_301_5,
            0.587_030_463_688_531_4,
            0.41464143991470337,
            -1.5399500131607056,
            -0.21023879931509784,
            0.11743772268083487,
            0.16389766618523197,
            8.625_311_983_095_121E-2,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            0.38503833184054287,
            -0.36941475916024313,
            -0.43048635568469557,
            0.19608384651692823,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            8.259_453_486_049_323E-2,
            -0.566_358_981_899_853_5,
            -0.609_971_121_699_883_2,
            -0.698_755_844_412_696,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            0.18299103555987523,
            -0.18345708422356674,
            -0.23170986955256098,
            -0.246_266_862_474_251_3,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.861_089_725_204_428_3,
            0.501_172_540_726_038_8,
            0.679_647_994_316_200_3,
            0.15537103560942844,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );
    let a = vec![];
    let b = vec![];
    let result = std::panic::catch_unwind(|| {
        level3::gemm('x', 't', 6, 8, 4, 0.0, &a, 8, &b, 8, 0.2, &mut [], 8);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::gemm('c', 'x', 6, 8, 4, 0.0, &a, 8, &b, 8, 0.2, &mut [], 8);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::gemm('n', 'n', 6, 8, 4, 0.0, &a, 4, &b, 8, 0.2, &mut [], 8);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::gemm('n', 'n', 6, 8, 4, 0.0, &a, 8, &b, 3, 0.2, &mut [], 8);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::gemm('n', 'n', 6, 8, 4, 0.0, &a, 8, &b, 8, 0.2, &mut [], 5);
    });
    assert!(result.is_err());
}

#[test]
fn symm() {
    let a = fixtures::matrix_mxn(6, 6);
    let b = fixtures::matrix_mxn(6, 6);
    let mut c = fixtures::matrix_mxn(6, 6);
    level3::symm('l', 'u', 6, 0, 0.3, &a, 6, &b, 6, 0.2, &mut c, 6);
    approximately!(c, a);

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::symm('l', 'u', 0, 0, 0.3, &a, 6, &b, 6, 0.2, &mut c, 6);
    approximately!(c, b);

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::symm('l', 'u', 6, 4, 0.0, &a, 6, &b, 6, 1.0, &mut c, 6);
    approximately!(c, a);

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::symm('l', 'u', 6, 4, 0.0, &a, 6, &b, 6, 0.0, &mut c, 6);
    approximately!(
        c,
        vec![
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            -0.057106774383808755,
            0.5036079722337261,
            1.085769362145687,
            -0.6909538396968303,
            -1.2845993538721883,
            0.04672617218835198,
            -0.23570655643950122,
            -0.5428882550102544,
            -0.4333103174567822,
            -0.6494716467962331,
            0.726750747385451,
            1.1519117540872
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::symm('l', 'u', 4, 6, 0.0, &a, 6, &b, 6, 0.2, &mut c, 6);
    approximately!(
        c,
        vec![
            0.252_590_850_779_277_8,
            -6.524_667_241_046_833E-2,
            0.265_959_862_857_458_9,
            0.25448587319978877,
            0.41464143991470337,
            -1.5399500131607056,
            -0.185_713_413_144_847_9,
            -5.894_408_909_893_167_3E-2,
            -1.153_434_550_813_355E-3,
            0.480_930_669_321_576_7,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.229_531_410_776_546_7,
            -5.789_231_744_248_147E-2,
            -5.984_302_252_297_135_6E-2,
            -8.230_216_625_783_093E-2,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            8.713_666_330_481_562E-2,
            -0.24750769507151382,
            -4.485_357_768_615_45E-2,
            7.547_913_306_175_369E-2,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -1.142_135_503_025_881_7E-2,
            0.10072159917237755,
            0.217_153_886_216_191_7,
            -0.138_190_772_208_433_9,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -4.714_131_127_508_447_4E-2,
            -0.10857765836384381,
            -8.666_206_727_418_402E-2,
            -0.12989433005294693,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::symm('l', 'u', 4, 6, 0.3, &a, 6, &b, 6, 0.2, &mut c, 6);
    approximately!(
        c,
        vec![
            0.530_452_559_372_014_2,
            -0.976_105_541_960_437_2,
            -0.345_520_372_248_133_1,
            0.595_271_620_083_736_4,
            0.41464143991470337,
            -1.5399500131607056,
            -0.13914859611314478,
            -0.666_469_512_575_708_6,
            0.182_874_333_590_873_3,
            0.741_620_427_871_357_7,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.534_495_193_009_661_1,
            0.466_165_255_487_739_1,
            0.414_973_903_978_426_9,
            -0.15130013972862894,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.723_494_626_014_432_4,
            -0.38009509799137947,
            -9.265_214_844_803_212E-2,
            0.649_692_640_044_892_6,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -0.637_486_879_192_853_6,
            0.23434080328254564,
            0.142_107_074_771_527_2,
            -0.48390506072907413,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            7.908_347_745_455_274E-2,
            0.28383508900112775,
            0.12422720543919644,
            -3.527_865_789_126_422E-3,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::symm('l', 'u', 4, 6, 0.3, &a, 6, &b, 6, 0.0, &mut c, 6);
    approximately!(
        c,
        vec![
            0.277_861_708_592_736_5,
            -0.910_858_869_549_969,
            -0.611_480_235_105_591_9,
            0.340_785_746_883_947_6,
            0.41464143991470337,
            -1.5399500131607056,
            4.656_481_703_170_306_5E-2,
            -0.607_525_423_476_777_1,
            0.18402776814168664,
            0.260_689_758_549_781,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.304_963_782_233_114_3,
            0.524_057_572_930_220_6,
            0.47481692650139823,
            -6.899_797_347_079_8E-2,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.636_357_962_709_616_6,
            -0.13258740291986568,
            -4.779_857_076_187_761E-2,
            0.574_213_506_983_138_9,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -0.626_065_524_162_594_9,
            0.133_619_204_110_168_1,
            -7.504_681_144_466_449E-2,
            -0.34571428852064023,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            0.12622478872963722,
            0.39241274736497156,
            0.21088927271338045,
            0.12636646426382053,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::symm('l', 'l', 4, 6, 0.3, &a, 6, &b, 6, 0.0, &mut c, 6);
    approximately!(
        c,
        vec![
            1.526_677_323_672_093,
            0.820_863_662_253_587_5,
            0.22795279043235117,
            0.22665733443350428,
            0.41464143991470337,
            -1.5399500131607056,
            0.592_647_685_991_188_4,
            1.8516542207052114,
            -0.666_277_031_396_762,
            -0.29410725432126406,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.682_956_261_536_362_8,
            -0.15843030315537335,
            -0.379_684_005_899_532_3,
            -0.656_561_843_349_560_8,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.340_785_746_883_947_6,
            0.33941778303287473,
            0.14949312486725058,
            -0.656_027_597_530_074_6,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            9.847_454_717_877_388E-2,
            -0.539_267_936_905_645_5,
            -3.581_657_123_717_309E-2,
            0.12923083378467967,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.45696027866355104,
            -0.396_707_878_003_079_5,
            2.598_184_025_338_994E-2,
            -0.501_652_199_185_234,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::symm('l', 'l', 4, 6, 0.3, &a, 6, &b, 6, 0.2, &mut c, 6);
    approximately!(
        c,
        vec![
            1.7792681744513708,
            0.755_616_989_843_119_2,
            0.493_912_653_289_81,
            0.481_143_207_633_293,
            0.41464143991470337,
            -1.5399500131607056,
            0.40693427284634065,
            1.7927101316062797,
            -0.667_430_465_947_575_4,
            0.18682341500031258,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.912_487_672_312_909_5,
            -0.21632262059785481,
            -0.43952702842250363,
            -0.738_864_009_607_391_7,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.427_922_410_188_763_2,
            9.191_008_796_136_09E-2,
            0.10463954718109607,
            -0.580_548_464_468_320_9,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            8.705_319_214_851_506E-2,
            -0.43854633773326795,
            0.181_337_314_979_018_6,
            -8.959_938_423_754_223E-3,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.504_101_589_938_635_5,
            -0.505_285_536_366_923_3,
            -6.068_022_702_079_407E-2,
            -0.631_546_529_238_180_9,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::symm('r', 'u', 4, 6, 0.3, &a, 6, &b, 6, 0.0, &mut c, 6);
    approximately!(
        c,
        vec![
            1.2069137139176491,
            -7.383_583_476_910_427E-2,
            0.591_194_034_217_915_9,
            6.101_380_702_778_604E-2,
            0.41464143991470337,
            -1.5399500131607056,
            -0.302_051_811_031_503_3,
            0.766_028_376_435_951_5,
            -2.607_463_403_383_318_6E-2,
            -0.670_062_282_826_705_9,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.268_451_405_030_023,
            0.48177209420755546,
            -5.401_594_204_774_443E-3,
            -0.776_000_582_447_962_6,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.694_120_825_162_384_2,
            -5.247_317_874_157_604_6E-2,
            3.005_438_576_884_880_7E-2,
            -0.386_258_396_074_154_6,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -0.655_447_701_482_291_7,
            -0.18914368764400286,
            -0.587_535_632_536_479_8,
            0.25390929255033634,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            3.232_012_468_419_797E-2,
            0.272_011_969_565_532_2,
            7.648_368_711_658_207E-2,
            -0.876_737_780_428_641_7,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::symm('r', 'u', 4, 6, 0.3, &a, 6, &b, 6, 1.0, &mut c, 6);
    approximately!(
        c,
        vec![
            2.4698679489945534,
            -0.40006919196019014,
            1.9209933286896568,
            1.333_443_154_066_055,
            0.41464143991470337,
            -1.5399500131607056,
            -1.2306188629190153,
            0.471_307_935_332_969_9,
            -3.184_180_670_196_239E-2,
            1.7345910279490508,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -1.4161084418113339,
            0.19231051130846183,
            -0.30461670236097865,
            -1.187_511_407_605_128,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            1.129_804_135_194_275,
            -1.290_011_635_658_385,
            -0.19421349932007176,
            -8.862_736_389_019_77E-3,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -0.712_554_475_782_628_5,
            0.31446430071354103,
            0.498_233_782_365_253_5,
            -0.437_044_558_195_818_4,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.20338642817892308,
            -0.270_876_314_164_021_1,
            -0.35682664279751086,
            -1.5262094210154946,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::symm('r', 'l', 4, 6, 0.3, &a, 6, &b, 6, 1.0, &mut c, 6);
    approximately!(
        c,
        vec![
            1.6426051899320373,
            -0.695_424_969_687_450_2,
            1.964_472_497_215_5,
            1.7131834185435835,
            0.41464143991470337,
            -1.5399500131607056,
            -0.610_368_648_495_323_6,
            -0.883_491_077_299_955_7,
            5.591_861_777_121_602_5E-2,
            2.337_871_996_251_067,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.534_226_983_340_804_8,
            -5.696_702_378_222_468E-2,
            0.48395079754499476,
            0.20380064238818776,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.379_784_108_648_158_5,
            -1.7898895539087565,
            0.22963484945810722,
            2.5070282684360445,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -0.16342752448046038,
            0.122_417_200_989_352_8,
            0.793_745_928_268_226_2,
            0.25931383076553666,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.26664938365290924,
            -0.723_187_939_724_173_2,
            -1.1548389885797132,
            -1.8466830909154144,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let a = vec![];
    let b = vec![];
    let result = std::panic::catch_unwind(|| {
        level3::symm('x', 'u', 6, 6, 0.3, &a, 6, &b, 6, 0.2, &mut [], 6);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::symm('l', 'x', 0, 8, 0.3, &a, 6, &b, 6, 0.2, &mut [], 6);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::symm('l', 'u', 6, 4, 0.3, &a, 5, &b, 6, 0.2, &mut [], 6);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::symm('l', 'u', 3, 4, 0.3, &a, 6, &b, 2, 0.2, &mut [], 6);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::symm('l', 'u', 3, 4, 0.3, &a, 6, &b, 6, 0.2, &mut [], 2);
    });
    assert!(result.is_err());
}

#[test]
fn syr2k() {
    let a = fixtures::matrix_mxn(6, 6);
    let b = fixtures::matrix_mxn(6, 6);
    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syr2k('l', 't', 0, 0, 0.2, &a, 6, &b, 6, 0.3, &mut c, 6);
    approximately!(c, a);

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syr2k('l', 't', 6, 0, 0.3, &a, 6, &b, 6, 1.0, &mut c, 6);
    approximately!(c, b);

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syr2k('u', 'n', 6, 3, 0.0, &a, 6, &b, 6, 0.25, &mut c, 6);
    approximately!(
        c,
        vec![
            0.315_738_558_769_226_1,
            -0.326_233_357_191_085_8,
            1.3297992944717407,
            1.272_429_347_038_269,
            0.41464143991470337,
            -1.5399500131607056,
            -0.23214176297187805,
            -7.368_011_027_574_539E-2,
            -5.767_172_668_129_206E-3,
            2.404_653_310_775_757,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.28691425919532776,
            -7.236_539_572_477_341E-2,
            -7.480_377_703_905_106E-2,
            -0.411_510_825_157_165_5,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.10892082750797272,
            -0.30938461422920227,
            -5.606_697_127_223_015E-2,
            9.434_891_492_128_372E-2,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -1.427_669_357_508_421E-2,
            0.125_901_997_089_386,
            0.27144235372543335,
            -0.172_738_462_686_538_7,
            -0.321_149_826_049_804_7,
            4.672_617_092_728_615E-2,
            -5.892_663_821_578_026E-2,
            -0.135_722_070_932_388_3,
            -0.10832758247852325,
            -0.16236791014671326,
            0.18168768286705017,
            0.287_977_933_883_667,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syr2k('u', 'n', 6, 3, 0.0, &a, 6, &b, 6, 0.0, &mut c, 6);
    approximately!(
        c,
        vec![
            0.0000000000000000,
            -0.326_233_357_191_085_8,
            1.3297992944717407,
            1.272_429_347_038_269,
            0.41464143991470337,
            -1.5399500131607056,
            0.0000000000000000,
            0.0000000000000000,
            -5.767_172_668_129_206E-3,
            2.404_653_310_775_757,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            -0.411_510_825_157_165_5,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            4.672_617_092_728_615E-2,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syr2k('l', 'n', 6, 3, 0.0, &a, 6, &b, 6, 0.0, &mut c, 6);
    approximately!(
        c,
        vec![
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            -0.928_567_051_887_512_2,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            -1.147_657_036_781_311,
            -0.28946158289909363,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.43568331003189087,
            -1.237_538_456_916_809,
            -0.224_267_885_088_920_6,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            0.0000000000000000,
            0.0000000000000000,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            0.0000000000000000,
        ]
    );
    let mut mat = fixtures::matrix_mxn(6, 6);
    mat[0] = 0.0;
    let a = mat.clone();
    let b = mat.clone();
    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syr2k('u', 'n', 6, 3, 0.3, &a, 6, &b, 6, -0.5, &mut c, 6);
    approximately!(
        c,
        vec![
            0.676_135_000_776_218_1,
            -0.326_233_357_191_085_8,
            1.3297992944717407,
            1.272_429_347_038_269,
            0.41464143991470337,
            -1.5399500131607056,
            0.827_805_728_559_620_8,
            0.313_606_036_991_036_6,
            -5.767_172_668_129_206E-3,
            2.404_653_310_775_757,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            0.783_079_445_250_892,
            -6.257_756_021_952_676E-2,
            1.2643650612588153,
            -0.411_510_825_157_165_5,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            -1.2742068218292955,
            1.595_352_012_812_546_7E-2,
            1.1929366973896487,
            4.353_767_439_129_124,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -0.570_554_878_194_959,
            -0.511_799_283_846_846,
            -0.25997446702149285,
            1.701_469_019_643_183,
            1.1334711513117268,
            4.672_617_092_728_615E-2,
            1.1771852423451143,
            0.869_070_757_362_839_6,
            -0.849_148_965_795_555_8,
            -1.783_533_866_381_529,
            -1.2475406493787211,
            1.7072752830771618,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syr2k('u', 'n', 6, 3, 0.3, &a, 6, &b, 6, 0.0, &mut c, 6);
    approximately!(
        c,
        vec![
            1.3076121183146703,
            -0.326_233_357_191_085_8,
            1.3297992944717407,
            1.272_429_347_038_269,
            0.41464143991470337,
            -1.5399500131607056,
            0.36352220261586454,
            0.16624581643954583,
            -5.767_172_668_129_206E-3,
            2.404_653_310_775_757,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            0.20925092686023633,
            -0.20730835166907352,
            1.1147575071807132,
            -0.411_510_825_157_165_5,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            -1.056_365_166_813_35,
            -0.602_815_708_330_279_1,
            1.0808027548451884,
            4.542_465_268_971_691,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -0.599_108_265_345_127_3,
            -0.259_995_289_668_074_1,
            0.28291024042937385,
            1.3559920942701056,
            0.49117149921211745,
            4.672_617_092_728_615E-2,
            1.0593319659135538,
            0.597_626_615_498_063,
            -1.0658041307526023,
            -2.1082696866749555,
            -0.884_165_283_644_620_8,
            2.2832311508444953,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syr2k('u', 'n', 6, 3, 0.3, &a, 6, &b, 6, 1.0, &mut c, 6);
    approximately!(
        c,
        vec![
            2.570_566_353_391_575,
            -0.326_233_357_191_085_8,
            1.3297992944717407,
            1.272_429_347_038_269,
            0.41464143991470337,
            -1.5399500131607056,
            -0.565_044_849_271_647_6,
            -0.128_474_624_663_435_7,
            -5.767_172_668_129_206E-3,
            2.404_653_310_775_757,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.938_406_109_921_074_5,
            -0.496_769_934_568_167_3,
            0.815_542_399_024_509,
            -0.411_510_825_157_165_5,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            -0.620_681_856_781_458_9,
            -1.840_354_165_247_088,
            0.856_534_869_756_267_8,
            4.919_860_928_656_826,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -0.656_215_039_645_464_1,
            0.243_612_698_689_469_9,
            1.3686796553311074,
            0.665_038_243_523_950_8,
            -0.793_427_804_987_101_6,
            4.672_617_092_728_615E-2,
            0.823_625_413_050_432_8,
            5.473_833_176_850_984E-2,
            -1.4991144606666955,
            -2.757_741_327_261_808,
            -0.15741455217642017,
            3.4351428863791633,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syr2k('l', 'n', 6, 3, 0.3, &a, 6, &b, 6, 0.0, &mut c, 6);
    approximately!(
        c,
        vec![
            1.3076121183146703,
            0.36352220261586454,
            0.20925092686023633,
            -1.056_365_166_813_35,
            -0.599_108_265_345_127_3,
            1.0593319659135538,
            -0.928_567_051_887_512_2,
            0.16624581643954583,
            -0.20730835166907352,
            -0.602_815_708_330_279_1,
            -0.259_995_289_668_074_1,
            0.597_626_615_498_063,
            -1.147_657_036_781_311,
            -0.28946158289909363,
            1.1147575071807132,
            1.0808027548451884,
            0.28291024042937385,
            -1.0658041307526023,
            0.43568331003189087,
            -1.237_538_456_916_809,
            -0.224_267_885_088_920_6,
            4.542_465_268_971_691,
            1.3559920942701056,
            -2.1082696866749555,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            0.49117149921211745,
            -0.884_165_283_644_620_8,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            2.2832311508444953,
        ],
        1E-5
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syr2k('l', 'n', 6, 3, 0.3, &a, 6, &b, 6, 0.5, &mut c, 6);
    approximately!(
        c,
        vec![
            1.9390892358531224,
            0.20040552402032166,
            0.874_150_574_096_106_9,
            -0.420_150_493_294_215_3,
            -0.391_787_545_387_775_7,
            0.28935695933320105,
            -0.928_567_051_887_512_2,
            1.888_559_588_805_503_7E-2,
            -0.21019193800313812,
            0.599_510_947_057_599_4,
            0.12180142797566368,
            0.19812198374032686,
            -1.147_657_036_781_311,
            -0.28946158289909363,
            0.965_149_953_102_611_1,
            0.875_047_342_266_605_6,
            0.40902197136256324,
            -1.511_764_682_252_923,
            0.43568331003189087,
            -1.237_538_456_916_809,
            -0.224_267_885_088_920_6,
            4.731_163_098_814_259,
            1.422_660_276_881_571,
            -1.7061749350785047,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -0.15112815288749185,
            -0.860_802_198_180_977_7,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            2.8591870186118293,
        ],
        1E-5
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syr2k('l', 'n', 6, 3, 0.3, &a, 6, &b, 6, 1.0, &mut c, 6);
    approximately!(
        c,
        vec![
            2.570_566_353_391_575,
            3.728_884_542_477_873E-2,
            1.5390502213319772,
            0.216_064_180_224_919_2,
            -0.184_466_825_430_424,
            -0.48061804724715174,
            -0.928_567_051_887_512_2,
            -0.128_474_624_663_435_7,
            -0.21307552433720273,
            1.8018376024454774,
            0.503_598_145_619_401_4,
            -0.201_382_648_017_409_4,
            -1.147_657_036_781_311,
            -0.28946158289909363,
            0.815_542_399_024_509,
            0.669_291_929_688_022_9,
            0.535_133_702_295_752_5,
            -1.9577252337532434,
            0.43568331003189087,
            -1.237_538_456_916_809,
            -0.224_267_885_088_920_6,
            4.919_860_928_656_826,
            1.4893284594930365,
            -1.304_080_183_482_054,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -0.793_427_804_987_101_6,
            -0.837_439_112_717_334_6,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            3.4351428863791633,
        ],
        1E-5
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syr2k('u', 't', 6, 3, 0.3, &a, 6, &b, 6, 1.0, &mut c, 6);
    approximately!(
        c,
        vec![
            2.3878308999285087,
            -0.326_233_357_191_085_8,
            1.3297992944717407,
            1.272_429_347_038_269,
            0.41464143991470337,
            -1.5399500131607056,
            -0.875_479_975_704_808_4,
            0.27475768264739653,
            -5.767_172_668_129_206E-3,
            2.404_653_310_775_757,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -1.3297354534690902,
            0.402_165_873_669_722,
            0.595_045_545_176_742_5,
            -0.411_510_825_157_165_5,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.49898034260056723,
            -1.260_662_394_974_426,
            -0.26908238873116125,
            1.440_366_179_886_17,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            0.710_630_262_493_904_3,
            0.44261323446761236,
            0.842_700_533_037_368_2,
            -1.2259246309817637,
            -0.423_132_822_800_873_1,
            4.672_617_092_728_615E-2,
            -0.475_171_064_554_353,
            -0.314_067_121_330_263_8,
            -9.892_516_671_582E-2,
            -0.24967403926774986,
            0.288_500_190_690_795_2,
            1.4747376141728323,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syr2k('u', 't', 6, 3, 0.3, &a, 6, &b, 6, 0.0, &mut c, 6);
    approximately!(
        c,
        vec![
            1.1248766648516044,
            -0.326_233_357_191_085_8,
            1.3297992944717407,
            1.272_429_347_038_269,
            0.41464143991470337,
            -1.5399500131607056,
            5.308_707_618_270_385_6E-2,
            0.569_478_123_750_378_1,
            -5.767_172_668_129_206E-3,
            2.404_653_310_775_757,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.18207841668777927,
            0.691_627_456_568_815_6,
            0.894_260_653_332_946_7,
            -0.411_510_825_157_165_5,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            6.329_703_256_867_63E-2,
            -2.312_393_805_761_678E-2,
            -4.481_450_364_224_064E-2,
            1.062_970_520_201_035,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            0.767_737_036_794_241_1,
            -6.099_475_388_993_155E-2,
            -0.243_068_881_864_365_2,
            -0.534_970_780_235_608_8,
            0.861_466_481_398_345_6,
            4.672_617_092_728_615E-2,
            -0.23946451169123192,
            0.22882116239928937,
            0.334_385_163_198_273,
            0.399_797_601_319_103_2,
            -0.43825054077740544,
            0.32282587863816453,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syr2k('u', 't', 6, 3, 0.3, &a, 6, &b, 6, 0.4, &mut c, 6);
    approximately!(
        c,
        vec![
            1.630_058_366_410_16,
            -0.326_233_357_191_085_8,
            1.3297992944717407,
            1.272_429_347_038_269,
            0.41464143991470337,
            -1.5399500131607056,
            -0.318_339_750_106_992,
            0.45158994555251475,
            -5.767_172_668_129_206E-3,
            2.404_653_310_775_757,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.641_141_238_240_872_8,
            0.575_842_821_683_852_7,
            0.774_574_608_287_004,
            -0.411_510_825_157_165_5,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.23757035917830754,
            -0.518_139_328_200_644_3,
            -0.13452165901454965,
            1.2139287863245425,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            0.744_894_326_733_723_5,
            0.14044844445482357,
            0.191_238_890_568_018_2,
            -0.811_352_324_652_476_8,
            0.34762675206184956,
            4.672_617_092_728_615E-2,
            -0.333_747_134_241_400_9,
            1.166_584_567_160_175_4E-2,
            0.16106102864990496,
            0.14000894121320934,
            -0.14755024385835325,
            0.783_590_579_717_960_8,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syr2k('l', 't', 6, 3, 0.3, &a, 6, &b, 6, 0.0, &mut c, 6);
    approximately!(
        c,
        vec![
            1.1248766648516044,
            5.308_707_618_270_385_6E-2,
            -0.18207841668777927,
            6.329_703_256_867_63E-2,
            0.767_737_036_794_241_1,
            -0.23946451169123192,
            -0.928_567_051_887_512_2,
            0.569_478_123_750_378_1,
            0.691_627_456_568_815_6,
            -2.312_393_805_761_678E-2,
            -6.099_475_388_993_155E-2,
            0.22882116239928937,
            -1.147_657_036_781_311,
            -0.28946158289909363,
            0.894_260_653_332_946_7,
            -4.481_450_364_224_064E-2,
            -0.243_068_881_864_365_2,
            0.334_385_163_198_273,
            0.43568331003189087,
            -1.237_538_456_916_809,
            -0.224_267_885_088_920_6,
            1.062_970_520_201_035,
            -0.534_970_780_235_608_8,
            0.399_797_601_319_103_2,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            0.861_466_481_398_345_6,
            -0.43825054077740544,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            0.32282587863816453,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syr2k('l', 't', 6, 3, 0.3, &a, 6, &b, 6, 0.2, &mut c, 6);
    approximately!(
        c,
        vec![
            1.3774675156308822,
            -1.215_959_622_776_447_2E-2,
            8.388_144_616_967_962E-2,
            0.31778290576846513,
            0.850_665_326_012_909_6,
            -0.547_454_518_912_781_7,
            -0.928_567_051_887_512_2,
            0.510_534_034_651_446_4,
            0.690_474_022_018_002_3,
            0.457_806_731_263_959_9,
            9.172_393_544_324_933E-2,
            6.901_930_731_496_173E-2,
            -1.147_657_036_781_311,
            -0.28946158289909363,
            0.834_417_630_809_975_3,
            -0.127_116_669_900_071_6,
            -0.19262418873940496,
            0.156_000_939_940_012_8,
            0.43568331003189087,
            -1.237_538_456_916_809,
            -0.224_267_885_088_920_6,
            1.1384496532627888,
            -0.508_303_506_793_649_3,
            0.560_635_504_354_354_9,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            0.604_546_616_730_097_6,
            -0.42890530645269337,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            0.553_208_229_178_062_7,
        ]
    );

    let a = vec![];
    let b = vec![];
    let result = std::panic::catch_unwind(|| {
        level3::syr2k('x', 'u', 6, 3, 0.3, &a, 6, &b, 6, 0.2, &mut [], 6);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::syr2k('l', 'x', 6, 3, 0.3, &a, 6, &b, 6, 0.2, &mut [], 6);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::syr2k('t', 'u', 6, 3, 0.3, &a, 2, &b, 6, 0.2, &mut [], 6);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::syr2k('t', 'u', 6, 3, 0.3, &a, 6, &b, 2, 0.2, &mut [], 6);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::syr2k('t', 'u', 6, 3, 0.3, &a, 6, &b, 6, 0.2, &mut [], 5);
    });
    assert!(result.is_err());
}

#[test]
fn syrk() {
    let a = fixtures::matrix_mxn(6, 6);
    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syrk('l', 't', 0, 3, 0.2, &a, 6, 1.0, &mut c, 6);
    approximately!(c, a);

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syrk('l', 't', 5, 0, 0.2, &a, 6, 1.0, &mut c, 6);
    approximately!(c, a);

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syrk('l', 't', 5, 3, 0.0, &a, 6, 0.25, &mut c, 6);
    approximately!(
        c,
        vec![
            0.315_738_558_769_226_1,
            -8.155_833_929_777_145E-2,
            0.332_449_823_617_935_2,
            0.31810733675956726,
            0.10366035997867584,
            -1.5399500131607056,
            -0.928_567_051_887_512_2,
            -7.368_011_027_574_539E-2,
            -1.441_793_167_032_301_4E-3,
            0.601_163_327_693_939_2,
            0.190_898_358_821_868_9,
            -0.799_009_263_515_472_4,
            -1.147_657_036_781_311,
            -0.28946158289909363,
            -7.480_377_703_905_106E-2,
            -0.10287770628929138,
            6.305_586_546_659_47E-2,
            -0.891_921_103_000_640_9,
            0.43568331003189087,
            -1.237_538_456_916_809,
            -0.224_267_885_088_920_6,
            9.434_891_492_128_372E-2,
            3.333_409_130_573_273E-2,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -0.321_149_826_049_804_7,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syrk('u', 't', 5, 3, 0.0, &a, 6, 0.0, &mut c, 6);
    approximately!(
        c,
        vec![
            0.0000000000000000,
            -0.326_233_357_191_085_8,
            1.3297992944717407,
            1.272_429_347_038_269,
            0.41464143991470337,
            -1.5399500131607056,
            0.0000000000000000,
            0.0000000000000000,
            -5.767_172_668_129_206E-3,
            2.404_653_310_775_757,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            -0.411_510_825_157_165_5,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut mat = fixtures::matrix_mxn(6, 6);
    mat[0] = 0.0;
    let a = mat;

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syrk('u', 'n', 5, 3, 0.5, &a, 6, 0.0, &mut c, 6);
    approximately!(
        c,
        vec![
            1.0896767219623626,
            -0.326_233_357_191_085_8,
            1.3297992944717407,
            1.272_429_347_038_269,
            0.41464143991470337,
            -1.5399500131607056,
            0.302_935_156_808_992_2,
            0.13853817486127573,
            -5.767_172_668_129_206E-3,
            2.404_653_310_775_757,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            0.174_375_765_454_459_9,
            -0.17275695285948342,
            0.928_964_552_403_526_2,
            -0.411_510_825_157_165_5,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            -0.880_304_270_697_642_7,
            -0.502_346_403_647_113_2,
            0.900_668_926_581_622_8,
            3.785_387_573_725_288,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -0.49925686794892066,
            -0.21666273278065828,
            0.235_758_524_322_942_8,
            1.1299933669898525,
            0.409_309_566_412_263_7,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syrk('l', 'n', 5, 3, 0.5, &a, 6, 0.1, &mut c, 6);
    approximately!(
        c,
        vec![
            1.2159721473520015,
            0.270_311_820_603_758,
            0.307_355_696_883_189_3,
            -0.753_061_334_097_748_3,
            -0.457_792_723_339_586_4,
            -1.5399500131607056,
            -0.928_567_051_887_512_2,
            0.109_066_130_311_809_9,
            -0.173_333_670_134_890_1,
            -0.261_881_068_986_324_9,
            -0.14030338811406784,
            -0.799_009_263_515_472_4,
            -1.147_657_036_781_311,
            -0.28946158289909363,
            0.899_043_041_142_040_5,
            0.859_517_843_452_707_3,
            0.26098087088542293,
            -0.891_921_103_000_640_9,
            0.43568331003189087,
            -1.237_538_456_916_809,
            -0.224_267_885_088_920_6,
            3.8231271402561644,
            1.1433270037108323,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            0.280_849_634_078_139_7,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syrk('l', 'n', 5, 3, 0.5, &a, 6, 1.0, &mut c, 6);
    approximately!(
        c,
        vec![
            2.352_630_957_039_267,
            -2.329_820_038_209_362_6E-2,
            1.5041750599262007,
            0.392_125_076_340_626_3,
            -8.461_542_803_421_729E-2,
            -1.5399500131607056,
            -0.928_567_051_887_512_2,
            -0.15618226624170584,
            -0.17852412552761263,
            1.9023069071286436,
            0.546_930_702_506_817_3,
            -0.799_009_263_515_472_4,
            -1.147_657_036_781_311,
            -0.28946158289909363,
            0.629_749_444_247_321_9,
            0.489_158_101_424_457_3,
            0.48798198618932154,
            -0.891_921_103_000_640_9,
            0.43568331003189087,
            -1.237_538_456_916_809,
            -0.224_267_885_088_920_6,
            4.162_783_233_410_423,
            1.2633297322127834,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -0.875_289_737_786_955_1,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syrk('u', 't', 5, 3, 0.5, &a, 6, 1.0, &mut c, 6);
    approximately!(
        c,
        vec![
            2.2003514185377573,
            -0.326_233_357_191_085_8,
            1.3297992944717407,
            1.272_429_347_038_269,
            0.41464143991470337,
            -1.5399500131607056,
            -0.884_327_823_493_168,
            0.17984464316481136,
            -5.767_172_668_129_206E-3,
            2.404_653_310_775_757,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -1.2993890446585055,
            0.286_894_608_005_915_4,
            0.44600207334231445,
            -0.411_510_825_157_165_5,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.488_430_835_076_456_1,
            -1.2568084045324375,
            -0.261_613_303_306_814_2,
            1.2632043913204543,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            0.582_674_064_272_257_7,
            0.45277902880236237,
            0.883_212_021_397_003_4,
            -1.1367628165609722,
            -0.566_710_598_226_931_6,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syrk('l', 't', 5, 3, 0.5, &a, 6, 1.0, &mut c, 6);
    approximately!(
        c,
        vec![
            2.2003514185377573,
            -0.28199412879674157,
            1.1780672865945463,
            1.3251768720828343,
            1.0544222784872979,
            -1.5399500131607056,
            -0.928_567_051_887_512_2,
            0.17984464316481136,
            0.570_589_018_236_879_8,
            2.3853833631601282,
            0.712_764_475_732_294,
            -0.799_009_263_515_472_4,
            -1.147_657_036_781_311,
            -0.28946158289909363,
            0.44600207334231445,
            -0.44885624337505914,
            4.966_606_836_164_877_4E-2,
            -0.891_921_103_000_640_9,
            0.43568331003189087,
            -1.237_538_456_916_809,
            -0.224_267_885_088_920_6,
            1.2632043913204543,
            -0.312_472_600_591_886_4,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -0.566_710_598_226_931_6,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syrk('l', 't', 5, 3, 0.5, &a, 6, -0.3, &mut c, 6);
    approximately!(
        c,
        vec![
            0.558_510_897_882_194,
            0.14210923944067463,
            -0.550_671_812_071_159_6,
            -0.328_981_294_235_455_3,
            0.515_388_401_655_272_3,
            -1.5399500131607056,
            -0.928_567_051_887_512_2,
            0.562_981_220_112_028_8,
            0.578_086_342_774_197_8,
            -0.740_665_969_514_056_7,
            -0.27990699924416734,
            -0.799_009_263_515_472_4,
            -1.147_657_036_781_311,
            -0.28946158289909363,
            0.834_981_717_512_302,
            8.610_783_423_484_736E-2,
            -0.278_224_435_071_381_6,
            -0.891_921_103_000_640_9,
            0.43568331003189087,
            -1.237_538_456_916_809,
            -0.224_267_885_088_920_6,
            0.772_590_029_230_872_2,
            -0.48580987697118994,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            1.1032685125456698,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut c = fixtures::matrix_mxn(6, 6);
    level3::syrk('l', 't', 5, 3, 0.5, &a, 6, 0., &mut c, 6);
    approximately!(
        c,
        vec![
            0.937_397_183_460_853,
            4.423_922_839_434_421_6E-2,
            -0.15173200787719443,
            5.274_752_504_456_526E-2,
            0.639_780_838_572_594_5,
            -1.5399500131607056,
            -0.928_567_051_887_512_2,
            0.474_565_084_267_792_9,
            0.576_356_190_905_009,
            -1.926_994_761_562_839_5E-2,
            -5.082_895_955_518_157_4E-2,
            -0.799_009_263_515_472_4,
            -1.147_657_036_781_311,
            -0.28946158289909363,
            0.745_217_181_498_518_7,
            -3.734_541_821_789_361E-2,
            -0.202_557_393_504_73,
            -0.891_921_103_000_640_9,
            0.43568331003189087,
            -1.237_538_456_916_809,
            -0.224_267_885_088_920_6,
            0.885_808_731_635_319_5,
            -0.445_808_965_814_817_3,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            0.717_888_705_972_287_2,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let a = vec![];
    let result = std::panic::catch_unwind(|| {
        level3::syrk('x', 't', 6, 3, 0.0, &a, 6, 0.0, &mut [], 6);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::syrk('l', 'x', 6, 3, 0.3, &a, 6, 0.2, &mut [], 6);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::syrk('t', 'u', 6, 3, 0.3, &a, 2, 0.2, &mut [], 6);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::syrk('t', 'u', 6, 3, 0.3, &a, 6, 0.2, &mut [], 5);
    });
    assert!(result.is_err());
}

#[test]
fn trmm() {
    let a = fixtures::matrix_mxn(6, 6);
    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trmm('l', 'u', 'n', 'u', 3, 0, 0.25, &a, 6, &mut b, 6);
    approximately!(b, a);

    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trmm('l', 'u', 'n', 'u', 0, 4, 0.25, &a, 6, &mut b, 6);
    approximately!(b, a);

    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trmm('l', 'u', 'n', 'u', 4, 5, 0.0, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.0,
            0.0,
            0.0,
            0.0,
            0.4146414344564082,
            -1.5399500419037095,
            0.0,
            0.0,
            0.0,
            0.0,
            0.7635934611404596,
            -0.7990092489893682,
            0.0,
            0.0,
            0.0,
            0.0,
            0.2522234481561323,
            -0.8919211272845686,
            0.0,
            0.0,
            0.0,
            0.0,
            0.1333363608148414,
            0.8041895097449078,
            0.0,
            0.0,
            0.0,
            0.0,
            -1.2845993538721883,
            0.04672617218835198,
            -0.23570655643950122,
            -0.5428882550102544,
            -0.4333103174567822,
            -0.6494716467962331,
            0.726750747385451,
            1.1519117540872
        ]
    );

    let data2 = vec![
        0.0,
        -0.3262333607056494,
        1.3297992629225006,
        1.2724293214294047,
        0.4146414344564082,
        -1.5399500419037095,
        -0.9285670347135381,
        -0.2947204467905602,
        -0.005767172747536955,
        2.404653388857951,
        0.7635934611404596,
        -0.7990092489893682,
        -1.1476570092363514,
        -0.28946157368822334,
        -0.29921511789731614,
        -0.411510832795067,
        0.2522234481561323,
        -0.8919211272845686,
        0.43568329935571865,
        -1.237538421929958,
        -0.22426788527830935,
        0.37739564598170106,
        0.1333363608148414,
        0.8041895097449078,
        -0.057106774383808755,
        0.5036079722337261,
        1.085769362145687,
        -0.6909538396968303,
        -1.2845993538721883,
        0.04672617218835198,
        -0.23570655643950122,
        -0.5428882550102544,
        -0.4333103174567822,
        -0.6494716467962331,
        0.726750747385451,
        1.1519117540872,
    ];
    b = data2.clone();
    level3::trmm('l', 'u', 'n', 'n', 4, 5, 0.2, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            -0.13376955027205623,
            -0.37269168964382426,
            -0.13665221769762764,
            9.604_186_399_678_187E-2,
            0.41464143991470337,
            -1.5399500131607056,
            3.104_321_058_350_226_2E-2,
            -0.577_464_295_465_692_7,
            -0.107_512_179_039_276_3,
            0.181_501_147_211_429_9,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.20330918310617146,
            0.13623640118971414,
            3.636_366_922_148_550_5E-2,
            -3.106_048_032_838_975_4E-2,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.424_238_631_270_330_9,
            -7.479_365_195_080_606E-3,
            -3.506_677_441_549_297E-3,
            2.848_549_721_430_261E-2,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -0.417_377_005_742_726_7,
            7.847_397_322_545_822E-2,
            -3.398_397_132_872_76E-2,
            -5.215_259_764_000_012E-2,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    b = data2.clone();
    level3::trmm('l', 'u', 'n', 'u', 4, 5, 0.2, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            -0.13376955027205623,
            -0.45716789012760756,
            0.20888685428993503,
            0.25448587319978877,
            0.41464143991470337,
            -1.5399500131607056,
            7.987_733_908_052_683E-2,
            -0.653_780_412_504_275,
            -0.10901073863396238,
            0.480_930_669_321_576_7,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.14295292655930192,
            6.128_203_441_411_07E-2,
            -4.138_528_975_809_089E-2,
            -8.230_216_625_783_093E-2,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.401_325_676_623_859_3,
            -0.32793263733445327,
            -6.178_112_322_625_923E-2,
            7.547_913_306_175_369E-2,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -0.414_373_712_067_203_2,
            0.208_880_286_534_516_6,
            0.24814563843818194,
            -0.138_190_772_208_433_9,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    b = data2.clone();
    level3::trmm('l', 'l', 'n', 'n', 4, 5, 0.2, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.0000000000000000,
            1.922_952_807_331_496_4E-2,
            -7.920_292_030_429_177E-2,
            -0.170_299_125_455_311_5,
            0.41464143991470337,
            -1.5399500131607056,
            -0.234_547_541_641_872_5,
            7.795_793_818_530_945E-2,
            -0.246_276_499_990_485_8,
            -0.19607149801135446,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.28988766732341625,
            9.194_285_205_156_097E-2,
            -0.28699089666230115,
            -0.43770788469578115,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.11004961795128716,
            4.451_869_086_349_952E-2,
            0.13072256109808894,
            -0.437_351_720_824_969_1,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -1.442_464_870_578_227_8E-2,
            -2.595_868_714_148_818_7E-2,
            -8.074_471_226_570_451E-2,
            8.615_388_705_013_155E-2,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    b = data2.clone();
    level3::trmm('l', 'l', 'n', 'u', 4, 5, 0.2, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.0000000000000000,
            -6.524_667_241_046_833E-2,
            0.266_336_151_683_270_9,
            -1.185_511_625_230_462E-2,
            0.41464143991470337,
            -1.5399500131607056,
            -0.185_713_413_144_847_9,
            1.641_821_146_727_187_6E-3,
            -0.24777505958517188,
            0.10335802409879236,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.229_531_410_776_546_7,
            1.698_848_527_595_753_2E-2,
            -0.36473985564187755,
            -0.488_949_570_625_222_4,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            8.713_666_330_481_562E-2,
            -0.275_934_581_275_873_1,
            7.244_811_531_337_902E-2,
            -0.390_358_084_977_518,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -1.142_135_503_025_881_7E-2,
            0.10444762616757018,
            0.20138489750120506,
            1.157_124_816_977_498_5E-4,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    b = data2.clone();
    level3::trmm('l', 'u', 't', 'n', 4, 5, 0.2, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.0000000000000000,
            1.922_952_807_331_496_4E-2,
            -6.069_280_405_527_101E-2,
            0.11714087432900773,
            0.41464143991470337,
            -1.5399500131607056,
            -0.234_547_541_641_872_5,
            0.18981938447952956,
            0.230_542_479_797_354_2,
            0.173_793_168_050_320_7,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.28988766732341625,
            0.230_197_354_753_481_5,
            0.29808687704124803,
            -4.599_864_783_814_324E-2,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.11004961795128716,
            -7.966_657_488_408_597E-3,
            -1.493_816_750_975_348_3E-2,
            0.382_808_995_148_261_9,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -1.442_464_870_578_227_8E-2,
            -1.907_922_016_767_277_6E-2,
            -8.102_295_860_922_815E-2,
            -0.23047618662315555,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    b = data2.clone();
    level3::trmm('l', 'u', 't', 'u', 4, 5, 0.2, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.0000000000000000,
            -6.524_667_241_046_833E-2,
            0.284_846_267_932_291_7,
            0.275_584_883_532_014_6,
            0.41464143991470337,
            -1.5399500131607056,
            -0.185_713_413_144_847_9,
            0.113_503_267_440_947_3,
            0.22904392020266814,
            0.473_222_690_160_467_5,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.229_531_410_776_546_7,
            0.15524298797787806,
            0.220_337_918_061_671_6,
            -9.724_033_376_758_441E-2,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            8.713_666_330_481_562E-2,
            -0.328_419_929_627_781_2,
            -7.321_261_329_446_341E-2,
            0.429_802_630_995_712_9,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -1.142_135_503_025_881_7E-2,
            0.11132709314138559,
            0.201_106_651_157_681_4,
            -0.316_514_361_191_589_3,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    b = data2.clone();
    level3::trmm('l', 'l', 't', 'n', 4, 5, 0.2, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.698_774_172_437_734_8,
            0.629_645_989_156_955_6,
            -0.18430290080139067,
            9.604_186_399_678_187E-2,
            0.41464143991470337,
            -1.5399500131607056,
            0.39509844751508305,
            1.1738502062335965,
            -0.197_563_051_532_037_2,
            0.181_501_147_211_429_9,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.455_304_163_049_974_1,
            -0.18050100219891524,
            5.177_416_880_558_727E-2,
            -3.106_048_032_838_975_4E-2,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.227_190_492_280_294_9,
            0.254_705_402_606_588_1,
            -1.763_961_222_983_432_8E-2,
            2.848_549_721_430_261E-2,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            6.564_969_648_875_475E-2,
            -0.36323797600371394,
            -8.108_724_850_119_332E-3,
            -5.215_259_764_000_012E-2,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    b = data2.clone();
    level3::trmm('l', 'l', 't', 'u', 4, 5, 0.2, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.698_774_172_437_734_8,
            0.545_169_788_673_172_2,
            0.161_236_171_186_172,
            0.25448587319978877,
            0.41464143991470337,
            -1.5399500131607056,
            0.44393257601210767,
            1.0975340891950143,
            -0.199_061_611_126_723_3,
            0.480_930_669_321_576_7,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.394_947_906_503_104_6,
            -0.255_455_368_974_518_7,
            -2.597_479_017_398_912_3E-2,
            -8.230_216_625_783_093E-2,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.20427753763382334,
            -6.574_786_953_278_453E-2,
            -7.591_405_801_454_426E-2,
            7.547_913_306_175_369E-2,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            6.865_299_016_427_821E-2,
            -0.23283166269465555,
            0.274_020_884_916_790_2,
            -0.138_190_772_208_433_9,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    b = data2.clone();
    level3::trmm('r', 'u', 'n', 'n', 4, 5, 0.2, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.0000000000000000,
            -8.240_356_124_547_639E-2,
            0.335_895_135_156_300_3,
            0.321_404_011_324_917_3,
            0.41464143991470337,
            -1.5399500131607056,
            5.473_353_904_078_983E-2,
            7.795_793_818_530_945E-2,
            -0.246_621_625_034_358_5,
            -0.37804729602655435,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            0.12243616443525157,
            0.10926510807652637,
            -0.28699089666230115,
            -0.40664740436739144,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.314_189_013_319_043_7,
            -3.590_625_139_943_99E-2,
            0.11379501555798423,
            -0.43735172082496915,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -0.388_280_492_312_061_7,
            -4.718_689_599_401_796E-2,
            -0.328_708_691_181_190_4,
            0.26367365687583844,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let a = vec![
        1.2629542848807933,
        -0.3262333607056494,
        1.3297992629225006,
        1.2724293214294047,
        0.4146414344564082,
        -1.5399500419037095,
        -0.9285670347135381,
        -0.2947204467905602,
        -0.005767172747536955,
        2.404653388857951,
        0.7635934611404596,
        -0.7990092489893682,
        -1.1476570092363514,
        -0.28946157368822334,
        -0.29921511789731614,
        -0.411510832795067,
        0.2522234481561323,
        -0.8919211272845686,
        0.43568329935571865,
        -1.237538421929958,
        -0.22426788527830935,
        0.37739564598170106,
        0.1333363608148414,
        0.8041895097449078,
        0.0,
        0.5036079722337261,
        1.085769362145687,
        -0.6909538396968303,
        -1.2845993538721883,
        0.04672617218835198,
        -0.23570655643950122,
        -0.5428882550102544,
        -0.4333103174567822,
        -0.6494716467962331,
        0.726750747385451,
        1.1519117540872,
    ];

    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trmm('r', 'u', 'n', 'u', 4, 5, 0.2, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.252_590_850_779_277_8,
            -6.524_667_241_046_833E-2,
            0.265_959_862_857_458_9,
            0.25448587319978877,
            0.41464143991470337,
            -1.5399500131607056,
            -0.42026095478672043,
            1.641_821_146_727_187_6E-3,
            -0.248_115_000_324_771,
            0.244_623_472_297_429_6,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.465_662_179_565_462,
            3.405_053_460_907_95E-2,
            -0.36473985564187755,
            -0.513_575_622_203_549_1,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.47849029604446414,
            -0.19000561661229257,
            8.586_898_341_193_445E-2,
            -0.39035808497751806,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -0.414_373_712_067_203_2,
            0.179_195_572_397_835_8,
            0.18258903603362686,
            -3.750_401_783_485_788E-2,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let a = vec![
        1.2629542848807933,
        0.0,
        1.3297992629225006,
        1.2724293214294047,
        0.4146414344564082,
        -1.5399500419037095,
        -0.9285670347135381,
        -0.2947204467905602,
        -0.005767172747536955,
        2.404653388857951,
        0.7635934611404596,
        -0.7990092489893682,
        -1.1476570092363514,
        -0.28946157368822334,
        -0.29921511789731614,
        -0.411510832795067,
        0.2522234481561323,
        -0.8919211272845686,
        0.43568329935571865,
        -1.237538421929958,
        -0.22426788527830935,
        0.37739564598170106,
        0.1333363608148414,
        0.8041895097449078,
        -0.057106774383808755,
        0.5036079722337261,
        1.085769362145687,
        -0.6909538396968303,
        -1.2845993538721883,
        0.04672617218835198,
        -0.23570655643950122,
        -0.5428882550102544,
        -0.4333103174567822,
        -0.6494716467962331,
        0.726750747385451,
        1.1519117540872,
    ];
    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trmm('r', 'l', 'n', 'n', 4, 5, 0.2, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.11991945712012861,
            -0.43256143005126935,
            0.28928391752242805,
            0.25070089192710987,
            0.41464143991470337,
            -1.5399500131607056,
            0.25686948050218156,
            -0.500_553_943_546_008_7,
            5.864_504_366_217_024E-2,
            -6.528_586_746_287_44E-2,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            2.994_085_197_780_692E-2,
            0.14457870228456704,
            9.113_497_416_067_11E-2,
            -4.128_938_371_446_233_5E-2,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            3.136_211_656_502_703E-2,
            -7.997_847_792_557_539E-2,
            1.202_696_434_199_619_3E-2,
            1.005_964_194_068_001_8E-2,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            1.467_186_472_488_272_3E-2,
            -0.129_386_896_214_668_8,
            -0.278_955_731_137_476_2,
            0.177_519_769_825_706_9,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trmm('r', 'l', 'n', 'u', 4, 5, 0.2, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            5.349_962_316_603_916E-2,
            -0.41540454121626136,
            0.219_348_645_223_586_6,
            0.18378275380198134,
            0.41464143991470337,
            -1.5399500131607056,
            1.642_252_831_654_379_3E-2,
            -0.576_870_060_584_591_1,
            5.715_166_837_175_775E-2,
            0.557_384_900_861_109_6,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -0.26826982469949034,
            6.936_412_881_712_016E-2,
            1.338_601_518_109_469_6E-2,
            -0.14821760155062005,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            8.561_378_133_916_027E-2,
            -0.23407784313842803,
            -1.589_906_780_405_358_3E-2,
            5.705_327_778_813_11E-2,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -1.142_135_503_025_881_7E-2,
            0.10072159917237755,
            0.217_153_886_216_191_7,
            -0.138_190_772_208_433_9,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let a = vec![
        1.2629542848807933,
        -0.3262333607056494,
        1.3297992629225006,
        1.2724293214294047,
        0.4146414344564082,
        -1.5399500419037095,
        0.0,
        -0.2947204467905602,
        -0.005767172747536955,
        2.404653388857951,
        0.7635934611404596,
        -0.7990092489893682,
        -1.1476570092363514,
        -0.28946157368822334,
        -0.29921511789731614,
        -0.411510832795067,
        0.2522234481561323,
        -0.8919211272845686,
        0.43568329935571865,
        -1.237538421929958,
        -0.22426788527830935,
        0.37739564598170106,
        0.1333363608148414,
        0.8041895097449078,
        -0.057106774383808755,
        0.5036079722337261,
        1.085769362145687,
        -0.6909538396968303,
        -1.2845993538721883,
        0.04672617218835198,
        -0.23570655643950122,
        -0.5428882550102544,
        -0.4333103174567822,
        -0.6494716467962331,
        0.726750747385451,
        1.1519117540872,
    ];
    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trmm('r', 'u', 't', 'n', 4, 5, 0.2, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.621_050_250_111_106_2,
            -0.12954989323526214,
            0.37263148789538547,
            0.456_635_299_342_641,
            0.41464143991470337,
            -1.5399500131607056,
            7.587_207_051_004_087_6E-3,
            0.39115412276144135,
            0.18253065588284567,
            -0.280_919_090_341_517_3,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            3.673_635_273_908_512E-2,
            0.18219071514324656,
            0.26374420144354255,
            -0.14234480784734793,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            4.077_662_776_957_867_4E-2,
            -0.16300230666012616,
            -0.16697085942567472,
            0.12396894340930473,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            1.467_186_472_488_272_3E-2,
            -0.129_386_896_214_668_8,
            -0.278_955_731_137_476_2,
            0.177_519_769_825_706_9,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trmm('r', 'u', 't', 'u', 4, 5, 1.0, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            2.7731520394618983,
            -0.561_965_013_627_339_1,
            1.5134810554300948,
            1.9485857770513717,
            0.41464143991470337,
            -1.5399500131607056,
            -1.1642987083237655,
            1.5741900051570363,
            0.905_186_389_473_837_7,
            1.7087583644498494,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -1.3073716002097058,
            0.534_880_700_408_654_9,
            0.929_976_198_462_105_6,
            -1.2463651098452408,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.47514145563840016,
            -1.5855083357389788,
            -0.974_484_443_337_672_7,
            0.854_812_883_546_074_4,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let a = vec![
        1.2629542848807933,
        -0.3262333607056494,
        1.3297992629225006,
        1.2724293214294047,
        0.4146414344564082,
        -1.5399500419037095,
        -0.9285670347135381,
        -0.2947204467905602,
        -0.005767172747536955,
        2.404653388857951,
        0.7635934611404596,
        -0.7990092489893682,
        -1.1476570092363514,
        -0.28946157368822334,
        -0.29921511789731614,
        -0.411510832795067,
        0.2522234481561323,
        -0.8919211272845686,
        0.43568329935571865,
        -1.237538421929958,
        -0.22426788527830935,
        0.37739564598170106,
        0.0,
        0.8041895097449078,
        -0.057106774383808755,
        0.5036079722337261,
        1.085769362145687,
        -0.6909538396968303,
        -1.2845993538721883,
        0.04672617218835198,
        -0.23570655643950122,
        -0.5428882550102544,
        -0.4333103174567822,
        -0.6494716467962331,
        0.726750747385451,
        1.1519117540872,
    ];

    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trmm('r', 'l', 't', 'n', 4, 5, 0.2, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.31901068473336724,
            -8.240_356_124_547_639E-2,
            0.335_895_135_156_300_3,
            0.321_404_011_324_917_3,
            0.41464143991470337,
            -1.5399500131607056,
            -2.767_002_220_468_656_2E-2,
            3.865_766_892_566_467_6E-2,
            -8.642_503_819_847_044E-2,
            -0.224_761_879_774_079_3,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            0.405_645_442_377_444_8,
            -6.910_278_217_350_505E-2,
            0.37158582649847066,
            0.360_267_576_001_054_3,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            2.167_296_329_520_229_7E-3,
            -0.29434689431172434,
            0.343_340_030_460_949_6,
            1.5426405492670858,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -8.029_625_135_408_866E-2,
            -0.21605199061834265,
            -0.18465232000306878,
            0.629_517_123_356_933_2,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trmm('r', 'l', 't', 'u', 4, 5, 1.0, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            1.2629542350769043,
            -0.326_233_357_191_085_8,
            1.3297992944717407,
            1.272_429_347_038_269,
            0.41464143991470337,
            -1.5399500131607056,
            -1.3405848519753505,
            -0.18829223775881498,
            -0.439_592_060_893_982_5,
            1.9895444131030011,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            0.537_173_820_496_224_2,
            -0.721_586_767_452_278_9,
            1.469_184_315_701_919,
            1.266_696_771_949_23,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            0.282_094_801_314_727_3,
            -2.2422312642110356,
            1.577_069_968_074_325,
            7.9481708071357104,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -0.531_947_347_619_517_8,
            7.028_252_279_622_738E-2,
            1.557_286_463_547_619,
            1.5690328832335503,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let a = vec![];
    let result = std::panic::catch_unwind(|| {
        level3::trmm('x', 'u', 'n', 'u', 3, 5, 0.25, &a, 6, &mut [], 6);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::trmm('l', 'x', 'n', 'u', 3, 5, 0.25, &a, 6, &mut [], 6);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::trmm('l', 'u', 'x', 'u', 3, 5, 0.25, &a, 6, &mut [], 6);
    });
    assert!(result.is_err());
    let result = std::panic::catch_unwind(|| {
        level3::trmm('l', 'u', 'n', 'x', 3, 5, 0.25, &a, 6, &mut [], 6);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::trmm('l', 'u', 'n', 'u', 3, 5, 0.25, &a, 2, &mut [], 6);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::trmm('l', 'u', 'n', 'u', 4, 5, 0.25, &a, 6, &mut [], 3);
    });
    assert!(result.is_err());
}

#[test]
fn trsm() {
    let a = fixtures::matrix_mxn(6, 6);
    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trsm('l', 'l', 'n', 'n', 3, 0, 0.2, &a, 6, &mut b, 6);
    approximately!(b, a);

    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trsm('l', 'u', 'n', 'u', 0, 4, 0.25, &a, 6, &mut b, 6);
    approximately!(b, a);

    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trsm('l', 'u', 'n', 'u', 5, 4, 0.0, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            -1.5399500131607056,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            -0.799_009_263_515_472_4,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            -0.891_921_103_000_640_9,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trsm('l', 'u', 'n', 'n', 5, 4, -0.3, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            2.876_047_785_684_908,
            1.0674914099744215,
            2.309_916_003_706_978,
            -0.834_194_112_183_946_5,
            9.683_364_805_717_742E-2,
            -1.5399500131607056,
            6.013_616_828_120_448,
            4.863_586_607_651_267,
            1.829_322_526_751_288,
            -1.5850226571227222,
            0.17832645474752631,
            -0.799_009_263_515_472_4,
            -1.437_174_737_295_788,
            -1.6154974071937465,
            -0.41226915389269775,
            0.434_961_712_523_026_8,
            5.890_322_477_935_655E-2,
            -0.891_921_103_000_640_9,
            -0.142_033_599_974_940_3,
            -0.25518927999139956,
            7.026_374_144_683_07E-2,
            -0.24298957861021067,
            3.113_882_362_041_913E-2,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut b = vec![
        1.2629542848807933,
        -0.3262333607056494,
        1.3297992629225006,
        1.2724293214294047,
        0.0,
        -1.5399500419037095,
        -0.9285670347135381,
        -0.2947204467905602,
        -0.005767172747536955,
        2.404653388857951,
        0.7635934611404596,
        -0.7990092489893682,
        -1.1476570092363514,
        -0.28946157368822334,
        -0.29921511789731614,
        -0.411510832795067,
        0.2522234481561323,
        -0.8919211272845686,
        0.43568329935571865,
        -1.237538421929958,
        -0.22426788527830935,
        0.37739564598170106,
        0.1333363608148414,
        0.8041895097449078,
        -0.057106774383808755,
        0.5036079722337261,
        1.085769362145687,
        -0.6909538396968303,
        -1.2845993538721883,
        0.04672617218835198,
        -0.23570655643950122,
        -0.5428882550102544,
        -0.4333103174567822,
        -0.6494716467962331,
        0.726750747385451,
        1.1519117540872,
    ];
    level3::trsm('l', 'u', 'n', 'u', 5, 4, 1.0, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            4.155_630_488_458_415,
            1.7159749179671806,
            1.6151643330570895,
            1.272_429_347_038_269,
            0.0000000000000000,
            -1.5399500131607056,
            0.32527101830242566,
            2.898_209_101_199,
            -0.177_241_566_782_614_6,
            2.932_261_135_292_123,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            -2.5763265232150987,
            -0.891_354_930_700_489_5,
            -0.626_276_056_629_269_4,
            -0.23723605293206518,
            0.252_223_461_866_378_8,
            -0.891_921_103_000_640_9,
            -0.806_781_604_828_354_7,
            -0.799_975_459_522_924,
            -0.26374106824485594,
            0.469_524_934_680_414_7,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut b = vec![
        0.0,
        -0.3262333607056494,
        1.3297992629225006,
        1.2724293214294047,
        0.4146414344564082,
        -1.5399500419037095,
        -0.9285670347135381,
        -0.2947204467905602,
        -0.005767172747536955,
        2.404653388857951,
        0.7635934611404596,
        -0.7990092489893682,
        -1.1476570092363514,
        -0.28946157368822334,
        -0.29921511789731614,
        -0.411510832795067,
        0.2522234481561323,
        -0.8919211272845686,
        0.43568329935571865,
        -1.237538421929958,
        -0.22426788527830935,
        0.37739564598170106,
        0.1333363608148414,
        0.8041895097449078,
        -0.057106774383808755,
        0.5036079722337261,
        1.085769362145687,
        -0.6909538396968303,
        -1.2845993538721883,
        0.04672617218835198,
        -0.23570655643950122,
        -0.5428882550102544,
        -0.4333103174567822,
        -0.6494716467962331,
        0.726750747385451,
        1.1519117540872,
    ];
    level3::trsm('l', 'l', 'n', 'n', 5, 4, 1.0, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.0000000000000000,
            1.1069247724052265,
            -4.465_627_183_729_244,
            -8.550_694_254_456_094,
            -1.429_126_875_636_897,
            -1.5399500131607056,
            -0.735_234_124_957_005_7,
            1.8138488664325891,
            -3.283_281_494_813_388,
            -6.286_762_207_949_921,
            -1.0507428478614336,
            -0.799_009_263_515_472_4,
            -0.908_708_332_342_246_3,
            1.988_028_216_413_694,
            -3.0768830449084668,
            -14.048738644337698,
            -1.3702608528785267,
            -0.891_921_103_000_640_9,
            0.34497157373668497,
            3.8171672723850882,
            2.209_101_611_769_96,
            -22.076170652817265,
            0.418_883_862_786_459_3,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut b = vec![
        0.0,
        -0.3262333607056494,
        1.3297992629225006,
        1.2724293214294047,
        0.4146414344564082,
        -1.5399500419037095,
        -0.9285670347135381,
        -0.2947204467905602,
        -0.005767172747536955,
        2.404653388857951,
        0.7635934611404596,
        -0.7990092489893682,
        -1.1476570092363514,
        -0.28946157368822334,
        -0.29921511789731614,
        -0.411510832795067,
        0.2522234481561323,
        -0.8919211272845686,
        0.43568329935571865,
        -1.237538421929958,
        -0.22426788527830935,
        0.37739564598170106,
        0.1333363608148414,
        0.8041895097449078,
        -0.057106774383808755,
        0.5036079722337261,
        1.085769362145687,
        -0.6909538396968303,
        -1.2845993538721883,
        0.04672617218835198,
        -0.23570655643950122,
        -0.5428882550102544,
        -0.4333103174567822,
        -0.6494716467962331,
        0.726750747385451,
        1.1519117540872,
    ];
    level3::trsm('l', 'l', 'n', 'u', 5, 4, 0.4, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.0000000000000000,
            -0.13049334482093666,
            0.531_167_148_063_293_7,
            1.0413440314533495,
            -7.321_405_123_489_333E-3,
            -1.5399500131607056,
            -0.371_426_826_289_695_8,
            -0.23905999868918107,
            0.49023756215580533,
            2.2110702137392075,
            0.22352549776441472,
            -0.799_009_263_515_472_4,
            -0.459_062_821_553_093_4,
            -0.26554624032184093,
            0.48924392015425894,
            1.2593964890024612,
            0.20268307600853525,
            -0.891_921_103_000_640_9,
            0.17427332660963124,
            -0.43816161773430906,
            -0.32398265584906044,
            0.849_512_185_634_038_3,
            0.28409609869451813,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trsm('l', 'u', 't', 'n', 5, 4, 0.4, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.400_000_005_960_464_5,
            -0.817_498_374_279_956_6,
            -2.5210898556555987,
            -3.2920006232504653,
            -0.827_573_039_293_739_3,
            -1.5399500131607056,
            -0.294_093_654_365_139_2,
            1.3265922592519162,
            -0.14762614926240678,
            7.150_570_228_818_465,
            -3.675_513_567_988_328,
            -0.799_009_263_515_472_4,
            -0.363_483_338_353_222_3,
            1.5380788827994862,
            0.30621952409281056,
            5.209_032_518_807_691,
            -2.002_383_536_096_208,
            -0.891_921_103_000_640_9,
            0.137_988_631_550_864_8,
            1.244_853_231_003_587,
            -1.4337299275752455,
            3.470_768_824_987_471,
            -2.638_283_999_720_651,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut b = vec![
        1.2629542848807933,
        -0.3262333607056494,
        1.3297992629225006,
        1.2724293214294047,
        0.0,
        -1.5399500419037095,
        -0.9285670347135381,
        -0.2947204467905602,
        -0.005767172747536955,
        2.404653388857951,
        0.7635934611404596,
        -0.7990092489893682,
        -1.1476570092363514,
        -0.28946157368822334,
        -0.29921511789731614,
        -0.411510832795067,
        0.2522234481561323,
        -0.8919211272845686,
        0.43568329935571865,
        -1.237538421929958,
        -0.22426788527830935,
        0.37739564598170106,
        0.1333363608148414,
        0.8041895097449078,
        -0.057106774383808755,
        0.5036079722337261,
        1.085769362145687,
        -0.6909538396968303,
        -1.2845993538721883,
        0.04672617218835198,
        -0.23570655643950122,
        -0.5428882550102544,
        -0.4333103174567822,
        -0.6494716467962331,
        0.726750747385451,
        1.1519117540872,
    ];
    level3::trsm('l', 'u', 't', 'u', 5, 4, 1.0, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            1.2629542350769043,
            0.846_504_333_543_123_3,
            3.0242680938088427,
            2.448_009_141_527_928,
            -1.9463795578177014,
            -1.5399500131607056,
            -0.928_567_051_887_512_2,
            -1.1569572109540474,
            -1.4063383495193884,
            1.0620389085996593,
            3.5539979003076425,
            -0.799_009_263_515_472_4,
            -1.147_657_036_781_311,
            -1.3551380941210738,
            -2.0085922000010106,
            -2.0389940391990007,
            1.641_160_034_757_982,
            -0.891_921_103_000_640_9,
            0.43568331003189087,
            -0.832_977_290_163_903_2,
            3.463_220_654_751_148E-2,
            -0.835_498_825_553_018_7,
            -3.718_287_032_728_829E-2,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut b = vec![
        0.0,
        -0.3262333607056494,
        1.3297992629225006,
        1.2724293214294047,
        0.4146414344564082,
        -1.5399500419037095,
        -0.9285670347135381,
        -0.2947204467905602,
        -0.005767172747536955,
        2.404653388857951,
        0.7635934611404596,
        -0.7990092489893682,
        -1.1476570092363514,
        -0.28946157368822334,
        -0.29921511789731614,
        -0.411510832795067,
        0.2522234481561323,
        -0.8919211272845686,
        0.43568329935571865,
        -1.237538421929958,
        -0.22426788527830935,
        0.37739564598170106,
        0.1333363608148414,
        0.8041895097449078,
        -0.057106774383808755,
        0.5036079722337261,
        1.085769362145687,
        -0.6909538396968303,
        -1.2845993538721883,
        0.04672617218835198,
        -0.23570655643950122,
        -0.5428882550102544,
        -0.4333103174567822,
        -0.6494716467962331,
        0.726750747385451,
        1.1519117540872,
    ];
    level3::trsm('l', 'l', 't', 'n', 5, 4, 1.0, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            14.071953442027016,
            28.896460512105627,
            -9.510_190_101_712_027,
            3.4856455476188124,
            -0.322_778_814_031_180_4,
            -1.5399500131607056,
            16.647_190_236_328_4,
            53.347_344_958_219_55,
            -9.533_634_706_470_33,
            6.581_716_689_664_905,
            -0.594_421_492_204_899_8,
            -0.799_009_263_515_472_4,
            -4.213_669_611_512_011,
            -7.901_018_199_349_097,
            2.2387106134601513,
            -1.0210266334602636,
            -0.19634407479584262,
            -0.891_921_103_000_640_9,
            3.342_637_354_088_931,
            12.403351630523389,
            -0.763_710_107_321_875_2,
            1.0366718348708222,
            -0.103_796_074_610_245,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ],
        1E-5
    );

    let mut b = vec![
        0.0,
        -0.3262333607056494,
        1.3297992629225006,
        1.2724293214294047,
        0.4146414344564082,
        -1.5399500419037095,
        -0.9285670347135381,
        -0.2947204467905602,
        -0.005767172747536955,
        2.404653388857951,
        0.7635934611404596,
        -0.7990092489893682,
        -1.1476570092363514,
        -0.28946157368822334,
        -0.29921511789731614,
        -0.411510832795067,
        0.2522234481561323,
        -0.8919211272845686,
        0.43568329935571865,
        -1.237538421929958,
        -0.22426788527830935,
        0.37739564598170106,
        0.1333363608148414,
        0.8041895097449078,
        -0.057106774383808755,
        0.5036079722337261,
        1.085769362145687,
        -0.6909538396968303,
        -1.2845993538721883,
        0.04672617218835198,
        -0.23570655643950122,
        -0.5428882550102544,
        -0.4333103174567822,
        -0.6494716467962331,
        0.726750747385451,
        1.1519117540872,
    ];
    level3::trsm('l', 'l', 't', 'u', 5, 4, 0.4, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            -2.0709179287349446,
            -1.4238808651692094,
            0.690_433_744_745_460_7,
            0.486_857_033_082_431_1,
            0.16585657843733692,
            -1.5399500131607056,
            -2.905_303_345_779_301,
            -2.5644010238629114,
            0.299_711_858_241_801_4,
            0.921_135_428_768_560_7,
            0.305_437_378_666_361_8,
            -0.799_009_263_515_472_4,
            9.246_857_575_585_199E-2,
            0.234_081_601_479_347_1,
            -0.21840491582933022,
            -0.17805655656779862,
            0.100_889_386_249_920_5,
            -0.891_921_103_000_640_9,
            -0.260_115_981_215_139_5,
            -0.881_896_612_519_173_8,
            -4.396_485_109_714_580_5E-2,
            0.14384683150119362,
            5.333_454_688_391_903E-2,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trsm('r', 'u', 'n', 'n', 5, 4, 0.4, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.400_000_005_960_464_5,
            -0.10332389028569243,
            0.421_171_021_832_416_5,
            0.403_000_941_968_879_1,
            0.13132429808688795,
            -1.5399500131607056,
            -0.0000000000000000,
            0.725_539_557_384_417_4,
            -1.3191438758939147,
            -4.533_362_973_517_785,
            -1.4501226768752162,
            -0.799_009_263_515_472_4,
            -0.0000000000000000,
            8.137_689_320_769_634E-2,
            6.071_763_104_290_985E-2,
            3.389_975_506_439_509,
            0.561_970_835_739_633_8,
            -0.891_921_103_000_640_9,
            0.0000000000000000,
            1.2351345873541026,
            -5.013_514_473_790_615,
            -12.916340648551534,
            -4.4315078463190725,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );
    let a = vec![
        1.2629542848807933,
        -0.3262333607056494,
        1.3297992629225006,
        1.2724293214294047,
        0.4146414344564082,
        -1.5399500419037095,
        0.0,
        -0.2947204467905602,
        -0.005767172747536955,
        2.404653388857951,
        0.7635934611404596,
        -0.7990092489893682,
        -1.1476570092363514,
        -0.28946157368822334,
        -0.29921511789731614,
        -0.411510832795067,
        0.2522234481561323,
        -0.8919211272845686,
        0.43568329935571865,
        -1.237538421929958,
        -0.22426788527830935,
        0.37739564598170106,
        0.1333363608148414,
        0.8041895097449078,
        -0.057106774383808755,
        0.5036079722337261,
        1.085769362145687,
        -0.6909538396968303,
        -1.2845993538721883,
        0.04672617218835198,
        -0.23570655643950122,
        -0.5428882550102544,
        -0.4333103174567822,
        -0.6494716467962331,
        0.726750747385451,
        1.1519117540872,
    ];

    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trsm('r', 'u', 'n', 'u', 5, 4, 1.0, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            1.2629542350769043,
            -0.326_233_357_191_085_8,
            1.3297992944717407,
            1.272_429_347_038_269,
            0.41464143991470337,
            -1.5399500131607056,
            -0.928_567_051_887_512_2,
            -0.29472044110298157,
            -5.767_172_668_129_206E-3,
            2.404_653_310_775_757,
            0.763_593_435_287_475_6,
            -0.799_009_263_515_472_4,
            3.299_678_957_015_217_4E-2,
            -0.749_175_836_306_622_3,
            1.2252690347217428,
            1.7448564224390495,
            0.949_120_592_595_292_6,
            -0.891_921_103_000_640_9,
            -1.2563020878502498,
            -1.6281479882856154,
            -0.535_987_846_264_942_7,
            3.1901856372673363,
            1.1105175198176607,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trsm('r', 'l', 'n', 'n', 5, 4, 1.0, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.705_642_688_944_734_7,
            -9.402_114_626_697_811,
            -1.5183813183635133,
            0.0000000000000000,
            1.4536198850814033,
            -1.5399500131607056,
            12.525932259284879,
            -25.862121989332273,
            -4.864_548_467_166_707,
            -0.0000000000000000,
            0.317_759_086_850_341_7,
            -0.799_009_263_515_472_4,
            2.247_846_301_580_974,
            5.477_226_496_048_657,
            1.817_274_469_094_399,
            -0.0000000000000000,
            -1.3288531503707177,
            -0.891_921_103_000_640_9,
            1.1544470606667443,
            -3.2791539201836617,
            -0.594_251_362_816_492_4,
            1.0000000000000000,
            0.35330656779194236,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let a = vec![
        1.2629542848807933,
        -0.3262333607056494,
        1.3297992629225006,
        1.2724293214294047,
        0.4146414344564082,
        -1.5399500419037095,
        -0.9285670347135381,
        -0.2947204467905602,
        -0.005767172747536955,
        2.404653388857951,
        0.7635934611404596,
        -0.7990092489893682,
        -1.1476570092363514,
        -0.28946157368822334,
        -0.29921511789731614,
        0.0,
        0.2522234481561323,
        -0.8919211272845686,
        0.43568329935571865,
        -1.237538421929958,
        -0.22426788527830935,
        0.37739564598170106,
        0.1333363608148414,
        0.8041895097449078,
        -0.057106774383808755,
        0.5036079722337261,
        1.085769362145687,
        -0.6909538396968303,
        -1.2845993538721883,
        0.04672617218835198,
        -0.23570655643950122,
        -0.5428882550102544,
        -0.4333103174567822,
        -0.6494716467962331,
        0.726750747385451,
        1.1519117540872,
    ];

    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trsm('r', 'l', 'n', 'u', 5, 4, 0.4, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.635_143_489_012_340_7,
            1.0030009359941672,
            0.874_619_701_672_373_4,
            0.730_836_846_282_149_4,
            2.182_339_510_951_989E-2,
            -1.5399500131607056,
            -0.793_141_252_658_865_7,
            1.0717844686128233,
            0.212_717_488_976_925_9,
            0.597_909_742_612_753_5,
            0.17776813043410594,
            -0.799_009_263_515_472_4,
            -0.459_062_821_553_093_4,
            -0.11578463488496293,
            -0.11968604504594271,
            -0.16460433251566187,
            0.100_889_386_249_920_5,
            -0.891_921_103_000_640_9,
            0.17427332660963124,
            -0.49501539014302764,
            -8.970_715_537_230_9E-2,
            0.15095826612350738,
            5.333_454_688_391_903E-2,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let a = vec![
        1.2629542848807933,
        -0.3262333607056494,
        1.3297992629225006,
        1.2724293214294047,
        0.4146414344564082,
        -1.5399500419037095,
        -0.9285670347135381,
        -0.2947204467905602,
        -0.005767172747536955,
        2.404653388857951,
        0.7635934611404596,
        -0.7990092489893682,
        -1.1476570092363514,
        -0.28946157368822334,
        -0.29921511789731614,
        -0.411510832795067,
        0.2522234481561323,
        -0.8919211272845686,
        0.0,
        -1.237538421929958,
        -0.22426788527830935,
        0.37739564598170106,
        0.1333363608148414,
        0.8041895097449078,
        -0.057106774383808755,
        0.5036079722337261,
        1.085769362145687,
        -0.6909538396968303,
        -1.2845993538721883,
        0.04672617218835198,
        -0.23570655643950122,
        -0.5428882550102544,
        -0.4333103174567822,
        -0.6494716467962331,
        0.726750747385451,
        1.1519117540872,
    ];

    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trsm('r', 'u', 't', 'n', 5, 4, 0.4, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.12265160515110517,
            4.495_866_070_711_034,
            1.2686519464434949,
            -3.184_738_324_164_037,
            -1.1496261325400379,
            -1.5399500131607056,
            -1.8456630500063393,
            4.562_068_111_292_95,
            0.438_092_813_881_198_1,
            -5.189_095_382_476_156,
            -1.194_582_506_080_556,
            -0.799_009_263_515_472_4,
            1.1881106602650842,
            1.3700785619373967,
            0.578_161_461_987_463_9,
            0.250_312_150_361_916_4,
            -0.443_104_341_347_879_8,
            -0.891_921_103_000_640_9,
            0.46177883114773843,
            -1.3116615876187452,
            -0.237_700_548_668_611_1,
            0.400_000_005_960_464_5,
            0.14132262922264818,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trsm('r', 'u', 't', 'u', 5, 4, 1.0, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            -0.585_811_434_555_339_7,
            -2.825_127_592_933_536,
            0.571_667_298_802_089_9,
            3.4759940329914816,
            1.6765266814553499,
            -1.5399500131607056,
            -0.693_311_597_184_037_6,
            -1.9903470874821614,
            -0.38447736812125505,
            2.7770777485476015,
            1.0102671058949777,
            -0.799_009_263_515_472_4,
            -1.0499472622719184,
            -0.567_001_715_348_032_7,
            -0.349_511_192_438_461_5,
            -0.326_873_098_717_842_3,
            0.282_126_526_500_369_4,
            -0.891_921_103_000_640_9,
            0.43568331003189087,
            -1.237_538_456_916_809,
            -0.224_267_885_088_920_6,
            0.377_395_659_685_134_9,
            0.133_336_365_222_930_9,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ]
    );

    let a = vec![
        1.2629542848807933,
        0.0,
        1.3297992629225006,
        1.2724293214294047,
        0.4146414344564082,
        -1.5399500419037095,
        -0.9285670347135381,
        -0.2947204467905602,
        -0.005767172747536955,
        2.404653388857951,
        0.7635934611404596,
        -0.7990092489893682,
        -1.1476570092363514,
        -0.28946157368822334,
        -0.29921511789731614,
        -0.411510832795067,
        0.2522234481561323,
        -0.8919211272845686,
        0.43568329935571865,
        -1.237538421929958,
        -0.22426788527830935,
        0.37739564598170106,
        0.1333363608148414,
        0.8041895097449078,
        -0.057106774383808755,
        0.5036079722337261,
        1.085769362145687,
        -0.6909538396968303,
        -1.2845993538721883,
        0.04672617218835198,
        -0.23570655643950122,
        -0.5428882550102544,
        -0.4333103174567822,
        -0.6494716467962331,
        0.726750747385451,
        1.1519117540872,
    ];
    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trsm('r', 'l', 't', 'n', 5, 4, 1.0, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            1.0000000000000000,
            -0.258_309_721_865_116_3,
            1.0529275388911983,
            1.0075023399092429,
            0.328_310_740_325_008_6,
            -1.5399500131607056,
            3.150_670_677_650_931,
            1.0000000000000000,
            1.956_828_188_280_986_3E-2,
            -8.159_099_184_896_782,
            -2.5909076154668886,
            -0.799_009_263_515_472_4,
            8.219_123_307_606_399,
            -0.19987518688139722,
            5.679_140_212_251_727,
            6.010_196_713_810_248,
            0.666_096_514_307_138_3,
            -0.891_921_103_000_640_9,
            -13.330197021871951,
            -8.997_882_230_233_449,
            1.9235222679509523,
            56.143957802321914,
            16.481176946121465,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ],
        1E-5
    );

    let mut b = fixtures::matrix_mxn(6, 6);
    level3::trsm('r', 'l', 't', 'u', 5, 4, 0.4, &a, 6, &mut b, 6);
    approximately!(
        b,
        vec![
            0.505_181_701_558_555_6,
            -0.13049334482093666,
            0.531_919_725_714_917_7,
            0.508_971_746_399_577_5,
            0.16585657843733692,
            -1.5399500131607056,
            -0.371_426_826_289_695_8,
            -0.11788817819786335,
            -2.306_869_101_626_71E-3,
            0.961_861_338_643_153_4,
            0.305_437_378_666_361_8,
            -0.799_009_263_515_472_4,
            -1.1329951745064821,
            5.706_544_151_197_796E-2,
            -0.827_045_825_129_674,
            -0.835_887_381_361_116_8,
            -0.117_905_064_637_477_4,
            -0.891_921_103_000_640_9,
            -4.162_172_765_200_359E-2,
            -2.200_858_367_031_700_5E-2,
            -1.101_328_514_159_665,
            -3.1535920793264705,
            -0.940_696_445_203_015_7,
            0.804_189_503_192_901_6,
            -5.710_677_430_033_684E-2,
            0.503_607_988_357_544,
            1.0857694149017334,
            -0.690_953_850_746_154_8,
            -1.2845993041992188,
            4.672_617_092_728_615E-2,
            -0.23570655286312103,
            -0.542_888_283_729_553_2,
            -0.433_310_329_914_093,
            -0.649_471_640_586_853,
            0.726_750_731_468_200_7,
            1.151_911_735_534_668,
        ],
        1E-5
    );

    let a = vec![];
    let result = std::panic::catch_unwind(|| {
        level3::trsm('x', 'u', 'n', 'u', 3, 5, 0.25, &a, 6, &mut [], 6);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::trsm('l', 'x', 'n', 'u', 3, 5, 0.25, &a, 6, &mut [], 6);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::trsm('l', 'u', 'x', 'u', 3, 5, 0.25, &a, 6, &mut [], 6);
    });
    assert!(result.is_err());
    let result = std::panic::catch_unwind(|| {
        level3::trsm('l', 'u', 'n', 'x', 3, 5, 0.25, &a, 6, &mut [], 6);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::trsm('l', 'u', 'n', 'u', 3, 5, 0.25, &a, 2, &mut [], 6);
    });
    assert!(result.is_err());

    let result = std::panic::catch_unwind(|| {
        level3::trsm('l', 'u', 'n', 'u', 4, 5, 0.25, &a, 6, &mut [], 3);
    });
    assert!(result.is_err());
}
